# –õ–µ–∫—Ü–∏—è 30. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ. Django, REST API.

### –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ –∫—É—Ä—Å–∞

<details>
  <summary>–ë–ª–æ–∫ 1 ‚Äî Python Basic (1‚Äì6)</summary>

  - [–õ–µ–∫—Ü–∏—è 1. –í–≤–µ–¥–µ–Ω–∏–µ. –¢–∏–ø–∏–∑–∞—Ü–∏–∏. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ. –°—Ç—Ä–æ–∫–∏ –∏ —á–∏—Å–ª–∞. –ë—É–ª–µ–≤–∞ –∞–ª–≥–µ–±—Ä–∞. –í–µ—Ç–≤–ª–µ–Ω–∏–µ](lesson01.md)
  - [–õ–µ–∫—Ü–∏—è 2. –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π. –°–ø–∏—Å–∫–∏, —Å—Ç—Ä–æ–∫–∏ –¥–µ—Ç–∞–ª—å–Ω–µ–µ, —Å—Ä–µ–∑—ã, —Ü–∏–∫–ª—ã.](lesson02.md)
  - [–õ–µ–∫—Ü–∏—è 3. None. Range, list comprehension, sum, max, min, len, sorted, all, any. –†–∞–±–æ—Ç–∞ —Å —Ñ–∞–π–ª–∞–º–∏](lesson03.md)
  - [–õ–µ–∫—Ü–∏—è 4. –•–µ—à-—Ç–∞–±–ª–∏—Ü—ã. Set, frozenset. Dict. Tuple. –ù–µ–º–Ω–æ–≥–æ –æ–± –∏–º–ø–æ—Ä—Ç–∞—Ö. Namedtuple, OrderedDict](lesson04.md)
  - [–õ–µ–∫—Ü–∏—è 5. –§—É–Ω–∫—Ü–∏–∏, —Ç–∏–ø–∏–∑–∞—Ü–∏—è, lambda. Map, zip, filter.](lesson05.md)
  - [–õ–µ–∫—Ü–∏—è 6. –ê–ª–≥–æ—Ä–∏—Ç–º—ã –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö](lesson06.md)
</details>

<details>
  <summary>–ë–ª–æ–∫ 2 ‚Äî Git (7‚Äì8)</summary>

  - [–õ–µ–∫—Ü–∏—è 7. Git. –ò—Å—Ç–æ—Ä–∏—è —Å–∏—Å—Ç–µ–º—ã –∫–æ–Ω—Ç—Ä–æ–ª—è –≤–µ—Ä—Å–∏–π. –õ–æ–∫–∞–ª—å–Ω—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π. –ë–∞–∑–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–º.](lesson07.md)
  - [–õ–µ–∫—Ü–∏—è 8. Git. –£–¥–∞–ª–µ–Ω–Ω—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π. Remote, push, pull. GitHub, Bitbucket, GitLab, etc. Pull request.](lesson08.md)
</details>

<details>
  <summary>–ë–ª–æ–∫ 3 ‚Äî Python Advanced (9‚Äì14)</summary>

  - [–õ–µ–∫—Ü–∏—è 9. –í–≤–µ–¥–µ–Ω–∏–µ –≤ –û–û–ü. –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–¥–∏–≥–º—ã –û–û–ü. –ö–ª–∞—Å—Å—ã –∏ –æ–±—ä–µ–∫—Ç—ã. –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ.](lesson09.md)
  - [–õ–µ–∫—Ü–∏—è 10. Magic methods. –ò—Ç–µ—Ä–∞—Ç–æ—Ä—ã –∏ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä—ã.](lesson10.md)
  - [–õ–µ–∫—Ü–∏—è 11. Imports. Standard library. PEP 8](lesson11.md)
  - [–õ–µ–∫—Ü–∏—è 12. –î–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã. –î–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏. –î–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã –∫–ª–∞—Å—Å–æ–≤ (staticmethod, classmethod, property)](lesson12.md)
  - [–õ–µ–∫—Ü–∏—è 13. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ](lesson13.md)
  - [–õ–µ–∫—Ü–∏—è 14. –ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ. –ü–∞—Ç—Ç–µ—Ä–Ω—ã. SOLID.](lesson14.md)
</details>

<details>
  <summary>–ë–ª–æ–∫ 4 ‚Äî SQL (15‚Äì17)</summary>

  - [–õ–µ–∫—Ü–∏—è 15. –°–£–ë–î. PostgreSQL. SQL. DDL. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏. DCL. DML. –°–≤—è–∑–∏.](lesson15.md)
  - [–õ–µ–∫—Ü–∏—è 16. –°–£–ë–î. DQL. SELECT. –ò–Ω–¥–µ–∫—Å—ã. Group by. Joins.](lesson16.md)
  - [–õ–µ–∫—Ü–∏—è 17. –°–£–ë–î. –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è. –ê–Ω–æ–º–∞–ª–∏–∏. –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏. ACID. TCL. Backup](lesson17.md)
</details>

- [–õ–µ–∫—Ü–∏—è 18. Virtual env. Pip. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º—ã–µ –º–æ–¥—É–ª–∏. Pyenv.](lesson18.md)

<details>
  <summary>–ë–ª–æ–∫ 5 ‚Äî Django (19‚Äì26)</summary>

  - [–õ–µ–∫—Ü–∏—è 19. –ó–Ω–∞–∫–æ–º—Å—Ç–≤–æ —Å Django](lesson19.md)
  - [–õ–µ–∫—Ü–∏—è 20. Templates. Static](lesson20.md)
  - [–õ–µ–∫—Ü–∏—è 21. –ú–æ–¥–µ–ª–∏. –°–≤—è–∑–∏. Meta. Abstract, proxy](lesson21.md)
  - [–õ–µ–∫—Ü–∏—è 22. Django ORM](lesson22.md)
  - [–õ–µ–∫—Ü–∏—è 23. Forms, ModelForms. User, Authentication](lesson23.md)
  - [–õ–µ–∫—Ü–∏—è 24. ClassBaseView](lesson24.md)
  - [–õ–µ–∫—Ü–∏—è 25. NoSQL. –ö—É–∫–∏, —Å–µ—Å—Å–∏–∏, –∫–µ—à](lesson25.md)
  - [–õ–µ–∫—Ü–∏—è 26. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ. Middleware. Signals. Messages. Manage commands](lesson26.md)
</details>

<details open>
  <summary>–ë–ª–æ–∫ 6 ‚Äî Django Rest Framework (27‚Äì30)</summary>

  - [–õ–µ–∫—Ü–∏—è 27. –ß—Ç–æ —Ç–∞–∫–æ–µ API. REST –∏ RESTful. Django REST Framework](lesson27.md)
  - [–õ–µ–∫—Ü–∏—è 28. @api_view, APIView, ViewSets, Pagination, Routers](lesson28.md)
  - [–õ–µ–∫—Ü–∏—è 29. REST-–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è. –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è. Permissions. –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è](lesson29.md)
  - ‚ñ∂ **[–õ–µ–∫—Ü–∏—è 30. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ. Django, REST API.](lesson30.md)**
</details>

<details>
  <summary>–ë–ª–æ–∫ 7 ‚Äî Python async (31‚Äì33)</summary>

  - [–õ–µ–∫—Ü–∏—è 31. Celery. Multithreading. GIL. Multiprocessing](lesson31.md)
  - [–õ–µ–∫—Ü–∏—è 32. Asyncio. Aiohttp. –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ.](lesson32.md)
  - [–õ–µ–∫—Ü–∏—è 33. –°–æ–∫–µ—Ç—ã. Django Channels.](lesson33.md)
</details>

<details>
  <summary>–ë–ª–æ–∫ 8 ‚Äî Deployment (34‚Äì35)</summary>

  - [–õ–µ–∫—Ü–∏—è 34. Linux. –í—Å—ë, —á—Ç–æ –Ω—É–∂–Ω–æ –∑–Ω–∞—Ç—å –¥–ª—è –¥–µ–ø–ª–æ–π–º–µ–Ω—Ç–∞.](lesson34.md)
  - [–õ–µ–∫—Ü–∏—è 35. Deployment](lesson35.md)
</details>

- [–õ–µ–∫—Ü–∏—è 36. –ú–µ—Ç–æ–¥–æ–ª–æ–≥–∏–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏. CI/CD. –ú–æ–Ω–æ–ª–∏—Ç –∏ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã. Docker](lesson36.md)


![](https://preview.redd.it/aom6ubb0b4e71.jpg?width=640&crop=smart&auto=webp&s=d9094222a89d1f8cb0f43285d4ff9c81f274cfee)

## –û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ ‚Äî —ç—Ç–æ –æ–≥—Ä–æ–º–Ω–∞—è, –Ω–µ—Ç **–û–ì–†–û–ú–ù–ê–Ø** —Ç–µ–º–∞, –Ω–∞—Å—Ç–æ–ª—å–∫–æ –æ–≥—Ä–æ–º–Ω–∞—è, —á—Ç–æ –ø–æ—Ä–æ–∂–¥–∞–µ—Ç –¥–≤–∞ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∫–ª–∞—Å—Å–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –≤
IT-–∏–Ω–¥—É—Å—Ç—Ä–∏–∏.

## –£—Ä–æ–≤–Ω–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

–ù–∞–ø–æ–º–Ω–∏–º —Å–µ–±–µ –ø—Ä–æ –ø–∏—Ä–∞–º–∏–¥—É —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

![](https://habrastorage.org/storage2/ec3/825/c7f/ec3825c7f0710f9fed6814c89b794ded.jpg)

–°—É—â–µ—Å—Ç–≤—É–µ—Ç 4 –æ—Å–Ω–æ–≤–Ω—ã—Ö —É—Ä–æ–≤–Ω—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞.

**–ú–æ–¥—É–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã (Unit Tests)** ‚Äî —ç—Ç–æ —Ç–µ—Å—Ç—ã, –ø—Ä–æ–≤–µ—Ä—è—é—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –º–æ–¥—É–ª—è –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞.
–ï—Å–ª–∏ –≤—ã –ø–µ—Ä–µ–ø–∏—Å–∞–ª–∏ –º–µ—Ç–æ–¥ `get_context_data()`, —Ç–æ —é–Ω–∏—Ç —Ç–µ—Å—Ç–æ–º –±—É–¥–µ—Ç –ø–æ–ø—ã—Ç–∫–∞ –≤—ã–∑–≤–∞—Ç—å —ç—Ç–æ—Ç –º–µ—Ç–æ–¥ —Å —Ä–∞–∑–Ω—ã–º–∏ –≤—Ö–æ–¥–Ω—ã–º–∏
–¥–∞–Ω–Ω—ã–º–∏, –∏ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –Ω–∞ —Ç–æ, —á—Ç–æ –≤–µ—Ä–Ω—ë—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç.

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã (Integration Tests)** ‚Äî —ç—Ç–æ –≤–∏–¥ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è, –∫–æ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã –±–µ–∑
—Å—Ç–æ—Ä–æ–Ω–Ω–∏—Ö —Å—Ä–µ–¥—Å—Ç–≤. –ù–∞–ø—Ä–∏–º–µ—Ä, –≤—ã –ø–µ—Ä–µ–ø–∏—Å–∞–ª–∏ –º–µ—Ç–æ–¥ `get_context_data()`, –≤—ã–ø–æ–ª–Ω—è–µ–º –∑–∞–ø—Ä–æ—Å –ø—Ä–∏ –ø–æ–º–æ—â–∏ –∫–æ–¥–∞, –∏ —Å–º–æ—Ç—Ä–∏–º,
–∏–∑–º–µ–Ω–∏–ª–∞—Å—å –ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è `context` –≤ –æ—Ç–≤–µ—Ç–µ –Ω–∞ –Ω–∞—à –∑–∞–ø—Ä–æ—Å.

**–ü—Ä–∏—ë–º–æ—á–Ω—ã–µ —Ç–µ—Å—Ç—ã (Acceptance Tests)** ‚Äî –≤–∏–¥ —Ç–µ—Å—Ç–æ–≤ —Å –ø–æ–ª–Ω–æ–π –∏–º–∏—Ç–∞—Ü–∏–µ–π –¥–µ–π—Å—Ç–≤–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –ü—Ä–∏ –ø–æ–º–æ—â–∏ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö
—Å—Ä–µ–¥—Å—Ç–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, Selenium) –º—ã –ø—Ä–æ–ø–∏—Å—ã–≤–∞–µ–º –∫–æ–¥ –æ—Ç–∫—Ä—ã—Ç–∏—è –±—Ä–∞—É–∑–µ—Ä–∞, –ø–æ–∏—Å–∫–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ, –∏–º–∏—Ç–∏—Ä—É–µ–º
–≤–≤–æ–¥ –¥–∞–Ω–Ω—ã—Ö, –Ω–∞–∂–∞—Ç–∏–µ –∫–Ω–æ–ø–æ–∫, –ø–µ—Ä–µ—Ö–æ–¥ –ø–æ —Å—Å—ã–ª–∫–∞–º –∏ —Ç. –¥.

**–†—É—á–Ω—ã–µ —Ç–µ—Å—Ç—ã (Manual Tests)** ‚Äî –≤–∏–¥ —Ç–µ—Å—Ç–æ–≤, –∫–æ–≥–¥–∞ –º—ã –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–æ–≤—Ç–æ—Ä—è–µ–º –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

### –ë–∞–∑–æ–≤—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏ unittest

–í—ã –∑–Ω–∞–µ—Ç–µ –æ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–∏ `unittest.TestCase`, –æ—Ç –∫–æ—Ç–æ—Ä–æ–≥–æ –Ω—É–∂–Ω–æ –Ω–∞—Å–ª–µ–¥–æ–≤–∞—Ç—å—Å—è, —á—Ç–æ–±—ã —Å–æ–∑–¥–∞—Ç—å –æ–±—ã—á–Ω—ã–π —Ç–µ—Å—Ç.

–£ –Ω–µ–≥–æ –º–æ–≥—É—Ç –±—ã—Ç—å –º–µ—Ç–æ–¥ `setUp()` –∏ `tearDown()` –¥–ª—è –æ–ø–∏—Å–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –¥–æ –∫–∞–∂–¥–æ–≥–æ —Ç–µ—Å—Ç–∞ –∏ –ø–æ—Å–ª–µ
—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ.

–ò –º–µ—Ç–æ–¥—ã, –Ω–∞—á–∏–Ω–∞—é—â–∏–µ—Å—è —Å–æ —Å–ª–æ–≤–∞ `test_`, –∫–æ—Ç–æ—Ä—ã–µ –æ–ø–∏—Å—ã–≤–∞—é—Ç —Å–∞–º–∏ —Ç–µ—Å—Ç—ã, –¥–ª—è —á–µ–≥–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ `assert` –∏–ª–∏
–æ—Å–Ω–æ–≤–∞–Ω–Ω—ã–µ –Ω–∞ –Ω—ë–º –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –º–µ—Ç–æ–¥—ã.

### –ò–µ—Ä–∞—Ä—Ö–∏—è —Ç–µ—Å—Ç-–∫–µ–π—Å–æ–≤ Django

–í —Ä–∞–º–∫–∞—Ö Django –µ—Å—Ç—å —Å–≤–æ–π —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π —Ç–µ—Å—Ç-–∫–µ–π—Å, –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–Ω—ã–π –æ—Ç –±–∞–∑–æ–≤–æ–≥–æ `unittest.TestCase`.

![](https://docs.djangoproject.com/en/stable/_images/django_unittest_classes_hierarchy.svg)

### SimpleTestCase

`SimpleTestCase` –Ω–∞—Å–ª–µ–¥—É–µ—Ç—Å—è –æ—Ç –±–∞–∑–æ–≤–æ–≥–æ.

#### –ß—Ç–æ –¥–æ–±–∞–≤–ª—è–µ—Ç?

–î–æ–±–∞–≤–ª—è–µ—Ç `settings.py` –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ç–µ—Å—Ç–∞ –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–µ—Ä–µ–ø–∏—Å–∞—Ç—å –∏–ª–∏ –∏–∑–º–µ–Ω–∏—Ç—å `settings.py` –¥–ª—è —Ç–µ—Å—Ç–∞.

–î–æ–±–∞–≤–ª—è–µ—Ç `Client`, –∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –Ω–∞–ø–∏—Å–∞–Ω–∏—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤ (—á–µ—Ä–µ–∑ –Ω–µ–≥–æ –º—ã –±—É–¥–µ–º –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –∑–∞–ø—Ä–æ—Å—ã).

–î–æ–±–∞–≤–ª—è–µ—Ç –Ω–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã `assert`:

`assertRedirects` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Ç–æ, —á—Ç–æ URL, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–π –º—ã –ø–æ–ø–∞–ª–∏, —Å–æ–≤–ø–∞–¥—ë—Ç —Å –æ–∂–∏–¥–∞–µ–º—ã–º.

`assertContains` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Ç–æ, —á—Ç–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç –æ–∂–∏–¥–∞–µ–º—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é.

`assertNotContains` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Ç–æ, —á—Ç–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –æ–∂–∏–¥–∞–µ–º—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é.

`assertFormError` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Ç–æ, —á—Ç–æ —Ñ–æ—Ä–º–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω—É–∂–Ω—É—é –æ—à–∏–±–∫—É.

`assertFormsetError` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Ç–æ, —á—Ç–æ formset —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω—É–∂–Ω—É—é –æ—à–∏–±–∫—É.

`assertTemplateUsed` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Ç–æ, —á—Ç–æ –±—ã–ª –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –æ–∂–∏–¥–∞–µ–º—ã–π —à–∞–±–ª–æ–Ω.

`assertTemplateNotUsed` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Ç–æ, —á—Ç–æ –Ω–µ –±—ã–ª –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –æ–∂–∏–¥–∞–µ–º—ã–π —à–∞–±–ª–æ–Ω.

`assertRaisesMessage` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Ç–æ, —á—Ç–æ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ.

`assertFieldOutput` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Ç–æ, —á—Ç–æ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–µ –ø–æ–ª–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –æ–∂–∏–¥–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ.

`assertHTMLEqual` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Ç–æ, —á—Ç–æ –ø–æ–ª—É—á–µ–Ω–Ω—ã–π HTML —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –æ–∂–∏–¥–∞–µ–º–æ–º—É.

`assertHTMLNotEqual` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Ç–æ, —á—Ç–æ –ø–æ–ª—É—á–µ–Ω–Ω—ã–π HTML –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –æ–∂–∏–¥–∞–µ–º–æ–º—É.

`assertJSONEqual` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Ç–æ, —á—Ç–æ –ø–æ–ª—É—á–µ–Ω–Ω—ã–π JSON —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –æ–∂–∏–¥–∞–µ–º–æ–º—É.

`assertJSONNotEqual` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Ç–æ, —á—Ç–æ –ø–æ–ª—É—á–µ–Ω–Ω—ã–π JSON –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –æ–∂–∏–¥–∞–µ–º–æ–º—É.

`assertXMLEqual` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Ç–æ, —á—Ç–æ –ø–æ–ª—É—á–µ–Ω–Ω—ã–π XML —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –æ–∂–∏–¥–∞–µ–º–æ–º—É.

`assertXMLNotEqual` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Ç–æ, —á—Ç–æ –ø–æ–ª—É—á–µ–Ω–Ω—ã–π XML –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –æ–∂–∏–¥–∞–µ–º–æ–º—É.

### TransactionTestCase

`TransactionTestCase` –Ω–∞—Å–ª–µ–¥—É–µ—Ç—Å—è –æ—Ç `SimpleTestCase`.

#### –ß—Ç–æ –¥–æ–±–∞–≤–ª—è–µ—Ç?

–î–æ–±–∞–≤–ª—è–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤—ã–ø–æ–ª–Ω—è—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –≤ —Ä–∞–º–∫–∞—Ö —Ç–µ—Å—Ç–∞.

–î–æ–±–∞–≤–ª—è–µ—Ç –∞—Ç—Ä–∏–±—É—Ç `fixtures` –¥–ª—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∑–∞–≥—Ä—É–∂–∞—Ç—å –±–∞–∑–æ–≤—ã–µ —É—Å–ª–æ–≤–∏—è —Ç–µ—Å—Ç–∞ –∏–∑ —Ñ–∏–∫—Å—Ç—É—Ä.

–î–æ–±–∞–≤–ª—è–µ—Ç –∞—Ç—Ä–∏–±—É—Ç `reset_sequences`, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–±—Ä–∞—Å—ã–≤–∞—Ç—å –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–µ—Å—Ç–∞ (–∫–∞–∂–¥—ã–π —Å–æ–∑–¥–∞–Ω–Ω—ã–π
–æ–±—ä–µ–∫—Ç –≤—Å–µ–≥–¥–∞ –±—É–¥–µ—Ç –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å id=1)

–î–æ–±–∞–≤–ª—è–µ—Ç –Ω–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã `assert`:

`assertQuerysetEqual` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Ç–æ, —á—Ç–æ –ø–æ–ª—É—á–µ–Ω–Ω—ã–π –∫–≤–µ—Ä–∏—Å–µ—Ç —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –æ–∂–∏–¥–∞–µ–º—ã–º.

`assertNumQueries` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Ç–æ, —á—Ç–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–µ–ª–∞–µ—Ç –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –±–∞–∑—É.

**–í–∞–∂–Ω–æ:** `TransactionTestCase` –∑–∞–º–µ—Ç–Ω–æ –º–µ–¥–ª–µ–Ω–Ω–µ–µ `TestCase`, —Ç–∞–∫ –∫–∞–∫ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—É—é –æ—á–∏—Å—Ç–∫—É –ë–î –º–µ–∂–¥—É —Ç–µ—Å—Ç–∞–º–∏.
–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –µ–≥–æ, –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∞–ª—å–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π (`commit`/`rollback`, `select_for_update`, –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –≤–Ω–µ—à–Ω–∏–º–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω—ã–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏).

### TestCase –∏–∑ –º–æ–¥—É–ª—è Django

`TestCase` –Ω–∞—Å–ª–µ–¥—É–µ—Ç—Å—è –æ—Ç `TransactionTestCase`.

#### –ß—Ç–æ –¥–æ–±–∞–≤–ª—è–µ—Ç?

–ü–æ —Å—É—Ç–∏ –Ω–∏—á–µ–≥–æ. :) –ù–µ–º–Ω–æ–≥–æ –ø–æ –¥—Ä—É–≥–æ–º—É –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –≤ –±–∞–∑—É (—Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –∞—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç–∏), –∏–∑-–∑–∞ —á–µ–≥–æ
–ø—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω–µ–µ.

–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –º–µ—Ç–æ–¥ `setUpTestData()` –¥–ª—è –æ–ø–∏—Å–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ç–µ—Å—Ç–∞. –ù–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π.

–≠—Ç–æ —Å–∞–º—ã–π —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –≤–∏–¥ —Ç–µ—Å—Ç–æ–≤.

**–ö–ª—é—á–µ–≤—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞ TestCase:**

- –ö–∞–∂–¥—ã–π —Ç–µ—Å—Ç –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏ –æ—Ç–∫–∞—Ç—ã–≤–∞–µ—Ç—Å—è (rollback) ‚Äî –±—ã—Å—Ç—Ä–æ –∏ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ.
- `setUpTestData()` –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑ –Ω–∞ –∫–ª–∞—Å—Å –∏ —ç–∫–æ–Ω–æ–º–∏—Ç –≤—Ä–µ–º—è –Ω–∞ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–µ –¥–∞–Ω–Ω—ã—Ö.
- –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `TransactionTestCase`.

### LiveServerTestCase

`LiveServerTestCase` –Ω–∞—Å–ª–µ–¥—É–µ—Ç—Å—è –æ—Ç `TransactionTestCase`.

#### –ß—Ç–æ –¥–æ–±–∞–≤–ª—è–µ—Ç?

–ó–∞–ø—É—Å–∫–∞–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä –¥–ª—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –æ—Ç–∫—Ä—ã—Ç—å –ø—Ä–æ–µ–∫—Ç –≤ –±—Ä–∞—É–∑–µ—Ä–µ. –ù–µ–æ–±—Ö–æ–¥–∏–º –¥–ª—è –Ω–∞–ø–∏—Å–∞–Ω–∏—è Acceptance Tests.

–ß–∞—â–µ –≤—Å–µ–≥–æ –≤ —Ç–∞–∫–∏—Ö —Ç–µ—Å—Ç–∞—Ö –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Å–µ—Ä–≤–µ—Ä –∏ –∏–º–∏—Ç–∞—Ü–∏—è –±—Ä–∞—É–∑–µ—Ä–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, Selenium).

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

–î–ª—è —Ç–µ—Å—Ç–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö, –∫–æ—Ç–æ—Ä–∞—è –±—É–¥–µ—Ç —É–∫–∞–∑–∞–Ω–∞ –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π `TEST` –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π `DATABASES` –≤
—Ñ–∞–π–ª–µ `settings.py`:

```python
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.postgresql',
        'USER': 'mydatabaseuser',
        'NAME': 'mydatabase',
        'TEST': {
            'NAME': 'mytestdatabase',
        },
    },
}
```

–≠—Ç–∞ –±–∞–∑–∞ –±—É–¥–µ—Ç –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ –ø—É—Å—Ç–∞—è –∏ –±—É–¥–µ—Ç –æ—á–∏—â–∞—Ç—å—Å—è –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–æ–≥–æ —Ç–µ—Å—Ç-–∫–µ–π—Å–∞.

**–í–∞—à —é–∑–µ—Ä –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å –ø—Ä–∞–≤–∞ –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ –∏ –æ—á–∏—Å—Ç–∫—É –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö**

> **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** Django –æ–±—ã—á–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—ë—Ç —Ç–µ—Å—Ç–æ–≤—É—é –ë–î (–Ω–∞–ø—Ä–∏–º–µ—Ä, `test_<NAME>` –¥–ª—è PostgreSQL). –Ø–≤–Ω–æ–µ —É–∫–∞–∑–∞–Ω–∏–µ `TEST.NAME` —Ç—Ä–µ–±—É–µ—Ç—Å—è —Ä–µ–¥–∫–æ; —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ë–î –µ—Å—Ç—å –ø—Ä–∞–≤–∞ –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ.

### –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤

–ù–µ—Å–º–æ—Ç—Ä—è –Ω–∞ —Ç–æ, —á—Ç–æ Django —Å–æ–∑–¥–∞—ë—Ç –¥–ª—è –Ω–∞—Å –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ —Ñ–∞–π–ª `tests.py`, –∏–º –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –ø–æ–ª—å–∑—É—é—Ç—Å—è.

–°—É—â–µ—Å—Ç–≤—É–µ—Ç –¥–≤–∞ —Å–∞–º—ã—Ö —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—ë–Ω–Ω—ã—Ö —Å–ø–æ—Å–æ–±–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç–µ—Å—Ç–æ–≤. –ï—Å–ª–∏ –≤–∞–º –ø–æ–≤–µ–∑–ª–æ –∏ –Ω–∞ –≤–∞—à–µ–º –ø—Ä–æ–µ–∫—Ç–µ –µ—Å—Ç—å —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ
—Ç–µ—Å—Ç–∏—Ä–æ–≤—â–∏–∫–∏, —Ç–æ –≤–∞—à–∞ –∑–∞–¥–∞—á–∞ ‚Äî —ç—Ç–æ —Ç–æ–ª—å–∫–æ —é–Ω–∏—Ç-—Ç–µ—Å—Ç—ã.

–ò —Ç–æ–≥–¥–∞ –≤ –ø–∞–ø–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Å–æ–∑–¥–∞—ë—Ç—Å—è –µ—â–µ –æ–¥–Ω–∞ –ø–∞–ø–∫–∞ `tests`, –≤ –∫–æ—Ç–æ—Ä–æ–π —É–∂–µ —Å–æ–∑–¥–∞—é—Ç—Å—è —Ñ–∞–π–ª—ã –¥–ª—è —Ç–µ—Å—Ç–æ–≤ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —á–∞—Å—Ç–µ–π,
–Ω–∞–ø—Ä–∏–º–µ—Ä, `test_models.py`, `test_forms.py` –∏ —Ç. –¥.

![](https://drive.google.com/uc?export=view&id=1E_Tf8H2spWJbSOaaxvWOMiLk4c0bgvUT)

–ï—Å–ª–∏ –≤–∞–º –Ω–µ –ø–æ–≤–µ–∑–ª–æ, –∏ –Ω–∞ –ø—Ä–æ–µ–∫—Ç–µ –≤—ã –∑–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ç–µ—Å—Ç–µ—Ä–æ–≤, —Ç–æ —Ç–æ–≥–¥–∞ –≤ —ç—Ç–æ–π –∂–µ –ø–∞–ø–∫–µ (`tests`) —Å–æ–∑–¥–∞—ë—Ç—Å—è –µ—â–µ 3
–ø–∞–ø–∫–∏ `unit`, `integration` –∏ `acceptance`, –∏ —É–∂–µ –≤ –Ω–∏—Ö –æ–ø–∏—Å—ã–≤–∞—é—Ç—Å—è —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Ç–µ—Å—Ç—ã.

> –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: –∑–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ pytest —Å–º. –≤ —Ñ–∏–Ω–∞–ª—å–Ω–æ–º —Ä–∞–∑–¥–µ–ª–µ ¬´–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞—Ä–∏–π: pytest –∏ pytest-django¬ª.

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

–î–ª—è –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è manage-–∫–æ–º–∞–Ω–¥–∞ `test`:

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏
$./manage.py test animals

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã –≤ –ø–∞–ø–∫–µ tests
$./manage.py test animals.tests

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –æ–¥–∏–Ω —Ç–µ—Å—Ç-–∫–µ–π—Å
$./manage.py test animals.tests.unit.test_models.AnimalTestCase

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –æ–¥–∏–Ω —Ç–µ—Å—Ç –∏–∑ —Ç–µ—Å—Ç-–∫–µ–π—Å–∞
$./manage.py test animals.tests.unit.test_models.AnimalTestCase.test_animals_can_speak
```

---
## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ Django ‚Äî –æ—Å–Ω–æ–≤—ã

–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: https://docs.djangoproject.com/en/stable/topics/testing/
–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã: https://docs.djangoproject.com/en/stable/topics/testing/tools/

### –û–±–∑–æ—Ä –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

| –¢–∏–ø —Ç–µ—Å—Ç–∞       | –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç                      | –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç                                  | –°–∫–æ—Ä–æ—Å—Ç—å     |
|-----------------|---------------------------------|------------------------------------------------|--------------|
| **Unit**        | `RequestFactory`                | –û—Ç–¥–µ–ª—å–Ω—ã–π –º–µ—Ç–æ–¥ view/–º–æ–¥–µ–ª–∏, –±–µ–∑ middleware    | ‚ö° –ë—ã—Å—Ç—Ä–æ     |
| **Integration** | `Client`                        | –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª –∑–∞–ø—Ä–æ—Å ‚Üí middleware ‚Üí view ‚Üí –æ—Ç–≤–µ—Ç | üê¢ –ú–µ–¥–ª–µ–Ω–Ω–µ–µ |
| **Acceptance**  | `LiveServerTestCase` + Selenium | –ë—Ä–∞—É–∑–µ—Ä + UI                                   | üêå –ú–µ–¥–ª–µ–Ω–Ω–æ  |

## Unit-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ Django

Unit-—Ç–µ—Å—Ç—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –≤ –∏–∑–æ–ª—è—Ü–∏–∏: –º–µ—Ç–æ–¥—ã –º–æ–¥–µ–ª–µ–π, –æ—Ç–¥–µ–ª—å–Ω—ã–µ view, —Ñ–æ—Ä–º—ã. –û–Ω–∏ –±—ã—Å—Ç—Ä—ã–µ –∏ –Ω–µ —Ç—Ä–µ–±—É—é—Ç –ø–æ–ª–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ –∑–∞–ø—Ä–æ—Å–∞.

### RequestFactory ‚Äî –∏–º–∏—Ç–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ –±–µ–∑ middleware

`RequestFactory` —Å–æ–∑–¥–∞—ë—Ç –æ–±—ä–µ–∫—Ç –∑–∞–ø—Ä–æ—Å–∞, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–Ω–æ –ø–µ—Ä–µ–¥–∞—Ç—å –Ω–∞–ø—Ä—è–º—É—é –≤–æ view. Middleware –∏ URL-–º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è **–Ω–µ —É—á–∞—Å—Ç–≤—É—é—Ç**: —ç—Ç–æ –¥–µ–ª–∞–µ—Ç —Ç–µ—Å—Ç—ã –±—ã—Å—Ç—Ä—ã–º–∏ –∏ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏.

```python
from django.contrib.auth.models import AnonymousUser, User
from django.test import RequestFactory, TestCase

from .views import MyView, my_view


class SimpleTest(TestCase):
    def setUp(self):
        self.factory = RequestFactory()
        self.user = User.objects.create_user(
            username='jacob', email='jacob@example.com', password='top_secret')

    def test_details(self):
        # –°–æ–∑–¥–∞—ë–º GET-–∑–∞–ø—Ä–æ—Å
        request = self.factory.get('/customer/details')

        # Middleware –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç ‚Äî —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º user –≤—Ä—É—á–Ω—É—é
        request.user = self.user

        # –ò–ª–∏ –∞–Ω–æ–Ω–∏–º–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
        request.user = AnonymousUser()

        # –í—ã–∑—ã–≤–∞–µ–º view –Ω–∞–ø—Ä—è–º—É—é (function-based)
        response = my_view(request)

        # –î–ª—è class-based views
        response = MyView.as_view()(request)

        self.assertEqual(response.status_code, 200)
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤ CBV

–î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤ –∫–ª–∞—Å—Å–∞ view –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–µ—Ç–æ–¥ `setup()`:

```python
from django.views.generic import TemplateView


class HomeView(TemplateView):
    template_name = 'myapp/home.html'

    def get_context_data(self, **kwargs):
        kwargs['environment'] = 'Production'
        return super().get_context_data(**kwargs)
```

```python
from django.test import RequestFactory, TestCase
from .views import HomeView


class HomePageTest(TestCase):
    def test_environment_set_in_context(self):
        request = RequestFactory().get('/')
        view = HomeView()
        view.setup(request)
        context = view.get_context_data()
        self.assertIn('environment', context)
```

### –ü—Ä–∏–º–µ—Ä unit-—Ç–µ—Å—Ç–∞ –º–æ–¥–µ–ª–∏

```python
from django.test import TestCase
from myapp.models import Animal


class AnimalTestCase(TestCase):
    def setUp(self):
        Animal.objects.create(name="lion", sound="roar")
        Animal.objects.create(name="cat", sound="meow")

    def test_animals_can_speak(self):
        """–ü—Ä–æ–≤–µ—Ä—è–µ–º –º–µ—Ç–æ–¥ speak() –º–æ–¥–µ–ª–∏ Animal"""
        lion = Animal.objects.get(name="lion")
        cat = Animal.objects.get(name="cat")
        self.assertEqual(lion.speak(), 'The lion says "roar"')
        self.assertEqual(cat.speak(), 'The cat says "meow"')
```

---

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ Django

–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª: –∑–∞–ø—Ä–æ—Å –ø—Ä–æ—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ URL-–º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—é, middleware, view –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—Ç–≤–µ—Ç.

### Client ‚Äî –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª –∑–∞–ø—Ä–æ—Å–∞

`Client` –∏–º–∏—Ç–∏—Ä—É–µ—Ç –±—Ä–∞—É–∑–µ—Ä –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç HTTP-–∑–∞–ø—Ä–æ—Å—ã —á–µ—Ä–µ–∑ –≤–µ—Å—å —Å—Ç–µ–∫ Django:

```python
from django.test import Client

c = Client()
response = c.post('/login/', {'username': 'john', 'password': 'smith'})
response.status_code
200
response = c.get('/customer/details/')
response.content
```

–¢–∞–∫–æ–π –∑–∞–ø—Ä–æ—Å –Ω–µ –±—É–¥–µ—Ç —Ç—Ä–µ–±–æ–≤–∞—Ç—å CSRF —Ç–æ–∫–µ–Ω (—Ö–æ—Ç—è —ç—Ç–æ —Ç–æ–∂–µ –º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å, –µ—Å–ª–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ).

–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –º–µ—Ç–æ–¥ `login()`

```python
c = Client()
c.login(username='fred', password='secret')
```

–ü–æ—Å–ª–µ —á–µ–≥–æ –∑–∞–ø—Ä–æ—Å—ã –±—É–¥—É—Ç –æ—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

–ú–µ—Ç–æ–¥ `force_login()`, –ø—Ä–∏–Ω–∏–º–∞—é—â–∏–π –æ–±—ä–µ–∫—Ç —é–∑–µ—Ä–∞, –∞ –Ω–µ –ª–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å.

–ú–µ—Ç–æ–¥ `logout()`, —á—Ç–æ –¥–µ–ª–∞–µ—Ç, –¥–æ–≥–∞–¥–∞–π—Ç–µ—Å—å —Å–∞–º–∏)

–ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ –∫–ª–∏–µ–Ω—Ç –ø—Ä–∏ –∂–µ–ª–∞–Ω–∏–∏ –º–æ–∂–Ω–æ –ø–µ—Ä–µ–ø–∏—Å–∞—Ç—å –ø–æ–¥ —Å–≤–æ–∏ –Ω—É–∂–¥—ã.

–ö–ª–∏–µ–Ω—Ç —Å—Ä–∞–∑—É –µ—Å—Ç—å –≤ —Ç–µ—Å—Ç –∫–µ–π—Å–µ, –µ–≥–æ –Ω–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —Å–æ–∑–¥–∞–≤–∞—Ç—å, –∫ –Ω–µ–º—É –º–æ–∂–Ω–æ –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è —á–µ—Ä–µ–∑ `self.client`.

```python
class SimpleTest(TestCase):
    def test_details(self):
        response = self.client.get('/customer/details/')
        self.assertEqual(response.status_code, 200)

    def test_index(self):
        response = self.client.get('/customer/index/')
        self.assertEqual(response.status_code, 200)
```

### –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∏–∫—Å—Ç—É—Ä

–í—Å—ë –æ—á–µ–Ω—å –ø—Ä–æ—Å—Ç–æ, –µ—Å–ª–∏ —É –≤–∞—Å –ª–µ–∂–∏—Ç —Ñ–∞–π–ª —Å —Ñ–∏–∫—Å—Ç—É—Ä–∞–º–∏, —Ç–æ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –µ–≥–æ –ø—Ä–æ—Å—Ç–æ —É–∫–∞–∑–∞—Ç—å –≤ –∞—Ç—Ä–∏–±—É—Ç–∞—Ö.

```python
from myapp.models import Animal


class AnimalTestCase(TestCase):
    fixtures = ['mammals.json', 'birds']

    def setUp(self):
        # Test definitions as before.
        call_setup_methods()

    def test_fluffy_animals(self):
        # A test that uses the fixtures.
        call_some_test_code()
```

–ó–∞–≥—Ä—É–∑—è—Ç—Å—è –¥–≤–∞ —Ñ–∞–π–ª–∞ —Ñ–∏–∫—Å—Ç—É—Ä: `mammals.json` –∏ `birds` (Django –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞–π–¥—ë—Ç `birds.json` –∏–ª–∏ `birds.yaml`).

### –¢–µ–≥–∏ –¥–ª—è —Ç–µ—Å—Ç–æ–≤

–°—É—â–µ—Å—Ç–≤—É–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–æ—Å—Ç–∞–≤–∏—Ç—å ¬´—Ç–µ–≥¬ª –Ω–∞ –∫–∞–∂–¥—ã–π —Ç–µ—Å—Ç, –∞ –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞—Ç—å —Ç–æ–ª—å–∫–æ —Ç–µ, —á—Ç–æ —Å –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–º —Ç–µ–≥–æ–º.

```python
from django.test import tag


class SampleTestCase(TestCase):

    @tag('fast')
    def test_fast(self):
        ...

    @tag('slow')
    def test_slow(self):
        ...

    @tag('slow', 'core')
    def test_slow_but_core(self):
        ...
```

–ò–ª–∏ –¥–∞–∂–µ —Ü–µ–ª—ã–π —Ç–µ—Å—Ç–∫–µ–π—Å:

```python
@tag('slow', 'core')
class SampleTestCase(TestCase):
    ...
```

–ü–æ—Å–ª–µ —á–µ–≥–æ –∑–∞–ø—É—Å–∫–∞—Ç—å —Å —É–∫–∞–∑–∞–Ω–∏–µ–º —Ç–µ–≥–∞.

```
./manage.py test --tag=fast
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ manage-–∫–æ–º–∞–Ω–¥

–î–ª—è —ç—Ç–æ–≥–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π –º–µ—Ç–æ–¥ `call_command()`:

```python
from io import StringIO
from django.core.management import call_command
from django.test import TestCase


class ClosePollTest(TestCase):
    def test_command_output(self):
        out = StringIO()
        call_command('closepoll', stdout=out)
        self.assertIn('Expected output', out.getvalue())
```

---

## Acceptance-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ Django

Acceptance-—Ç–µ—Å—Ç—ã (–ø—Ä–∏—ë–º–æ—á–Ω—ã–µ) –∏–º–∏—Ç–∏—Ä—É—é—Ç —Ä–µ–∞–ª—å–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: –æ—Ç–∫—Ä—ã—Ç–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü, –∫–ª–∏–∫–∏, –≤–≤–æ–¥ —Ç–µ–∫—Å—Ç–∞, –ø—Ä–æ–≤–µ—Ä–∫—É –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤. –≠—Ç–æ —Å–∞–º—ã–π –º–µ–¥–ª–µ–Ω–Ω—ã–π, –Ω–æ –∏ —Å–∞–º—ã–π ¬´—á–µ—Å—Ç–Ω—ã–π¬ª —É—Ä–æ–≤–µ–Ω—å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è ‚Äî –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —Ç–æ, —á—Ç–æ –≤–∏–¥–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å.

### WebDriver –∏ Selenium

**WebDriver** ‚Äî —ç—Ç–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π API –¥–ª—è –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±—Ä–∞—É–∑–µ—Ä–æ–º. –ü–æ–∑–≤–æ–ª—è–µ—Ç –æ—Ç–∫—Ä—ã–≤–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—ã, –∫–ª–∏–∫–∞—Ç—å –ø–æ —ç–ª–µ–º–µ–Ω—Ç–∞–º, –∑–∞–ø–æ–ª–Ω—è—Ç—å —Ñ–æ—Ä–º—ã –∏ –ø—Ä–æ–≤–µ—Ä—è—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç.

**Selenium** ‚Äî –ø–æ–ø—É–ª—è—Ä–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞, —Ä–µ–∞–ª–∏–∑—É—é—â–∞—è WebDriver –¥–ª—è Python.

```bash
pip install selenium
```

–¢–∞–∫–∂–µ –Ω—É–∂–µ–Ω –¥—Ä–∞–π–≤–µ—Ä –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –±—Ä–∞—É–∑–µ—Ä–∞:
- Chrome ‚Üí `chromedriver`
- Firefox ‚Üí `geckodriver`
- Edge ‚Üí `msedgedriver`

> **–°–æ–≤–µ—Ç:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `webdriver-manager` –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –¥—Ä–∞–π–≤–µ—Ä–æ–≤:
> ```bash
> pip install webdriver-manager
> ```

### LiveServerTestCase + Selenium

`LiveServerTestCase` –∑–∞–ø—É—Å–∫–∞–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–π Django-—Å–µ—Ä–≤–µ—Ä –Ω–∞ —Å–ª—É—á–∞–π–Ω–æ–º –ø–æ—Ä—Ç—É, –∫ –∫–æ—Ç–æ—Ä–æ–º—É –º–æ–∂–Ω–æ –æ–±—Ä–∞—â–∞—Ç—å—Å—è —á–µ—Ä–µ–∑ Selenium:

```python
from django.contrib.auth.models import User
from django.test import LiveServerTestCase
from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.chrome.service import Service
from webdriver_manager.chrome import ChromeDriverManager


class LoginAcceptanceTest(LiveServerTestCase):
    @classmethod
    def setUpClass(cls):
        super().setUpClass()
        # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ chromedriver
        cls.browser = webdriver.Chrome(
            service=Service(ChromeDriverManager().install())
        )
        cls.browser.implicitly_wait(5)  # –û–∂–∏–¥–∞–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –¥–æ 5 —Å–µ–∫

    @classmethod
    def tearDownClass(cls):
        cls.browser.quit()
        super().tearDownClass()

    def setUp(self):
        self.user = User.objects.create_user('john', password='secret123')

    def test_login_page_loads(self):
        """–ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ª–æ–≥–∏–Ω–∞ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è"""
        self.browser.get(f'{self.live_server_url}/login/')
        self.assertIn('Login', self.browser.title)

    def test_user_can_login(self):
        """–ü–æ–ª–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ª–æ–≥–∏–Ω–∏—Ç—Å—è –∏ –ø–æ–ø–∞–¥–∞–µ—Ç –Ω–∞ –≥–ª–∞–≤–Ω—É—é"""
        self.browser.get(f'{self.live_server_url}/login/')

        # –ó–∞–ø–æ–ª–Ω—è–µ–º —Ñ–æ—Ä–º—É
        self.browser.find_element(By.NAME, 'username').send_keys('john')
        self.browser.find_element(By.NAME, 'password').send_keys('secret123')
        self.browser.find_element(By.CSS_SELECTOR, 'button[type="submit"]').click()

        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
        self.assertIn('Dashboard', self.browser.title)
        welcome = self.browser.find_element(By.CLASS_NAME, 'welcome-message')
        self.assertIn('john', welcome.text)
```

### –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Acceptance-—Ç–µ—Å—Ç—ã

| ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥–ª—è                          | ‚ùå –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥–ª—è     |
|--------------------------------------------|--------------------------|
| –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ (—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è, –æ–ø–ª–∞—Ç–∞) | –ü—Ä–æ–≤–µ—Ä–∫–∏ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏   |
| –°–ª–æ–∂–Ω—ã–µ JS-–≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è                  | –í–∞–ª–∏–¥–∞—Ü–∏–∏ —Ñ–æ—Ä–º           |
| Smoke-—Ç–µ—Å—Ç—ã –ø–µ—Ä–µ–¥ —Ä–µ–ª–∏–∑–æ–º                  | –ü–æ–∫—Ä—ã—Ç–∏—è –≤—Å–µ—Ö edge-cases |

> **–í–∞–∂–Ω–æ:** Acceptance-—Ç–µ—Å—Ç—ã –º–µ–¥–ª–µ–Ω–Ω—ã–µ –∏ —Ö—Ä—É–ø–∫–∏–µ (–ª–æ–º–∞—é—Ç—Å—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –≤—ë—Ä—Å—Ç–∫–∏). –î–µ—Ä–∂–∏—Ç–µ –∏—Ö –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º ‚Äî —Ç–æ–ª—å–∫–æ –¥–ª—è —Å–∞–º—ã—Ö –≤–∞–∂–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤.

---

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ REST API (DRF)

–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: https://www.django-rest-framework.org/api-guide/testing/

### –û–±–∑–æ—Ä –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ DRF

| –¢–∏–ø —Ç–µ—Å—Ç–∞       | –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç                  | –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç                         | –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å          |
|-----------------|-----------------------------|---------------------------------------|-----------------------------|
| **Unit**        | `APIRequestFactory`         | View, serializer, permission –æ—Ç–¥–µ–ª—å–Ω–æ | –ë—ã—Å—Ç—Ä—ã–µ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã |
| **Integration** | `APIClient` / `APITestCase` | Endpoint —á–µ—Ä–µ–∑ URLConf –∏ middleware   | –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ API  |

### Unit-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API

#### APIRequestFactory

`APIRequestFactory` ‚Äî –∞–Ω–∞–ª–æ–≥ Django `RequestFactory` –¥–ª—è DRF. –°–æ–∑–¥–∞—ë—Ç –æ–±—ä–µ–∫—Ç –∑–∞–ø—Ä–æ—Å–∞ –±–µ–∑ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è —á–µ—Ä–µ–∑ URL-–º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—é –∏ middleware.

```python
from rest_framework.test import APIRequestFactory

factory = APIRequestFactory()
request = factory.post('/api/articles/', {'title': '–ù–æ–≤–∞—è —Å—Ç–∞—Ç—å—è'})
```

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ñ–æ—Ä–º–∞—Ç `multipart` (–∫–∞–∫ HTML-—Ñ–æ—Ä–º–∞). –î–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ JSON –Ω—É–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å —è–≤–Ω–æ:

```python
factory = APIRequestFactory()
request = factory.post('/api/articles/', {'title': '–ù–æ–≤–∞—è —Å—Ç–∞—Ç—å—è'}, format='json')
```

–ò–ª–∏ —É–∫–∞–∑–∞—Ç—å content-type –Ω–∞–ø—Ä—è–º—É—é:

```python
import json
request = factory.post('/api/articles/', json.dumps({'title': '–ù–æ–≤–∞—è —Å—Ç–∞—Ç—å—è'}), content_type='application/json')
```

#### force_authenticate()

–î–ª—è unit-—Ç–µ—Å—Ç–æ–≤ –Ω–µ –Ω—É–∂–Ω–æ –ø—Ä–æ—Ö–æ–¥–∏—Ç—å —Ä–µ–∞–ª—å–Ω—É—é –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `force_authenticate()`:

```python
from rest_framework.test import APIRequestFactory, force_authenticate
from django.contrib.auth.models import User
from .views import ArticleViewSet


factory = APIRequestFactory()
user = User.objects.get(username='author')
view = ArticleViewSet.as_view({'get': 'retrieve'})

request = factory.get('/api/articles/1/')
force_authenticate(request, user=user)
response = view(request, pk=1)
```

#### –ü—Ä–∏–º–µ—Ä unit-—Ç–µ—Å—Ç–∞ view

```python
from django.contrib.auth.models import User
from rest_framework.test import APIRequestFactory, force_authenticate, APITestCase
from .views import ArticleViewSet
from .models import Article


class ArticleViewUnitTest(APITestCase):
    def setUp(self):
        self.factory = APIRequestFactory()
        self.user = User.objects.create_user('author', password='testpass')
        self.article = Article.objects.create(
            title='–¢–µ—Å—Ç–æ–≤–∞—è —Å—Ç–∞—Ç—å—è',
            slug='testovaya-statya',
            content='–°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Å—Ç–∞—Ç—å–∏',
            author=self.user,
            status='published'
        )

    def test_retrieve_returns_article(self):
        """Unit-—Ç–µ—Å—Ç: –ø—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–ª—å–∫–æ –º–µ—Ç–æ–¥ retrieve"""
        view = ArticleViewSet.as_view({'get': 'retrieve'})
        request = self.factory.get(f'/api/articles/{self.article.pk}/')
        force_authenticate(request, user=self.user)

        response = view(request, pk=self.article.pk)

        self.assertEqual(response.status_code, 200)
        self.assertEqual(response.data['title'], '–¢–µ—Å—Ç–æ–≤–∞—è —Å—Ç–∞—Ç—å—è')
```

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API

#### APIClient

`APIClient` ‚Äî –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π HTTP-–∫–ª–∏–µ–Ω—Ç –¥–ª—è DRF. –ó–∞–ø—Ä–æ—Å—ã –ø—Ä–æ—Ö–æ–¥—è—Ç —á–µ—Ä–µ–∑ URL-–º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—é –∏ middleware.

```python
from rest_framework.test import APIClient

client = APIClient()
response = client.post('/api/articles/', {'title': '–ù–æ–≤–∞—è —Å—Ç–∞—Ç—å—è'}, format='json')
```

#### APITestCase

–£–¥–æ–±–Ω—ã–π –±–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å, –∫–æ–º–±–∏–Ω–∏—Ä—É—é—â–∏–π `TestCase` –∏ `APIClient`:

```python
from django.contrib.auth.models import User
from rest_framework.test import APITestCase
from rest_framework import status
from django.urls import reverse
from .models import Article


class ArticleIntegrationTests(APITestCase):
    def test_list_articles_anonymous(self):
        """–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ç–µ—Å—Ç: –∞–Ω–æ–Ω–∏–º–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —Å–ø–∏—Å–æ–∫ —Å—Ç–∞—Ç–µ–π"""
        url = reverse('article-list')
        response = self.client.get(url)
        self.assertEqual(response.status_code, status.HTTP_200_OK)

    def test_create_article_authenticated(self):
        """–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ç–µ—Å—Ç: —Å–æ–∑–¥–∞–Ω–∏–µ —Å—Ç–∞—Ç—å–∏ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º"""
        user = User.objects.create_user('author', password='testpass')
        self.client.force_authenticate(user=user)

        url = reverse('article-list')
        data = {
            'title': '–ù–æ–≤–∞—è —Å—Ç–∞—Ç—å—è',
            'slug': 'novaya-statya',
            'content': '–°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Å—Ç–∞—Ç—å–∏',
            'status': 'draft'
        }
        response = self.client.post(url, data, format='json')

        self.assertEqual(response.status_code, status.HTTP_201_CREATED)
        self.assertEqual(Article.objects.count(), 1)
        self.assertEqual(Article.objects.first().author, user)
```

#### –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ APIClient

`APIClient` –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–ø–æ—Å–æ–±–æ–≤ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:

```python
from rest_framework.test import APIClient

client = APIClient()

# –°–ø–æ—Å–æ–± 1: login (session-based)
client.login(username='lauren', password='secret')

# –°–ø–æ—Å–æ–± 2: force_authenticate (–±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–∞—Ä–æ–ª—è)
client.force_authenticate(user=user)

# –°–ø–æ—Å–æ–± 3: credentials (–¥–ª—è token/JWT)
from rest_framework.authtoken.models import Token
token = Token.objects.get(user__username='lauren')
client.credentials(HTTP_AUTHORIZATION='Token ' + token.key)

# –°–ø–æ—Å–æ–± 4: logout (—Å–±—Ä–æ—Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏)
client.logout()
```

#### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏

–î–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –≤ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ:

```python
client = APIClient()
client.get('/api/articles/', HTTP_X_CUSTOM_HEADER='value')
```

#### CSRF –≤ —Ç–µ—Å—Ç–∞—Ö

–î–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ CSRF:

```python
client = APIClient(enforce_csrf_checks=True)
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∏ DRF –¥–ª—è —Ç–µ—Å—Ç–æ–≤

–ú–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è —Ç–µ—Å—Ç–æ–≤ –≤ `settings.py`:

```python
REST_FRAMEWORK = {
    'TEST_REQUEST_DEFAULT_FORMAT': 'json',
    'TEST_REQUEST_RENDERER_CLASSES': [
        'rest_framework.renderers.MultiPartRenderer',
        'rest_framework.renderers.JSONRenderer',
    ]
}
```

---

## –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö

–°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤—Ä—É—á–Ω—É—é –≤ `setUp()` –∑–∞–Ω–∏–º–∞–µ—Ç –º–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –∏ –¥–µ–ª–∞–µ—Ç —Ç–µ—Å—Ç—ã –≥—Ä–æ–º–æ–∑–¥–∫–∏–º–∏. –î–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏.

### FactoryBoy

–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: https://factoryboy.readthedocs.io/

```bash
pip install factory_boy
```

FactoryBoy ‚Äî –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤. –ü–æ–∑–≤–æ–ª—è–µ—Ç –æ–ø–∏—Å–∞—Ç—å ¬´—à–∞–±–ª–æ–Ω¬ª –æ–±—ä–µ–∫—Ç–∞ –∏ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —ç–∫–∑–µ–º–ø–ª—è—Ä—ã —Å –Ω—É–∂–Ω—ã–º–∏ –≤–∞—Ä–∏–∞—Ü–∏—è–º–∏.

#### –ë–∞–∑–æ–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

```python
import factory
from app.models import User


class UserFactory(factory.Factory):
    class Meta:
        model = User

    firstname = "John"
    lastname = "Doe"
```

```python
>>> john = UserFactory()
<User: John Doe>
>>> jack = UserFactory(firstname="Jack")
<User: Jack Doe>
```

#### DjangoModelFactory (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è Django)

–î–ª—è –º–æ–¥–µ–ª–µ–π Django –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `DjangoModelFactory` ‚Äî –æ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –æ–±—ä–µ–∫—Ç—ã –≤ –ë–î:

```python
import factory
from factory.django import DjangoModelFactory
from django.contrib.auth import get_user_model

User = get_user_model()


class UserFactory(DjangoModelFactory):
    class Meta:
        model = User

    username = factory.Sequence(lambda n: f"user{n}")
    email = factory.LazyAttribute(lambda o: f"{o.username}@example.com")
```

#### SubFactory: —Å–≤—è–∑–∏ –º–µ–∂–¥—É –º–æ–¥–µ–ª—è–º–∏

–î–ª—è —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `SubFactory`:

```python
class PurchaseFactory(DjangoModelFactory):
    class Meta:
        model = Purchase

    owner = factory.SubFactory(UserFactory)
```

```python
>>> purchase = PurchaseFactory()
<Purchase: 1 John Doe>
>>> purchase.owner
<User: user0>
```

> **–í–∞–∂–Ω–æ:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `factory.SubFactory()`, –∞ –Ω–µ –ø—Ä—è–º–æ–π –≤—ã–∑–æ–≤ —Ñ–∞–±—Ä–∏–∫–∏. –ò–Ω–∞—á–µ –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ –æ–±—ä–µ–∫—Ç –¥–ª—è –≤—Å–µ—Ö —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤.

#### –ù–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ —Ñ–∞–±—Ä–∏–∫

–ú–æ–∂–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ–∞–±—Ä–∏–∫–∏:

```python
class EnglishUserFactory(UserFactory):
    firstname = "John"
    lastname = "Doe"
    lang = 'en'


class FrenchUserFactory(UserFactory):
    firstname = "Jean"
    lastname = "Dupont"
    lang = 'fr'
```

#### Sequence: —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è

–î–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `Sequence`:

```python
class UserFactory(DjangoModelFactory):
    class Meta:
        model = User

    username = factory.Sequence(lambda n: f'user{n}')
```

#### LazyFunction: –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è

–î–ª—è –∑–Ω–∞—á–µ–Ω–∏–π, –≤—ã—á–∏—Å–ª—è–µ–º—ã—Ö –≤ –º–æ–º–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω–∏—è –æ–±—ä–µ–∫—Ç–∞:

```python
from datetime import datetime


class LogFactory(DjangoModelFactory):
    class Meta:
        model = Log

    timestamp = factory.LazyFunction(datetime.now)
```

```python
>>> LogFactory()
<Log: log at 2016-02-12 17:02:34>
>>> LogFactory(timestamp=datetime.now() - timedelta(days=1))  # –º–æ–∂–Ω–æ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å
<Log: log at 2016-02-11 17:02:34>
```

#### LazyAttribute: –∑–∞–≤–∏—Å–∏–º—ã–µ –ø–æ–ª—è

–î–ª—è –ø–æ–ª–µ–π, –∑–∞–≤–∏—Å—è—â–∏—Ö –æ—Ç –¥—Ä—É–≥–∏—Ö –ø–æ–ª–µ–π –æ–±—ä–µ–∫—Ç–∞:

```python
class UserFactory(DjangoModelFactory):
    class Meta:
        model = User

    username = factory.Sequence(lambda n: f'user{n}')
    email = factory.LazyAttribute(lambda obj: f'{obj.username}@example.com')
```

```python
>>> UserFactory()
<User: user1 (user1@example.com)>
>>> UserFactory(username='john')
<User: john (john@example.com)>
```

### Faker

–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: https://faker.readthedocs.io/

```bash
pip install Faker
```

Faker –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ: –∏–º–µ–Ω–∞, –∞–¥—Ä–µ—Å–∞, —Ç–µ–∫—Å—Ç—ã, –¥–∞—Ç—ã –∏ –º–Ω–æ–≥–æ–µ –¥—Ä—É–≥–æ–µ.

#### –ë–∞–∑–æ–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

```python
from faker import Faker

fake = Faker()

fake.name()       # 'Lucy Cechtelar'
fake.address()    # '426 Jordy Lodge\nCartwrightshire, SC 88120-6700'
fake.email()      # 'john.doe@example.com'
fake.text()       # –°–ª—É—á–∞–π–Ω—ã–π —Ç–µ–∫—Å—Ç
```

#### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å FactoryBoy

Faker –æ—Ç–ª–∏—á–Ω–æ –∏–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ—Ç—Å—è —Å FactoryBoy —á–µ—Ä–µ–∑ `factory.Faker`:

```python
import factory
from factory.django import DjangoModelFactory
from django.utils.text import slugify
from blog.models import Article


class ArticleFactory(DjangoModelFactory):
    class Meta:
        model = Article

    title = factory.Faker('sentence', nb_words=5)
    slug = factory.LazyAttribute(lambda o: slugify(o.title))
    content = factory.Faker('paragraphs', nb=3, ext_word_list=None)
    status = 'published'
    author = factory.SubFactory('blog.tests.factories.UserFactory')
```

### –§–∞–±—Ä–∏–∫–∏ –¥–ª—è –º–æ–¥–µ–ª–µ–π –±–ª–æ–≥–∞

–°–æ–∑–¥–∞–¥–∏–º –ø–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä —Ñ–∞–±—Ä–∏–∫ –¥–ª—è –Ω–∞—à–µ–≥–æ –±–ª–æ–≥–∞:

```python
# blog/tests/factories.py
import factory
from factory.django import DjangoModelFactory
from django.contrib.auth import get_user_model
from django.utils.text import slugify
from blog.models import Article, Topic, Comment

User = get_user_model()


class UserFactory(DjangoModelFactory):
    """–§–∞–±—Ä–∏–∫–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π"""
    class Meta:
        model = User

    username = factory.Sequence(lambda n: f'user{n}')
    email = factory.LazyAttribute(lambda o: f'{o.username}@example.com')
    password = factory.PostGenerationMethodCall('set_password', 'testpass123')


class TopicFactory(DjangoModelFactory):
    """–§–∞–±—Ä–∏–∫–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–µ–º"""
    class Meta:
        model = Topic

    name = factory.Sequence(lambda n: f'–¢–µ–º–∞ {n}')


class ArticleFactory(DjangoModelFactory):
    """–§–∞–±—Ä–∏–∫–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å—Ç–∞—Ç–µ–π"""
    class Meta:
        model = Article

    title = factory.Faker('sentence', nb_words=5, locale='ru_RU')
    slug = factory.LazyAttribute(lambda o: slugify(o.title))
    content = factory.Faker('text', max_nb_chars=500, locale='ru_RU')
    status = 'published'
    author = factory.SubFactory(UserFactory)

    @factory.post_generation
    def topics(self, create, extracted, **kwargs):
        """–î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–µ–º –∫ —Å—Ç–∞—Ç—å–µ (ManyToMany)"""
        if not create:
            return
        if extracted:
            for topic in extracted:
                self.topics.add(topic)


class CommentFactory(DjangoModelFactory):
    """–§–∞–±—Ä–∏–∫–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤"""
    class Meta:
        model = Comment

    text = factory.Faker('paragraph', nb_sentences=2, locale='ru_RU')
    author = factory.SubFactory(UserFactory)
    article = factory.SubFactory(ArticleFactory)
```

#### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ñ–∞–±—Ä–∏–∫ –≤ —Ç–µ—Å—Ç–∞—Ö

```python
from blog.tests.factories import ArticleFactory, TopicFactory, UserFactory


class ArticleTests(APITestCase):
    def setUp(self):
        self.author = UserFactory()
        self.topic = TopicFactory(name='Python')
        # –°—Ç–∞—Ç—å—è —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º –∞–≤—Ç–æ—Ä–æ–º –∏ —Ç–µ–º–æ–π
        self.article = ArticleFactory(
            author=self.author,
            topics=[self.topic]
        )

    def test_article_has_author(self):
        self.assertEqual(self.article.author, self.author)

    def test_article_has_topic(self):
        self.assertIn(self.topic, self.article.topics.all())
```

#### –°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ–∞–±—Ä–∏–∫–∏

```python
class DraftArticleFactory(ArticleFactory):
    """–§–∞–±—Ä–∏–∫–∞ –¥–ª—è —á–µ—Ä–Ω–æ–≤–∏–∫–æ–≤"""
    status = 'draft'


class PublishedArticleFactory(ArticleFactory):
    """–§–∞–±—Ä–∏–∫–∞ –¥–ª—è –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω—ã—Ö —Å—Ç–∞—Ç–µ–π"""
    status = 'published'
```

---

## –ü–æ–ª–Ω—ã–π –ø—Ä–∏–º–µ—Ä: —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ ArticleViewSet

–°–æ–±–µ—Ä—ë–º –≤—Å—ë –≤–º–µ—Å—Ç–µ ‚Äî –ø–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä —Ç–µ—Å—Ç–æ–≤ –¥–ª—è API —Å—Ç–∞—Ç–µ–π –±–ª–æ–≥–∞.

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤

```
blog/
‚îú‚îÄ‚îÄ tests/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ factories.py          # –§–∞–±—Ä–∏–∫–∏ (—Å–º. –≤—ã—à–µ)
‚îÇ   ‚îú‚îÄ‚îÄ test_models.py        # Unit-—Ç–µ—Å—Ç—ã –º–æ–¥–µ–ª–µ–π
‚îÇ   ‚îú‚îÄ‚îÄ test_serializers.py   # Unit-—Ç–µ—Å—Ç—ã —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ç–æ—Ä–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ test_views.py         # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã API
```

### –¢–µ—Å—Ç—ã CRUD –æ–ø–µ—Ä–∞—Ü–∏–π

```python
# blog/tests/test_views.py
from django.urls import reverse
from rest_framework import status
from rest_framework.test import APITestCase
from blog.tests.factories import ArticleFactory, UserFactory, TopicFactory
from blog.models import Article


class ArticleCRUDTests(APITestCase):
    """–¢–µ—Å—Ç—ã CRUD –æ–ø–µ—Ä–∞—Ü–∏–π –¥–ª—è —Å—Ç–∞—Ç–µ–π"""

    def setUp(self):
        self.author = UserFactory()
        self.other_user = UserFactory()
        self.topic = TopicFactory(name='Django')
        self.article = ArticleFactory(author=self.author, topics=[self.topic])

    # === CREATE ===
    def test_create_article_authenticated(self):
        """–ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞—Ç—å —Å—Ç–∞—Ç—å—é"""
        self.client.force_authenticate(user=self.author)
        url = reverse('article-list')
        data = {
            'title': '–ù–æ–≤–∞—è —Å—Ç–∞—Ç—å—è',
            'slug': 'novaya-statya',
            'content': '–°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Å—Ç–∞—Ç—å–∏',
            'status': 'draft'
        }

        response = self.client.post(url, data, format='json')

        self.assertEqual(response.status_code, status.HTTP_201_CREATED)
        self.assertEqual(Article.objects.count(), 2)
        new_article = Article.objects.get(slug='novaya-statya')
        self.assertEqual(new_article.author, self.author)

    def test_create_article_anonymous_forbidden(self):
        """–ê–Ω–æ–Ω–∏–º–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞—Ç—å —Å—Ç–∞—Ç—å—é"""
        url = reverse('article-list')
        data = {'title': '–°—Ç–∞—Ç—å—è', 'slug': 'statya', 'content': '–¢–µ–∫—Å—Ç'}

        response = self.client.post(url, data, format='json')

        self.assertEqual(response.status_code, status.HTTP_401_UNAUTHORIZED)

    # === READ ===
    def test_list_articles_anonymous(self):
        """–ê–Ω–æ–Ω–∏–º–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —Å–ø–∏—Å–æ–∫ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω—ã—Ö —Å—Ç–∞—Ç–µ–π"""
        ArticleFactory(status='draft', author=self.author)  # –ß–µ—Ä–Ω–æ–≤–∏–∫
        ArticleFactory(status='published', author=self.author)  # –û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–∞

        url = reverse('article-list')
        response = self.client.get(url)

        self.assertEqual(response.status_code, status.HTTP_200_OK)
        # –í–∏–¥–∏–º —Ç–æ–ª—å–∫–æ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω—ã–µ (1 –∏–∑ setUp + 1 –Ω–æ–≤–∞—è)
        self.assertEqual(len(response.data['results']), 2)

    def test_retrieve_article(self):
        """–ü–æ–ª—É—á–µ–Ω–∏–µ –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å—Ç–∞—Ç—å–µ"""
        url = reverse('article-detail', kwargs={'pk': self.article.pk})

        response = self.client.get(url)

        self.assertEqual(response.status_code, status.HTTP_200_OK)
        self.assertEqual(response.data['title'], self.article.title)

    # === UPDATE ===
    def test_update_own_article(self):
        """–ê–≤—Ç–æ—Ä –º–æ–∂–µ—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–≤–æ—é —Å—Ç–∞—Ç—å—é"""
        self.client.force_authenticate(user=self.author)
        url = reverse('article-detail', kwargs={'pk': self.article.pk})
        data = {'title': '–û–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫'}

        response = self.client.patch(url, data, format='json')

        self.assertEqual(response.status_code, status.HTTP_200_OK)
        self.article.refresh_from_db()
        self.assertEqual(self.article.title, '–û–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫')

    def test_update_other_user_article_forbidden(self):
        """–î—Ä—É–≥–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –º–æ–∂–µ—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —á—É–∂—É—é —Å—Ç–∞—Ç—å—é"""
        self.client.force_authenticate(user=self.other_user)
        url = reverse('article-detail', kwargs={'pk': self.article.pk})
        data = {'title': '–ü–æ–ø—ã—Ç–∫–∞ –∏–∑–º–µ–Ω–∏—Ç—å'}

        response = self.client.patch(url, data, format='json')

        self.assertEqual(response.status_code, status.HTTP_403_FORBIDDEN)

    # === DELETE ===
    def test_delete_own_article(self):
        """–ê–≤—Ç–æ—Ä –º–æ–∂–µ—Ç —É–¥–∞–ª–∏—Ç—å —Å–≤–æ—é —Å—Ç–∞—Ç—å—é"""
        self.client.force_authenticate(user=self.author)
        url = reverse('article-detail', kwargs={'pk': self.article.pk})

        response = self.client.delete(url)

        self.assertEqual(response.status_code, status.HTTP_204_NO_CONTENT)
        self.assertFalse(Article.objects.filter(pk=self.article.pk).exists())

    def test_delete_other_user_article_forbidden(self):
        """–î—Ä—É–≥–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –º–æ–∂–µ—Ç —É–¥–∞–ª–∏—Ç—å —á—É–∂—É—é —Å—Ç–∞—Ç—å—é"""
        self.client.force_authenticate(user=self.other_user)
        url = reverse('article-detail', kwargs={'pk': self.article.pk})

        response = self.client.delete(url)

        self.assertEqual(response.status_code, status.HTTP_403_FORBIDDEN)
```

### –¢–µ—Å—Ç—ã Permissions

```python
class ArticlePermissionTests(APITestCase):
    """–¢–µ—Å—Ç—ã –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞"""

    def setUp(self):
        self.author = UserFactory()
        self.admin = UserFactory(is_staff=True)
        self.draft = ArticleFactory(author=self.author, status='draft')
        self.published = ArticleFactory(author=self.author, status='published')

    def test_draft_visible_only_to_author(self):
        """–ß–µ—Ä–Ω–æ–≤–∏–∫ –≤–∏–¥–µ–Ω —Ç–æ–ª—å–∫–æ –∞–≤—Ç–æ—Ä—É"""
        url = reverse('article-detail', kwargs={'pk': self.draft.pk})

        # –ê–Ω–æ–Ω–∏–º–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Äî 404
        response = self.client.get(url)
        self.assertEqual(response.status_code, status.HTTP_404_NOT_FOUND)

        # –ê–≤—Ç–æ—Ä ‚Äî 200
        self.client.force_authenticate(user=self.author)
        response = self.client.get(url)
        self.assertEqual(response.status_code, status.HTTP_200_OK)

    def test_admin_can_delete_any_article(self):
        """–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç —É–¥–∞–ª–∏—Ç—å –ª—é–±—É—é —Å—Ç–∞—Ç—å—é"""
        self.client.force_authenticate(user=self.admin)
        url = reverse('article-detail', kwargs={'pk': self.published.pk})

        response = self.client.delete(url)

        self.assertEqual(response.status_code, status.HTTP_204_NO_CONTENT)
```

### –¢–µ—Å—Ç—ã —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –∏ –ø–æ–∏—Å–∫–∞

```python
class ArticleFilterTests(APITestCase):
    """–¢–µ—Å—Ç—ã —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –∏ –ø–æ–∏—Å–∫–∞"""

    def setUp(self):
        self.python_topic = TopicFactory(name='Python')
        self.django_topic = TopicFactory(name='Django')
        self.author1 = UserFactory(username='alice')
        self.author2 = UserFactory(username='bob')

        self.article1 = ArticleFactory(
            title='–í–≤–µ–¥–µ–Ω–∏–µ –≤ Python',
            author=self.author1,
            topics=[self.python_topic]
        )
        self.article2 = ArticleFactory(
            title='Django –¥–ª—è –Ω–∞—á–∏–Ω–∞—é—â–∏—Ö',
            author=self.author2,
            topics=[self.django_topic, self.python_topic]
        )

    def test_filter_by_topic(self):
        """–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Ç–µ–º–µ"""
        url = reverse('article-list')

        response = self.client.get(url, {'topics': self.django_topic.pk})

        self.assertEqual(len(response.data['results']), 1)
        self.assertEqual(response.data['results'][0]['title'], 'Django –¥–ª—è –Ω–∞—á–∏–Ω–∞—é—â–∏—Ö')

    def test_filter_by_author(self):
        """–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –∞–≤—Ç–æ—Ä—É"""
        url = reverse('article-list')

        response = self.client.get(url, {'author': self.author1.pk})

        self.assertEqual(len(response.data['results']), 1)
        self.assertEqual(response.data['results'][0]['author']['username'], 'alice')

    def test_search_by_title(self):
        """–ü–æ–∏—Å–∫ –ø–æ –∑–∞–≥–æ–ª–æ–≤–∫—É"""
        url = reverse('article-list')

        response = self.client.get(url, {'search': 'Python'})

        self.assertEqual(len(response.data['results']), 1)
        self.assertIn('Python', response.data['results'][0]['title'])

    def test_ordering_by_created_at(self):
        """–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –¥–∞—Ç–µ —Å–æ–∑–¥–∞–Ω–∏—è"""
        url = reverse('article-list')

        response = self.client.get(url, {'ordering': '-created_at'})

        self.assertEqual(response.status_code, status.HTTP_200_OK)
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Å—Ç–∞—Ç—å–∏ –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –ø–æ —É–±—ã–≤–∞–Ω–∏—é –¥–∞—Ç—ã
        dates = [a['created_at'] for a in response.data['results']]
        self.assertEqual(dates, sorted(dates, reverse=True))
```

### –¢–µ—Å—Ç—ã —Å pytest

```python
# blog/tests/test_views_pytest.py
import pytest
from django.urls import reverse
from rest_framework import status
from blog.tests.factories import ArticleFactory, UserFactory


@pytest.fixture
def api_client():
    from rest_framework.test import APIClient
    return APIClient()


@pytest.fixture
def author(db):
    return UserFactory()


@pytest.fixture
def article(db, author):
    return ArticleFactory(author=author)


@pytest.mark.django_db
class TestArticleAPI:
    def test_list_articles(self, api_client, article):
        url = reverse('article-list')
        response = api_client.get(url)
        assert response.status_code == status.HTTP_200_OK

    def test_create_article_authenticated(self, api_client, author):
        api_client.force_authenticate(user=author)
        url = reverse('article-list')
        data = {'title': '–ù–æ–≤–∞—è —Å—Ç–∞—Ç—å—è', 'slug': 'novaya-statya', 'content': '–¢–µ–∫—Å—Ç', 'status': 'draft'}

        response = api_client.post(url, data, format='json')

        assert response.status_code == status.HTTP_201_CREATED
        assert response.data['author']['username'] == author.username

    @pytest.mark.parametrize('status_code,user_authenticated', [
        (status.HTTP_401_UNAUTHORIZED, False),
        (status.HTTP_201_CREATED, True),
    ])
    def test_create_article_auth_required(
        self, api_client, author, status_code, user_authenticated
    ):
        if user_authenticated:
            api_client.force_authenticate(user=author)

        url = reverse('article-list')
        response = api_client.post(url, {'title': 'Test', 'slug': 'test', 'content': 'Text'}, format='json')

        assert response.status_code == status_code
```

#### Providers: –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä—ã

Faker –∏–º–µ–µ—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö:

```python
from faker import Faker
from faker.providers import internet

fake = Faker()
fake.add_provider(internet)

fake.ipv4_private()  # '10.10.11.69'
fake.url()           # 'https://example.com/path'
fake.user_name()     # 'john_doe'
```

## –ú–æ–∫–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∏–∑–æ–ª—è—Ü–∏—è –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤

–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: https://docs.python.org/3/library/unittest.mock.html

- –ü–∞—Ç—á—å—Ç–µ —Ç–æ—á–∫—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è (where it‚Äôs used), –∞ –Ω–µ –º–µ—Å—Ç–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è.
- –ü—Ä–∏–≥–æ–¥–∏—Ç—Å—è autospec=True –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—ã–∑–æ–≤–æ–≤: mock.assert_called_once_with(...)

```python
from unittest.mock import patch


def do_payment(amount):
    # –æ–±—ë—Ä—Ç–∫–∞ –Ω–∞–¥ –≤–Ω–µ—à–Ω–∏–º SDK
    from app.payments.gateway import charge
    return charge(amount).get('ok')


@patch('app.payments.gateway.charge', return_value={'ok': True})
def test_charge_ok(mock_charge):
    assert do_payment(100) is True
    mock_charge.assert_called_once_with(100)
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç—Ä–æ—Ç–ª–∏–Ω–≥–∞ (429 Too Many Requests)

```python
from django.test import override_settings
from django.urls import reverse
from rest_framework import status
from rest_framework.test import APITestCase


class ThrottleTests(APITestCase):
    @override_settings(REST_FRAMEWORK={
        'DEFAULT_THROTTLE_CLASSES': ['rest_framework.throttling.AnonRateThrottle'],
        'DEFAULT_THROTTLE_RATES': {'anon': '2/min'}
    })
    def test_throttle_for_anon(self):
        # –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –ø–æ–¥–≥–æ—Ç–æ–≤—å—Ç–µ –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ —Ñ–∞–±—Ä–∏–∫–∏ (—Å–º. —Ä–∞–∑–¥–µ–ª –ø—Ä–æ DjangoModelFactory)
        url = reverse('article-list')
        assert self.client.get(url).status_code == status.HTTP_200_OK
        assert self.client.get(url).status_code == status.HTTP_200_OK
        assert self.client.get(url).status_code == status.HTTP_429_TOO_MANY_REQUESTS
```

> –°–æ–≤–µ—Ç: –¥–ª—è –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ—Å—Ç–∏ –æ—á–∏—â–∞–π—Ç–µ –∫–µ—à –º–µ–∂–¥—É —Ç–µ—Å—Ç–∞–º–∏ –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ—Ç–¥–µ–ª—å–Ω—ã–π cache alias –¥–ª—è —Ç–µ—Å—Ç–æ–≤:

```python
from django.core.cache import cache


def teardown_function():
    cache.clear()
```

–í –º–Ω–æ–≥–æ—Å–µ—Ä–≤–µ—Ä–Ω–æ–π —Å—Ä–µ–¥–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ–±—â–∏–π backend –∫–µ—à–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, Redis) –¥–ª—è —Ç—Ä–æ—Ç–ª–∏–Ω–≥–∞.

## –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞—Ä–∏–π: pytest –∏ pytest-django

pytest —Å—Ç–∞–ª —Å—Ç–∞–Ω–¥–∞—Ä—Ç–æ–º –¥–µ-—Ñ–∞–∫—Ç–æ –¥–ª—è —Ç–µ—Å—Ç–æ–≤ –≤ Django/DRF –∑–∞ —Å—á—ë—Ç –ø—Ä–æ—Å—Ç–æ—Ç—ã, —Ñ–∏–∫—Å—Ç—É—Ä –∏ –ø–æ–ª–µ–∑–Ω—ã—Ö –ø–ª–∞–≥–∏–Ω–æ–≤.
–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: https://docs.pytest.org/
pytest-django: https://pytest-django.readthedocs.io/

–£—Å—Ç–∞–Ω–æ–≤–∫–∞:

```bash
pip install pytest pytest-django pytest-cov
```

–ë–∞–∑–æ–≤—ã–π –ø—Ä–∏–º–µ—Ä:

```python
import pytest


@pytest.mark.django_db
def test_animals_can_speak(animal_factory):
    lion = animal_factory(name="lion", sound="roar")
    assert lion.speak() == 'The lion says "roar"'
```

–ó–∞–ø—É—Å–∫:

```bash
pytest -q
pytest -k speak   # —Ñ–∏–ª—å—Ç—Ä –ø–æ –∏–º–µ–Ω–∏
pytest --cov=yourpkg --cov-report=term-missing
```

–°–æ–≤–µ—Ç: –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø—Ä–æ–≥–æ–Ω–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–ª—é—á --reuse-db (–ø–ª–∞–≥–∏–Ω pytest-django).

–ü—Ä–∏–º–µ—Ä pytest.ini:

```ini
[pytest]
DJANGO_SETTINGS_MODULE = project.settings
python_files = tests.py test_*.py *_tests.py
```

#### –§–∏–∫—Å—Ç—É—Ä—ã –≤ conftest.py

–ü–æ–≤—Ç–æ—Ä–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ–∏–∫—Å—Ç—É—Ä—ã –≤ –∫–æ—Ä–Ω–µ–≤–æ–º —Ñ–∞–π–ª–µ conftest.py, —á—Ç–æ–±—ã –Ω–µ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –∏—Ö –≤ –∫–∞–∂–¥–æ–º —Ç–µ—Å—Ç–µ:

```python
# conftest.py
import pytest
from rest_framework.test import APIClient


@pytest.fixture
def api_client():
    return APIClient()
```

#### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ–∏–∫—Å—Ç—É—Ä—ã: user –∏ auth_client

```python
# conftest.py
@pytest.fixture
def user(db, user_factory):
    return user_factory()


@pytest.fixture
def auth_client(api_client, user):
    api_client.force_authenticate(user=user)
    return api_client
```

–í pytest-django –¥–æ—Å—Ç—É–ø–Ω—ã —Ñ–∏–∫—Å—Ç—É—Ä—ã: client (Django client), db/transactional_db, settings, monkeypatch –∏ –¥—Ä.

#### –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π pytest.ini

```ini
[pytest]
DJANGO_SETTINGS_MODULE = project.settings
python_files = tests.py test_*.py *_tests.py
# –§–ª–∞–≥–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
addopts = -q --strict-markers --disable-warnings
# –ì–¥–µ –∏—Å–∫–∞—Ç—å —Ç–µ—Å—Ç—ã
testpaths = tests
```

#### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –≤ —Ç–µ—Å—Ç–∞—Ö

```python
import pytest


@pytest.mark.django_db
def test_uses_db():
    # –û–±—ã—á–Ω—ã–µ ORM-–æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ —Ä–∞–º–∫–∞—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ TestCase
    ...


@pytest.mark.django_db(transaction=True)
def test_needs_transactions():
    # –î–ª—è –∫–µ–π—Å–æ–≤, –≥–¥–µ –Ω—É–∂–Ω–∞ –Ω–∞—Å—Ç–æ—è—â–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ç–µ—Å—Ç—ã celery/task –∏–ª–∏ raw SQL)
    ...
```

#### –ü–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤

```python
import pytest


@pytest.mark.parametrize(
    "a,b,expected",
    [(1, 2, 3), (2, 3, 5)],
    ids=["1+2", "2+3"],
)
def test_add(a, b, expected):
    assert a + b == expected
```

#### –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```python
def test_override_settings(settings):
    settings.DEBUG = False
```

```python
def test_env(monkeypatch):
    monkeypatch.setenv("FEATURE_X", "1")
```

#### –ü–æ–ª–µ–∑–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã: caplog –∏ tmp_path

```python
import logging


def test_logging(caplog):
    with caplog.at_level(logging.INFO):
        ...
    assert "Started" in caplog.text
```

```python
def test_tmp_path(tmp_path):
    p = tmp_path / "data.txt"
    p.write_text("hello")
    assert p.read_text() == "hello"
```

#### –ú–∞—Ä–∫–µ—Ä—ã pytest –∏ –∫–æ–Ω—Ç—Ä–æ–ª—å –∑–∞–ø—É—Å–∫–∞

–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: https://docs.pytest.org/en/stable/reference/reference.html#marks

pytest.ini:

```ini
[pytest]
markers =
    slow: –º–µ–¥–ª–µ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
    api: API-—Ç–µ—Å—Ç—ã
```

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:

```python
import pytest


@pytest.mark.slow
def test_something():
    ...
```

xfail –∏ skipif:

```python
import pytest, sys


@pytest.mark.skipif(sys.platform == 'win32', reason='no Windows support')
def test_only_unix():
    ...


@pytest.mark.xfail(reason='bug #123', strict=True)
def test_known_bug():
    assert 1 == 2
```

---

## –ò—Ç–æ–≥–∏

–í —ç—Ç–æ–π –ª–µ–∫—Ü–∏–∏ –º—ã –∏–∑—É—á–∏–ª–∏:

1. **–£—Ä–æ–≤–Ω–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è**:
   - Unit-—Ç–µ—Å—Ç—ã: –ø—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –≤ –∏–∑–æ–ª—è—Ü–∏–∏
   - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã: –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
   - Acceptance-—Ç–µ—Å—Ç—ã: –∏–º–∏—Ç–∞—Ü–∏—è –¥–µ–π—Å—Ç–≤–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

2. **–ò–µ—Ä–∞—Ä—Ö–∏—è TestCase –≤ Django**:
   - `SimpleTestCase`: –±–µ–∑ –ë–î, —Å Client
   - `TransactionTestCase`: —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏
   - `TestCase`: —Å –æ—Ç–∫–∞—Ç–æ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
   - `LiveServerTestCase`: –¥–ª—è Selenium-—Ç–µ—Å—Ç–æ–≤

3. **–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã Django**:
   - `RequestFactory`: unit-—Ç–µ—Å—Ç—ã view –±–µ–∑ middleware
   - `Client`: –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã —Å –ø–æ–ª–Ω—ã–º —Ü–∏–∫–ª–æ–º –∑–∞–ø—Ä–æ—Å–∞

4. **–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã DRF**:
   - `APIRequestFactory`: unit-—Ç–µ—Å—Ç—ã API view
   - `APIClient` / `APITestCase`: –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã API
   - `force_authenticate()`: –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–∞—Ä–æ–ª—è

5. **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö**:
   - FactoryBoy: —Ñ–∞–±—Ä–∏–∫–∏ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –æ–±—ä–µ–∫—Ç–æ–≤
   - Faker: –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
   - `SubFactory`, `Sequence`, `LazyAttribute`

6. **pytest –∏ pytest-django**:
   - –§–∏–∫—Å—Ç—É—Ä—ã –∏ `conftest.py`
   - –ú–∞—Ä–∫–µ—Ä—ã `@pytest.mark.django_db`
   - –ü–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤

---

## –î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ

### –ü—Ä–∞–∫—Ç–∏–∫–∞ –Ω–∞ –∑–∞–Ω—è—Ç–∏–∏

1. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–±—Ä–∏–∫–∏ `UserFactory`, `ArticleFactory`, `TopicFactory` –¥–ª—è –±–ª–æ–≥–∞
2. –ù–∞–ø–∏—à–∏—Ç–µ —Ç–µ—Å—Ç —Å–æ–∑–¥–∞–Ω–∏—è —Å—Ç–∞—Ç—å–∏ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
3. –ù–∞–ø–∏—à–∏—Ç–µ —Ç–µ—Å—Ç, –ø—Ä–æ–≤–µ—Ä—è—é—â–∏–π, —á—Ç–æ –∞–Ω–æ–Ω–∏–º–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞—Ç—å —Å—Ç–∞—Ç—å—é

### –î–æ–º–∞—à–Ω—è—è —Ä–∞–±–æ—Ç–∞

1. **–ü–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä CRUD-—Ç–µ—Å—Ç–æ–≤ –¥–ª—è ArticleViewSet**:
   - –¢–µ—Å—Ç—ã —Å–æ–∑–¥–∞–Ω–∏—è, —á—Ç–µ–Ω–∏—è, –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è, —É–¥–∞–ª–µ–Ω–∏—è
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–æ–≤ –æ—Ç–≤–µ—Ç–∞ (200, 201, 204, 400, 401, 403, 404)
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ –æ—Ç–≤–µ—Ç–µ

2. **–¢–µ—Å—Ç—ã Permissions**:
   - `IsAuthorOrReadOnly`: –∞–≤—Ç–æ—Ä –º–æ–∂–µ—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å, –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ç–æ–ª—å–∫–æ —á–∏—Ç–∞—Ç—å
   - `IsPublishedOrAuthor`: —á–µ—Ä–Ω–æ–≤–∏–∫–∏ –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ –∞–≤—Ç–æ—Ä
   - –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä: –º–æ–∂–µ—Ç —É–¥–∞–ª—è—Ç—å –ª—é–±—ã–µ —Å—Ç–∞—Ç—å–∏

3. **–¢–µ—Å—Ç—ã —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –∏ –ø–æ–∏—Å–∫–∞**:
   - –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Ç–µ–º–µ, –∞–≤—Ç–æ—Ä—É, —Å—Ç–∞—Ç—É—Å—É
   - –ü–æ–∏—Å–∫ –ø–æ –∑–∞–≥–æ–ª–æ–≤–∫—É –∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–º—É
   - –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –¥–∞—Ç–µ —Å–æ–∑–¥–∞–Ω–∏—è

4. **–¢–µ—Å—Ç—ã CommentViewSet**:
   - –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è –∫ —Å—Ç–∞—Ç—å–µ
   - –£–¥–∞–ª–µ–Ω–∏–µ —Å–≤–æ–µ–≥–æ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è
   - –ú–æ–¥–µ—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç —É–¥–∞–ª—è—Ç—å –ª—é–±—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏

5. **–ü–µ—Ä–µ–≤–æ–¥ —Ç–µ—Å—Ç–æ–≤ –Ω–∞ pytest**:
   - –°–æ–∑–¥–∞–π—Ç–µ `conftest.py` —Å —Ñ–∏–∫—Å—Ç—É—Ä–∞–º–∏
   - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `@pytest.mark.django_db`
   - –î–æ–±–∞–≤—å—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–∞—Ü–∏—é –¥–ª—è —Ç–µ—Å—Ç–æ–≤ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

---

## –í–æ–ø—Ä–æ—Å—ã –¥–ª—è —Å–∞–º–æ–ø—Ä–æ–≤–µ—Ä–∫–∏

1. –í —á—ë–º —Ä–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É `RequestFactory` –∏ `Client`?
2. –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `TransactionTestCase` –≤–º–µ—Å—Ç–æ `TestCase`?
3. –ß—Ç–æ –¥–µ–ª–∞–µ—Ç `force_authenticate()` –∏ –∫–æ–≥–¥–∞ –µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å?
4. –ß–µ–º `APIRequestFactory` –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç `APIClient`?
5. –ö–∞–∫ —Å–æ–∑–¥–∞—Ç—å —Ñ–∞–±—Ä–∏–∫—É –¥–ª—è –º–æ–¥–µ–ª–∏ —Å–æ —Å–≤—è–∑—å—é ManyToMany?
6. –ß—Ç–æ —Ç–∞–∫–æ–µ `SubFactory` –∏ –∑–∞—á–µ–º –æ–Ω –Ω—É–∂–µ–Ω?
7. –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Faker —Å FactoryBoy?
8. –ß—Ç–æ —Ç–∞–∫–æ–µ —Ñ–∏–∫—Å—Ç—É—Ä—ã –≤ pytest –∏ –∫–∞–∫ –∏—Ö –æ–ø—Ä–µ–¥–µ–ª—è—Ç—å?
9. –î–ª—è —á–µ–≥–æ –Ω—É–∂–µ–Ω –º–∞—Ä–∫–µ—Ä `@pytest.mark.django_db`?
10. –ö–∞–∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å throttling –≤ DRF?

---

[‚Üê –õ–µ–∫—Ü–∏—è 29: REST-–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è. –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è. Permissions. –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è.](lesson29.md) | [–õ–µ–∫—Ü–∏—è 31: Celery. Multithreading. GIL. Multiprocessing ‚Üí](lesson31.md)
