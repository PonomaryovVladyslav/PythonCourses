# –õ–µ–∫—Ü–∏—è 31. Celery. Multithreading. GIL. Multiprocessing

### –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ –∫—É—Ä—Å–∞

<details>
  <summary>–ë–ª–æ–∫ 1 ‚Äî Python Basic (1‚Äì6)</summary>

  - [–õ–µ–∫—Ü–∏—è 1. –í–≤–µ–¥–µ–Ω–∏–µ. –¢–∏–ø–∏–∑–∞—Ü–∏–∏. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ. –°—Ç—Ä–æ–∫–∏ –∏ —á–∏—Å–ª–∞. –ë—É–ª–µ–≤–∞ –∞–ª–≥–µ–±—Ä–∞. –í–µ—Ç–≤–ª–µ–Ω–∏–µ](lesson01.md)
  - [–õ–µ–∫—Ü–∏—è 2. –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π. –°–ø–∏—Å–∫–∏, —Å—Ç—Ä–æ–∫–∏ –¥–µ—Ç–∞–ª—å–Ω–µ–µ, —Å—Ä–µ–∑—ã, —Ü–∏–∫–ª—ã.](lesson02.md)
  - [–õ–µ–∫—Ü–∏—è 3. None. Range, list comprehension, sum, max, min, len, sorted, all, any. –†–∞–±–æ—Ç–∞ —Å —Ñ–∞–π–ª–∞–º–∏](lesson03.md)
  - [–õ–µ–∫—Ü–∏—è 4. –•–µ—à-—Ç–∞–±–ª–∏—Ü—ã. Set, frozenset. Dict. Tuple. –ù–µ–º–Ω–æ–≥–æ –æ–± –∏–º–ø–æ—Ä—Ç–∞—Ö. Namedtuple, OrderedDict](lesson04.md)
  - [–õ–µ–∫—Ü–∏—è 5. –§—É–Ω–∫—Ü–∏–∏, —Ç–∏–ø–∏–∑–∞—Ü–∏—è, lambda. Map, zip, filter.](lesson05.md)
  - [–õ–µ–∫—Ü–∏—è 6. –ê–ª–≥–æ—Ä–∏—Ç–º—ã –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö](lesson06.md)
</details>

<details>
  <summary>–ë–ª–æ–∫ 2 ‚Äî Git (7‚Äì8)</summary>

  - [–õ–µ–∫—Ü–∏—è 7. Git. –ò—Å—Ç–æ—Ä–∏—è —Å–∏—Å—Ç–µ–º—ã –∫–æ–Ω—Ç—Ä–æ–ª—è –≤–µ—Ä—Å–∏–π. –õ–æ–∫–∞–ª—å–Ω—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π. –ë–∞–∑–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–º.](lesson07.md)
  - [–õ–µ–∫—Ü–∏—è 8. Git. –£–¥–∞–ª–µ–Ω–Ω—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π. Remote, push, pull. GitHub, Bitbucket, GitLab, etc. Pull request.](lesson08.md)
</details>

<details>
  <summary>–ë–ª–æ–∫ 3 ‚Äî Python Advanced (9‚Äì14)</summary>

  - [–õ–µ–∫—Ü–∏—è 9. –í–≤–µ–¥–µ–Ω–∏–µ –≤ –û–û–ü. –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–¥–∏–≥–º—ã –û–û–ü. –ö–ª–∞—Å—Å—ã –∏ –æ–±—ä–µ–∫—Ç—ã. –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ.](lesson09.md)
  - [–õ–µ–∫—Ü–∏—è 10. Magic methods. –ò—Ç–µ—Ä–∞—Ç–æ—Ä—ã –∏ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä—ã.](lesson10.md)
  - [–õ–µ–∫—Ü–∏—è 11. Imports. Standard library. PEP 8](lesson11.md)
  - [–õ–µ–∫—Ü–∏—è 12. –î–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã. –î–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏. –î–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã –∫–ª–∞—Å—Å–æ–≤ (staticmethod, classmethod, property)](lesson12.md)
  - [–õ–µ–∫—Ü–∏—è 13. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ](lesson13.md)
  - [–õ–µ–∫—Ü–∏—è 14. –ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ. –ü–∞—Ç—Ç–µ—Ä–Ω—ã. SOLID.](lesson14.md)
</details>

<details>
  <summary>–ë–ª–æ–∫ 4 ‚Äî SQL (15‚Äì17)</summary>

  - [–õ–µ–∫—Ü–∏—è 15. –°–£–ë–î. PostgreSQL. SQL. DDL. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏. DCL. DML. –°–≤—è–∑–∏.](lesson15.md)
  - [–õ–µ–∫—Ü–∏—è 16. –°–£–ë–î. DQL. SELECT. –ò–Ω–¥–µ–∫—Å—ã. Group by. Joins.](lesson16.md)
  - [–õ–µ–∫—Ü–∏—è 17. –°–£–ë–î. –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è. –ê–Ω–æ–º–∞–ª–∏–∏. –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏. ACID. TCL. Backup](lesson17.md)
</details>

- [–õ–µ–∫—Ü–∏—è 18. Virtual env. Pip. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º—ã–µ –º–æ–¥—É–ª–∏. Pyenv.](lesson18.md)

<details>
  <summary>–ë–ª–æ–∫ 5 ‚Äî Django (19‚Äì26)</summary>

  - [–õ–µ–∫—Ü–∏—è 19. –ó–Ω–∞–∫–æ–º—Å—Ç–≤–æ —Å Django](lesson19.md)
  - [–õ–µ–∫—Ü–∏—è 20. Templates. Static](lesson20.md)
  - [–õ–µ–∫—Ü–∏—è 21. –ú–æ–¥–µ–ª–∏. –°–≤—è–∑–∏. Meta. Abstract, proxy](lesson21.md)
  - [–õ–µ–∫—Ü–∏—è 22. Django ORM](lesson22.md)
  - [–õ–µ–∫—Ü–∏—è 23. Forms, ModelForms. User, Authentication](lesson23.md)
  - [–õ–µ–∫—Ü–∏—è 24. ClassBaseView](lesson24.md)
  - [–õ–µ–∫—Ü–∏—è 25. NoSQL. –ö—É–∫–∏, —Å–µ—Å—Å–∏–∏, –∫–µ—à](lesson25.md)
  - [–õ–µ–∫—Ü–∏—è 26. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ. Middleware. Signals. Messages. Manage commands](lesson26.md)
</details>

<details>
  <summary>–ë–ª–æ–∫ 6 ‚Äî Django Rest Framework (27‚Äì30)</summary>

  - [–õ–µ–∫—Ü–∏—è 27. –ß—Ç–æ —Ç–∞–∫–æ–µ API. REST –∏ RESTful. Django REST Framework](lesson27.md)
  - [–õ–µ–∫—Ü–∏—è 28. @api_view, APIView, ViewSets, Pagination, Routers](lesson28.md)
  - [–õ–µ–∫—Ü–∏—è 29. REST-–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è. –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è. Permissions. –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è](lesson29.md)
  - [–õ–µ–∫—Ü–∏—è 30. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ. Django, REST API.](lesson30.md)
</details>

<details open>
  <summary>–ë–ª–æ–∫ 7 ‚Äî Python async (31‚Äì33)</summary>

  - ‚ñ∂ **–õ–µ–∫—Ü–∏—è 31. Celery. Multithreading. GIL. Multiprocessing**
  - [–õ–µ–∫—Ü–∏—è 32. Asyncio. Aiohttp. –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ.](lesson32.md)
  - [–õ–µ–∫—Ü–∏—è 33. –°–æ–∫–µ—Ç—ã. Django Channels.](lesson33.md)
</details>

<details>
  <summary>–ë–ª–æ–∫ 8 ‚Äî Deployment (34‚Äì35)</summary>

  - [–õ–µ–∫—Ü–∏—è 34. Linux. –í—Å—ë, —á—Ç–æ –Ω—É–∂–Ω–æ –∑–Ω–∞—Ç—å –¥–ª—è –¥–µ–ø–ª–æ—è](lesson34.md)
  - [–õ–µ–∫—Ü–∏—è 35. Deployment](lesson35.md)
</details>

- [–õ–µ–∫—Ü–∏—è 36. –ú–µ—Ç–æ–¥–æ–ª–æ–≥–∏–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏. CI/CD. –ú–æ–Ω–æ–ª–∏—Ç –∏ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã. Docker](lesson36.md)


![](https://i.kym-cdn.com/entries/icons/original/000/022/857/Screen_Shot_2017-05-01_at_12.53.31_PM.png)

## –ß—Ç–æ –Ω–∞–¥–æ –∑–Ω–∞—Ç—å –¥–æ Celery

### –ü—Ä–æ—Ü–µ—Å—Å—ã

**–ü—Ä–æ—Ü–µ—Å—Å** ‚Äî —ç–∫–∑–µ–º–ø–ª—è—Ä –ø—Ä–æ–≥—Ä–∞–º–º—ã –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è, –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–π –æ–±—ä–µ–∫—Ç, –∫–æ—Ç–æ—Ä–æ–º—É –≤—ã–¥–µ–ª–µ–Ω—ã —Å–∏—Å—Ç–µ–º–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä,
–ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–Ω–æ–µ –≤—Ä–µ–º—è –∏ –ø–∞–º—è—Ç—å). –ö–∞–∂–¥—ã–π –ø—Ä–æ—Ü–µ—Å—Å –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –∞–¥—Ä–µ—Å–Ω–æ–º –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ: –æ–¥–∏–Ω –ø—Ä–æ—Ü–µ—Å—Å –Ω–µ –º–æ–∂–µ—Ç
–ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞–º –¥–∞–Ω–Ω—ã—Ö –¥—Ä—É–≥–æ–≥–æ. –ï—Å–ª–∏ –ø—Ä–æ—Ü–µ—Å—Å —Ö–æ—á–µ—Ç –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ —á—É–∂–∏–º —Ä–µ—Å—É—Ä—Å–∞–º,
–Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–µ–∂–ø—Ä–æ—Ü–µ—Å—Å–Ω–æ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ. –≠—Ç–æ –º–æ–≥—É—Ç –±—ã—Ç—å –∫–æ–Ω–≤–µ–π–µ—Ä—ã, —Ñ–∞–π–ª—ã, –∫–∞–Ω–∞–ª—ã —Å–≤—è–∑–∏ –º–µ–∂–¥—É –∫–æ–º–ø—å—é—Ç–µ—Ä–∞–º–∏ –∏
–º–Ω–æ–≥–æ–µ –¥—Ä—É–≥–æ–µ.

**–°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º (synchronous)** –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–∞–∫–æ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –º–µ–∂–¥—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏, –ø—Ä–∏ –∫–æ—Ç–æ—Ä–æ–º –∫–ª–∏–µ–Ω—Ç, –æ—Ç–æ—Å–ª–∞–≤ –∑–∞–ø—Ä–æ—Å,
–±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –∏ –º–æ–∂–µ—Ç –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å —Ä–∞–±–æ—Ç—É —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è –æ—Ç–≤–µ—Ç–∞ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞. –ü–æ —ç—Ç–æ–π –ø—Ä–∏—á–∏–Ω–µ —Ç–∞–∫–æ–π –≤–∏–¥ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è
–Ω–∞–∑—ã–≤–∞—é—Ç –∏–Ω–æ–≥–¥–∞ **–±–ª–æ–∫–∏—Ä—É—é—â–∏–º (blocking)**.

–í —Ä–∞–º–∫–∞—Ö **–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ (asynchronous)** –∏–ª–∏ **–Ω–µ–±–ª–æ–∫–∏—Ä—É—é—â–µ–≥–æ (non-blocking)** –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –∫–ª–∏–µ–Ω—Ç –ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞–ø—Ä–æ—Å–∞
—Å–µ—Ä–≤–µ—Ä—É –º–æ–∂–µ—Ç –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å —Ä–∞–±–æ—Ç—É, –¥–∞–∂–µ –µ—Å–ª–∏ –æ—Ç–≤–µ—Ç –Ω–∞ –∑–∞–ø—Ä–æ—Å –µ—â—ë –Ω–µ –ø—Ä–∏—à—ë–ª. –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª—É—á–∏—Ç—å
–±–æ–ª–µ–µ –≤—ã—Å–æ–∫—É—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–∏—Å—Ç–µ–º—ã –∑–∞ —Å—á–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ –º–µ–∂–¥—É –æ—Ç–ø—Ä–∞–≤–∫–æ–π –∑–∞–ø—Ä–æ—Å–∞ –∏ –ø–æ–ª—É—á–µ–Ω–∏–µ–º –æ—Ç–≤–µ—Ç–∞ –Ω–∞
–Ω–µ–≥–æ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –¥—Ä—É–≥–∏—Ö –∑–∞–¥–∞—á. –î—Ä—É–≥–æ–µ –≤–∞–∂–Ω–æ–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è ‚Äî –º–µ–Ω—å—à–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –∫–ª–∏–µ–Ω—Ç–∞
–æ—Ç —Å–µ—Ä–≤–µ—Ä–∞, –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å —Ä–∞–±–æ—Ç—É, –¥–∞–∂–µ –µ—Å–ª–∏ –º–∞—à–∏–Ω–∞, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–π –Ω–∞—Ö–æ–¥–∏—Ç—Å—è —Å–µ—Ä–≤–µ—Ä, —Å—Ç–∞–ª–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ–π. –≠—Ç–æ
—Å–≤–æ–π—Å—Ç–≤–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –Ω–∞–¥–µ–∂–Ω–æ–π —Å–≤—è–∑–∏ –º–µ–∂–¥—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏, –¥–∞–∂–µ –µ—Å–ª–∏ –∏ –∫–ª–∏–µ–Ω—Ç, –∏ —Å–µ—Ä–≤–µ—Ä –Ω–µ –≤—Å–µ –≤—Ä–µ–º—è
–Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ —Ä–∞–±–æ—á–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏.

![](https://blog.function12.io/content/images/2023/11/----.png)

## –ß—Ç–æ —ç—Ç–æ –≤–æ–æ–±—â–µ —Ç–∞–∫–æ–µ Celery?

**Celery** ‚Äî —ç—Ç–æ —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—á–µ—Ä–µ–¥—è–º–∏ –∑–∞–¥–∞—á. –ü—Ä–∏–Ω—Ü–∏–ø–∏–∞–ª—å–Ω–æ —É–º–µ–µ—Ç 2 –≤–µ—â–∏: –±—Ä–∞—Ç—å –∑–∞–¥–∞—á–∏ –∏–∑ –æ—á–µ—Ä–µ–¥–∏ –∏ –≤—ã–ø–æ–ª–Ω—è—Ç—å
–∑–∞–¥–∞—á–∏ –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é.

Celery ‚Äî —ç—Ç–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–∞—è –æ—á–µ—Ä–µ–¥—å –∑–∞–¥–∞—á, —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –Ω–∞ —è–∑—ã–∫–µ Python.

Celery ‚Äî —ç—Ç–æ –ø—Ä–æ—Å—Ç–∞—è, –≥–∏–±–∫–∞—è –∏ –Ω–∞–¥—ë–∂–Ω–∞—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ–≥—Ä–æ–º–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å–æ–æ–±—â–µ–Ω–∏–π, –≤–∫–ª—é—á–∞—è –≤
—Å–µ–±—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã, –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —Ç–∞–∫–æ–π —Å–∏—Å—Ç–µ–º—ã.

–≠—Ç–æ –æ—á–µ—Ä–µ–¥—å –∑–∞–¥–∞—á —Å —É–ø–æ—Ä–æ–º –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏, –∞ —Ç–∞–∫–∂–µ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–¥–∞—á.

Celery –∏–º–µ–µ—Ç –æ—Ç–∫—Ä—ã—Ç—ã–π –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ –∏ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ø–æ–¥ –ª–∏—Ü–µ–Ω–∑–∏–µ–π BSD.

–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: https://docs.celeryq.dev/

–ò—Ç–∞–∫, —á—Ç–æ –∂–µ —É–º–µ–µ—Ç Celery:

- –í—ã–ø–æ–ª–Ω—è—Ç—å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –∑–∞–¥–∞–Ω–∏—è
- –í—ã–ø–æ–ª–Ω—è—Ç—å –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞–Ω–∏—è (—É–º–Ω–∞—è –∑–∞–º–µ–Ω–∞ cron)
- –í—ã–ø–æ–ª–Ω—è—Ç—å –æ—Ç–ª–æ–∂–µ–Ω–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è
- –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ (–º–æ–∂–µ—Ç –±—ã—Ç—å –∑–∞–ø—É—â–µ–Ω –Ω–∞ N —Å–µ—Ä–≤–µ—Ä–∞—Ö)
- –í –ø—Ä–µ–¥–µ–ª–∞—Ö –æ–¥–Ω–æ–≥–æ worker‚Äô–∞ –≤–æ–∑–º–æ–∂–Ω–æ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∑–∞–¥–∞—á (–æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ)
- –í—ã–ø–æ–ª–Ω—è—Ç—å –∑–∞–¥–∞–Ω–∏–µ –ø–æ–≤—Ç–æ—Ä–Ω–æ, –µ—Å–ª–∏ –≤—ã–ª–µ–∑ exception
- –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–¥–∞–Ω–∏–π –≤ –µ–¥–∏–Ω–∏—Ü—É –≤—Ä–µ–º–µ–Ω–∏ (rate limit –¥–ª—è –∑–∞–¥–∞–Ω–∏—è –∏–ª–∏ –≥–ª–æ–±–∞–ª—å–Ω–æ)
- –ù–µ—Å–ª–æ–∂–Ω–æ –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–¥–∞–Ω–∏–π
- –í—ã–ø–æ–ª–Ω—è—Ç—å –ø–æ–¥–∑–∞–¥–∞–Ω–∏—è
- –ü—Ä–∏—Å—ã–ª–∞—Ç—å –æ—Ç—á–µ—Ç—ã –æ–± exception‚Äô–∞—Ö
- –ü—Ä–æ–≤–µ—Ä—è—Ç—å –≤—ã–ø–æ–ª–Ω–∏–ª–æ—Å—å –ª–∏ –∑–∞–¥–∞–Ω–∏–µ

![](https://miro.medium.com/v2/resize:fit:1400/1*FRkffS6BCCU36LBHglfF9A.png)

### Task (–ó–∞–¥–∞—á–∞)

–ó–∞–¥–∞—á–µ–π —è–≤–ª—è–µ—Ç—Å—è –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ –Ω–∞–ø–∏—Å–∞–Ω–Ω—ã–π –∫–æ–¥ (—á–∞—â–µ –≤—Å–µ–≥–æ —Ñ—É–Ω–∫—Ü–∏—è), –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–π –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–π —Ü–µ–ª–∏
(–æ—Ç–ø—Ä–∞–≤–∫–∞ –∏–º–µ–π–ª–∞, –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–∞–π–ª–∞, –∏ —Ç. –¥.)

### Broker (–ë—Ä–æ–∫–µ—Ä)

–ë—Ä–æ–∫–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π (–æ–Ω –∂–µ –¥–∏—Å–ø–µ—Ç—á–µ—Ä –æ—á–µ—Ä–µ–¥–∏) ‚Äî —ç—Ç–æ –ø–æ—Å—Ä–µ–¥–Ω–∏–∫(—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç), –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∏ –æ—Ç–¥–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è (–∑–∞–¥–∞—á–∏)
–º–µ–∂–¥—É –æ—Ç–¥–µ–ª—å–Ω—ã–º–∏ –º–æ–¥—É–ª—è–º–∏/–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è–º–∏ –≤–Ω—É—Ç—Ä–∏ –Ω–µ–∫–æ—Ç–æ—Ä–æ–π —Å–ª–æ–∂–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã, –≥–¥–µ –º–æ–¥—É–ª–∏/–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã –æ–±—â–∞—Ç—å—Å—è –º–µ–∂–¥—É
—Å–æ–±–æ–π ‚Äî —Ç–æ –µ—Å—Ç—å –ø–µ—Ä–µ—Å—ã–ª–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –¥—Ä—É–≥ –¥—Ä—É–≥—É.

–ë—Ä–æ–∫–µ—Ä–æ–º –º–æ–∂–µ—Ç –≤—ã—Å—Ç—É–ø–∞—Ç—å –∫–∞–∫ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–µ –ü–û, –Ω–∞–ø—Ä–∏–º–µ—Ä, RabbitMQ, —Ç–∞–∫ –∏ –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ NoSQL, –Ω–∞–ø—Ä–∏–º–µ—Ä Redis. –û –Ω–∏—Ö –ø–æ–¥—Ä–æ–±–Ω–µ–µ
–Ω–∏–∂–µ.

### Worker (–í–æ—Ä–∫–µ—Ä)

–í–æ—Ä–∫–µ—Ä ‚Äî —ç—Ç–æ –æ—Ç–¥–µ–ª—å–Ω–æ –∑–∞–ø—É—â–µ–Ω–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö –∑–∞–¥–∞—á. Celery –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –Ω–∞ –æ–¥–Ω–æ–º –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö
–≤–æ—Ä–∫–µ—Ä–∞—Ö, —á—Ç–æ–±—ã –≤—ã–ø–æ–ª–Ω—è—Ç—å –∑–∞–¥–∞—á–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ –Ω–∞ –∫–∞–∂–¥–æ–º –≤–æ—Ä–∫–µ—Ä–µ.

### Back-end (–ë—ç–∫—ç–Ω–¥)

–í —Ä–∞–º–∫–∞—Ö Celery –±—ç–∫—ç–Ω–¥ –≤—ã—Å—Ç—É–ø–∞–µ—Ç –≤ –∫–∞—á–µ—Å—Ç–≤–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á. –≠—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –∫–∞–∫ SQL, —Ç–∞–∫ –∏ NoSQL
–±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö. –•–æ—Ç—è, –ø–æ —Å—É—Ç–∏ —á—Ç–æ —É–≥–æ–¥–Ω–æ –º–æ–∂–µ—Ç –±—ã—Ç—å —Ö—Ä–∞–Ω–∏–ª–∏—â–µ–º, —Ö–æ—Ç—å –æ–±—ã—á–Ω—ã–π —Ñ–∞–π–ª (—è —Ç–∞–∫–∏—Ö —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–π –Ω–µ –≤—Å—Ç—Ä–µ—á–∞–ª, –Ω–æ
—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏ –≤–æ–∑–º–æ–∂–Ω–æ).

- *Producer (–ø–æ—Å—Ç–∞–≤—â–∏–∫)* ‚Äî –ø—Ä–æ–≥—Ä–∞–º–º–∞, –æ—Ç–ø—Ä–∞–≤–ª—è—é—â–∞—è —Å–æ–æ–±—â–µ–Ω–∏—è. –í –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ —ç—Ç–æ —á–∞—â–µ –≤—Å–µ–≥–æ –±—É–¥–µ—Ç Django.

- *Queue (–æ—á–µ—Ä–µ–¥—å)* ‚Äî –æ—á–µ—Ä–µ–¥—å —Å–æ–æ–±—â–µ–Ω–∏–π (–∑–∞–¥–∞—á). –û–Ω–∞ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤–Ω—É—Ç—Ä–∏ –±—Ä–æ–∫–µ—Ä–∞. –õ—é–±–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤ –º–æ–∂–µ—Ç
  –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –æ–¥–Ω—É –æ—á–µ—Ä–µ–¥—å, —Ç–∞–∫–∂–µ –ª—é–±–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤ –º–æ–∂–µ—Ç –ø–æ–ª—É—á–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ –æ–¥–Ω–æ–π –æ—á–µ—Ä–µ–¥–∏. –í
  —Å—Ö–µ–º–∞—Ö –æ—á–µ—Ä–µ–¥—å –±—É–¥–µ—Ç –æ–±–æ–∑–Ω–∞—á–µ–Ω–∞ —Å—Ç–µ–∫–æ–º –∏ –ø–æ–¥–ø–∏—Å–∞–Ω–∞ –∏–º–µ–Ω–µ–º. –ß–∞—â–µ –≤—Å–µ–≥–æ –∑–∞ –æ—á–µ—Ä–µ–¥—å –±—É–¥–µ—Ç –æ—Ç–≤–µ—á–∞—Ç—å Redis.

- *Consumer (–ø–æ–¥–ø–∏—Å—á–∏–∫)* ‚Äî –ø—Ä–æ–≥—Ä–∞–º–º–∞, –ø—Ä–∏–Ω–∏–º–∞—é—â–∞—è —Å–æ–æ–±—â–µ–Ω–∏—è. –û–±—ã—á–Ω–æ –ø–æ–¥–ø–∏—Å—á–∏–∫ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –æ–∂–∏–¥–∞–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π.
  –≠—Ç–æ –±—É–¥–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å Celery, –∫–æ—Ç–æ—Ä—ã–π –∑–∞–ø—É—Å—Ç–∏–ª–∏ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ –¥–ª—è —ç—Ç–æ–π —Ü–µ–ª–∏. –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–¥–∞—á–∏ –∏ —Å–∫–ª–∞–¥—ã–≤–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤
  backend.

–ü–æ—Å—Ç–∞–≤—â–∏–∫, –ø–æ–¥–ø–∏—Å—á–∏–∫ –∏ –±—Ä–æ–∫–µ—Ä –Ω–µ –æ–±—è–∑–∞–Ω—ã –Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –Ω–∞ –æ–¥–Ω–æ–π —Ñ–∏–∑–∏—á–µ—Å–∫–æ–π –º–∞—à–∏–Ω–µ.

### –ë—Ä–æ–∫–µ—Ä—ã

![](https://assets-global.website-files.com/5ff66329429d880392f6cba2/619f53ce469a19d18a61ef94_AMQP%20Broker.png)

#### AMQP

**AMQP (Advanced Message Queuing Protocol)** ‚Äî –æ—Ç–∫—Ä—ã—Ç—ã–π –ø—Ä–æ—Ç–æ–∫–æ–ª –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –º–µ–∂–¥—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏ —Å–∏—Å—Ç–µ–º—ã.
–û—Å–Ω–æ–≤–Ω–∞—è –∏–¥–µ—è —Å–æ—Å—Ç–æ–∏—Ç –≤ —Ç–æ–º, —á—Ç–æ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –ø–æ–¥—Å–∏—Å—Ç–µ–º—ã (–∏–ª–∏ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è) –º–æ–≥—É—Ç –æ–±–º–µ–Ω–∏–≤–∞—Ç—å—Å—è –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–º
–æ–±—Ä–∞–∑–æ–º —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏ —á–µ—Ä–µ–∑ AMQP-–±—Ä–æ–∫–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—é, –≤–æ–∑–º–æ–∂–Ω–æ, –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –¥–æ—Å—Ç–∞–≤–∫—É, —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ
–ø–æ—Ç–æ–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö, –ø–æ–¥–ø–∏—Å–∫—É –Ω–∞ –Ω—É–∂–Ω—ã–µ —Ç–∏–ø—ã —Å–æ–æ–±—â–µ–Ω–∏–π.

#### RabbitMQ

**RabbitMQ** ‚Äî —ç—Ç–æ –±—Ä–æ–∫–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π —Å –æ—Ç–∫—Ä—ã—Ç—ã–º –∏—Å—Ö–æ–¥–Ω—ã–º –∫–æ–¥–æ–º. –û–Ω –º–∞—Ä—à—Ä—É—Ç–∏–∑–∏—Ä—É–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ –≤—Å–µ–º –±–∞–∑–æ–≤—ã–º –ø—Ä–∏–Ω—Ü–∏–ø–∞–º
–ø—Ä–æ—Ç–æ–∫–æ–ª–∞ AMQP, –æ–ø–∏—Å–∞–Ω–Ω—ã–º –≤ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏. –û—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å –ø–µ—Ä–µ–¥–∞—ë—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –±—Ä–æ–∫–µ—Ä—É, –∞ —Ç–æ—Ç –¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –µ–≥–æ –ø–æ–ª—É—á–∞—Ç–µ–ª—é.
RabbitMQ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –∏ –¥–æ–ø–æ–ª–Ω—è–µ—Ç –ø—Ä–æ—Ç–æ–∫–æ–ª AMQP.

#### Redis

**Redis** (Remote Dictionary Server) ‚Äî —ç—Ç–æ –±—ã—Å—Ç—Ä–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–∞–Ω–Ω—ã—Ö —Ç–∏–ø–∞ ¬´–∫–ª—é—á ‚Äî –∑–Ω–∞—á–µ–Ω–∏–µ¬ª –≤ –ø–∞–º—è—Ç–∏ —Å
–æ—Ç–∫—Ä—ã—Ç—ã–º –∏—Å—Ö–æ–¥–Ω—ã–º –∫–æ–¥–æ–º –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –∫–∞—á–µ—Å—Ç–≤–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö, –∫–µ—à–∞, –±—Ä–æ–∫–µ—Ä–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –∏–ª–∏ –æ—á–µ—Ä–µ–¥–∏.

–î–ª—è Celery –∫—Ä–∞–π–Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É—é –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–º–µ–Ω–Ω–æ `Redis`, –≥–æ–¥–∞–º–∏ –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ.

![](https://miro.medium.com/v2/resize:fit:1200/1*i1d88Q8NNrRv6kjf7Ssw4g.png)

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–≥–æ –ü–û

### Celery

–î–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ `celery` –º—ã –º–æ–∂–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `pip`:

```bash
pip install "celery[redis]" redis
```

> **Celery 4.0+ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ —É–∂–µ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –¥–ª—è Windows**

–í–∞—Ä–∏–∞–Ω—Ç—ã –∑–∞–ø—É—Å–∫–∞

0. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Linux

1. [Docker](https://habr.com/ru/post/490040/)
2. [WSL 2](https://www.codedisciples.in/celery-windows.html) (–¥–ª—è Windows 10)
3. [–ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è](https://www.distributedpython.com/2018/08/21/celery-4-windows/)
   –∏–ª–∏ [–ø—Ä—è–º–æ –≤ –∫–æ–¥–µ](https://github.com/celery/celery/issues/4081#issuecomment-408581158)

### Redis

–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: https://redis.io

–£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–∞–º–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞

```sudo apt install redis-server```

–î–ª—è –ª–∏–Ω—É–∫—Å–∞,
–∏–ª–∏ [Windows](https://redislabs.com/ebook/appendix-a/a-3-installing-on-windows/a-3-2-installing-redis-on-window/)

–î–ª—è —Ä–∞–±–æ—Ç—ã —Ç–∞–∫–∂–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–∞ –∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞

```pip install redis```

*–í—Å–µ —Ç—Ä–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–∞–ø—É—â–µ–Ω—ã –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ! –ò Python, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è, –∏ Redis, –∫–æ—Ç–æ—Ä—ã–π
–±—É–¥–µ—Ç –æ—á–µ—Ä–µ–¥—å—é, –∏ Celery worker, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å –∑–∞–¥–∞—á–∏*

## Celery –∏ Python

### Celery –∏ Windows

> **Celery 4.0+ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç Windows.** –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –Ω–∞ Windows —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å WSL 2 –∏–ª–∏ Docker.

–í–∞—Ä–∏–∞–Ω—Ç—ã –∑–∞–ø—É—Å–∫–∞ –Ω–∞ Windows:
- **WSL 2** (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è) ‚Äî –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π Linux –≤–Ω—É—Ç—Ä–∏ Windows
- **Docker** ‚Äî –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è —Ä–µ—à–∞–µ—Ç –≤—Å–µ –ø—Ä–æ–±–ª–µ–º—ã —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
- –í–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è –º–∞—à–∏–Ω–∞ —Å Linux

### –ü—Ä–æ—Å—Ç–µ–π—à–∏–π –ø—Ä–∏–º–µ—Ä

–°–æ–∑–¥–∞–¥–∏–º —Ñ–∞–π–ª `tasks.py`

–î–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–∑–¥–∞—Ç—å ¬´–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ¬ª, –≤ –∫–æ—Ç–æ—Ä–æ–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É–∫–∞–∑–∞—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ –∏ –±—Ä–æ–∫–µ—Ä–∞.

```python
from celery import Celery

broker_url = 'redis://localhost'
app = Celery('tasks', broker=broker_url)


@app.task  # –¥–µ–∫–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –µ—ë —á–µ—Ä–µ–∑ Celery
def add(x, y):
    return x + y
```

–ú—ã –Ω–µ –≤—ã–∑—ã–≤–∞–ª–∏ –∑–∞–¥–∞—á—É!!

–î–ª—è —Ç–æ–≥–æ —á—Ç–æ–±—ã –º—ã –º–æ–≥–ª–∏ –≤—ã–∑–≤–∞—Ç—å –∑–∞–¥–∞—á—É, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ, —á—Ç–æ–±—ã —É –≤–∞—Å –±—ã–ª–∏ –∑–∞–ø—É—â–µ–Ω—ã –¥–≤–∞ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –ø–µ—Ä–≤–æ–µ Redis
Server:

![](https://djangoalevel.s3.eu-central-1.amazonaws.com/Lesson41/redis-server.png)

–ó–∞–ø—É—Å–∫–∞–µ–º –∏ –æ—Å—Ç–∞–≤–ª—è–µ–º —Ä–∞–±–æ—Ç–∞—Ç—å!

Celery –∑–∞–ø—É—Å–∫–∞—Ç—å –Ω—É–∂–Ω–æ –ø—Ä–∏ –∑–∞–ø—É—â–µ–Ω–Ω–æ–º –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–º –æ–∫—Ä—É–∂–µ–Ω–∏–∏!

```
celery -A tasks worker --loglevel=INFO
```

![](https://djangoalevel.s3.eu-central-1.amazonaws.com/Lesson41/celery-run.png)

–¢–∞–∫–∂–µ –∑–∞–ø—É—Å–∫–∞–µ–º –∏ –Ω–µ –∑–∞–∫—Ä—ã–≤–∞–µ–º!

`-A app_name` ‚Äî –∏–º—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, `worker` ‚Äî –∑–∞–ø—É—Å—Ç–∏—Ç—å –≤–æ—Ä–∫–µ—Ä, `loglevel` ‚Äî —É—Ä–æ–≤–µ–Ω—å –¥–µ—Ç–∞–ª–µ–π –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏.

### –ó–∞–ø—É—Å–∫ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

–î–ª—è –∑–∞–ø—É—Å–∫–∞ –∑–∞–¥–∞—á –µ—Å—Ç—å –º–Ω–æ–≥–æ —Ä–∞–∑–Ω—ã—Ö —Å–ø–æ—Å–æ–±–æ–≤, —Ç—É—Ç —Ä–∞—Å—Å–º–æ—Ç—Ä–∏–º –±–∞–∑–æ–≤—ã–π.

–û—Ç–∫—Ä—ã–≤–∞–µ–º –∫–æ–Ω—Å–æ–ª—å:

```python
from tasks import add

add.delay(4, 4)
```

–î–ª—è –∑–∞–ø—É—Å–∫–∞ –∑–∞–¥–∞—á–∏ –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –º–µ—Ç–æ–¥ `delay`.

–ó–∞–ø—É—Å–∫ –∑–∞–¥–∞—á –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç, –∞ `AsyncResult`, –¥–ª—è —Ç–æ–≥–æ —á—Ç–æ–±—ã –ø–æ–ª—É—á–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏
–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —É–∫–∞–∑–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä `backend`, –∫–æ—Ç–æ—Ä—ã–π –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ —Ç–æ, –≥–¥–µ –±—É–¥—É—Ç —Ö—Ä–∞–Ω–∏—Ç—å—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã, —Ç–∞–∫–∏–º –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º –º–æ–∂–µ—Ç
–±—ã—Ç—å Redis:

```python
broker_url = 'redis://localhost'
app = Celery('tasks', broker=broker_url, backend=broker_url)
```

–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ, –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º Redis –∏ –≤ –∫–∞—á–µ—Å—Ç–≤–µ –±—Ä–æ–∫–µ—Ä–∞, –∏ –≤ –∫–∞—á–µ—Å—Ç–≤–µ –±—ç–∫—ç–Ω–¥–∞ —Å—Ä–∞–∑—É.

–†–µ–∑—É–ª—å—Ç–∞—Ç –±—É–¥–µ—Ç –∏–º–µ—Ç—å –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±–æ–ª—å—à–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—Ç–æ–¥–æ–≤ –∏ –∞—Ç—Ä–∏–±—É—Ç–æ–≤.

–û—Å–Ω–æ–≤–Ω—ã–µ –¥–≤–∞ –º–µ—Ç–æ–¥–∞ —ç—Ç–æ `ready()` –∏ `get()`:

`ready()` ‚Äî –±—É–ª–µ–≤–æ –ø–æ–ª–µ, –∫–æ—Ç–æ—Ä–æ–µ –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ —Ç–æ, –∑–∞–≤–µ—Ä—à–∏–ª–∞—Å—å –∑–∞–¥–∞—á–∞ –∏–ª–∏ –µ—â—ë –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ.

`get()` ‚Äî –∂–¥—ë—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á–∏ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç. –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ—Å–ª–µ `ready()`, —á—Ç–æ–±—ã –Ω–µ –∂–¥–∞—Ç—å
–≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤–ø—É—Å—Ç—É—é.

```python
result = add.delay(4, 4)
result.ready()
True
result.get()
8
```

–ò–Ω–æ–≥–¥–∞ –æ–ø–∏—Å–∞–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∑–∞–¥–∞—á–∏ –∏ –µ–µ –≤—ã–∑–æ–≤ –º–æ–≥—É—Ç –±—ã—Ç—å –≤ —Å–æ–≤–µ—Ä—à–µ–Ω–Ω–æ —Ä–∞–∑–Ω—ã—Ö –º–µ—Å—Ç–∞—Ö, –¥–ª—è —ç—Ç–æ–≥–æ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –º–µ—Ö–∞–Ω–∏–∑–º
–ø–æ–¥–ø–∏—Å–∏:

```python
s1 = add.s(2, 2)
res = s1.delay()
res.get()
```

–í —ç—Ç–æ–º –ø—Ä–∏–º–µ—Ä–µ `s1` ‚Äî —ç—Ç–æ –ø–æ–¥–ø–∏—Å—å –∑–∞–¥–∞—á–∏, —Ç–æ –µ—Å—Ç—å –∑–∞–¥–∞—á–∞, –∑–∞–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω–∞—è –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è. –ï—ë –º–æ–∂–Ω–æ —Å–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞—Ç—å –∏
–æ—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–æ —Å–µ—Ç–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä, –∞ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –≤ —É–∂–µ —Å–æ–≤–µ—Ä—à–µ–Ω–Ω–æ –¥—Ä—É–≥–∏—Ö –º–µ—Å—Ç–∞—Ö.

–ò–ª–∏ –µ—Å–ª–∏ –≤—ã –Ω–µ –∑–Ω–∞–µ—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ü–µ–ª–∏–∫–æ–º:

```python
# incomplete partial: add(?, 2)
s2 = add.s(2)
# resolves the partial: add(8, 2)
res = s2.delay(8)
res.get()
```

–ó–∞–¥–∞—á–∏ –º–æ–∂–Ω–æ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞—Ç—å:

```python
from celery import group
from proj.tasks import add

group(add.s(i, i) for i in range(10))().get()
```

#### Canvas: chain, group, chord

–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: https://docs.celeryq.dev/en/stable/userguide/canvas.html

```python
from celery import chain, group, chord
from proj.tasks import add

# chain ‚Äî —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–µ–¥—ã–¥—É—â–µ–π –∑–∞–¥–∞—á–∏ –∏–¥—ë—Ç –≤ —Å–ª–µ–¥—É—é—â—É—é
chain(add.s(2, 2) | add.s(8))().get()

# group ‚Äî –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ –Ω–∞–±–æ—Ä–∞ –∑–∞–¥–∞—á
res = group(add.s(i, i) for i in range(5))().get()

# chord ‚Äî —Å–Ω–∞—á–∞–ª–∞ –≥—Ä—É–ø–ø–∞, –∑–∞—Ç–µ–º callback —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ –≥—Ä—É–ø–ø—ã
chord(group(add.s(i, i) for i in range(5)))(add.s(0)).get()
```

### –í–∏–¥—ã –∑–∞–ø—É—Å–∫–∞

–ï—Å—Ç—å —Ç—Ä–∏ –≤–∞—Ä–∏–∞–Ω—Ç–∞ –∑–∞–ø—É—Å–∫–∞ –∑–∞–¥–∞—á:

```
apply_async(args[, kwargs[, ‚Ä¶]])
```

–û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤:

```
delay(*args, **kwargs)
```

–û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –±–µ–∑ –∫–∞–∫–∏—Ö-–ª–∏–±–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —Å–∞–º–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è:

```
calling (__call__)
```

–ü—Ä–æ—Å—Ç–æ –≤—ã–∑–æ–≤, –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä –Ω–µ –º–µ—à–∞–µ—Ç –Ω–∞–º –ø—Ä–æ—Å—Ç–æ –≤—ã–∑–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é –±–µ–∑ Celery. :)

### –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã apply_async()

1. `countdown` ‚Äî –≤—ã–ø–æ–ª–Ω–∏—Ç—å —á–µ—Ä–µ–∑ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–π –ø—Ä–æ–º–µ–∂—É—Ç–æ–∫ –≤—Ä–µ–º–µ–Ω–∏

```python
add.apply_async((2, 2), countdown=10)
# –≤—ã–ø–æ–ª–Ω–∏—Ç—å —á–µ—Ä–µ–∑ 10 —Å–µ–∫—É–Ω–¥
```

2. `eta` ‚Äî –≤—ã–ø–æ–ª–Ω–∏—Ç—å –≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –≤—Ä–µ–º—è

```python
add.apply_async((2, 2), eta=now() + timedelta(seconds=10))
# –≤—ã–ø–æ–ª–Ω–∏—Ç—å —á–µ—Ä–µ–∑ 10 —Å–µ–∫—É–Ω–¥
```

3. `expires` ‚Äî –≤—Ä–µ–º—è, –ø–æ—Å–ª–µ –∫–æ—Ç–æ—Ä–æ–≥–æ –ø–µ—Ä–µ—Å—Ç–∞—Ç—å –≤—ã–ø–æ–ª–Ω—è—Ç—å –∑–∞–¥–∞—á—É; –º–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å –∫–∞–∫ —Ü–∏—Ñ—Ä—É, —Ç–∞–∫ –∏ –≤—Ä–µ–º—è

```python
add.apply_async((4, 5), countdown=60, expires=120)
add.apply_async((4, 5), expires=now() + timedelta(days=2))
```

4. `link` ‚Äî –≤—ã–ø–æ–ª–Ω–∏—Ç—å –¥—Ä—É–≥—É—é –∑–∞–¥–∞—á—É –ø–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —Ç–µ–∫—É—â–µ–π, –æ—Å–Ω–æ–≤—ã–≤–∞—è—Å—å –Ω–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö —Ç–µ–∫—É—â–µ–π

```python
add.apply_async((2, 2), link=add.s(16))
# ( 2 + 2 ) + 16
```

#### –†–µ—Ç—Ä–∞–∏ –∏ —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π –±—ç–∫–æ—Ñ—Ñ

```python
from celery import shared_task


@shared_task(bind=True, autoretry_for=(Exception,), retry_backoff=True, max_retries=5)
def fetch(self, url):
    # –≤—ã–±—Ä–∞—Å—ã–≤–∞–π—Ç–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ, —á—Ç–æ–±—ã —Å—Ä–∞–±–æ—Ç–∞–ª retry
    ...
```

#### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Å–∫–æ—Ä–æ—Å—Ç–∏ (rate limit)

```python
@shared_task(rate_limit='10/m')
def send_email(user_id):
    ...
```

#### Acks –∏ –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å (–≤–∞–∂–Ω–æ)

- –î–µ–ª–∞–π—Ç–µ –∑–∞–¥–∞—á–∏ –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω—ã–º–∏: –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—É—Å–∫ –Ω–µ –¥–æ–ª–∂–µ–Ω –ª–æ–º–∞—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ.
- –î–ª—è –¥–ª–∏—Ç–µ–ª—å–Ω—ã—Ö –∑–∞–¥–∞—á —Ä–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ `acks_late=True` –∏ —Ç–∞–π–º‚Äë–ª–∏–º–∏—Ç—ã, —á—Ç–æ–±—ã –Ω–µ —Ç–µ—Ä—è—Ç—å —Ä–∞–±–æ—Ç—É –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏—è—Ö –≤–æ—Ä–∫–µ—Ä–∞.

### –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞—á–∏

Celery –º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å –∫–∞–∫–∏–µ-–ª–∏–±–æ –∑–∞–¥–∞—á–∏ –ø—Ä–æ—Å—Ç–æ –ø–æ –≥—Ä–∞—Ñ–∏–∫—É.

–î–ª—è —ç—Ç–æ–≥–æ –Ω—É–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:

```python
app.conf.beat_schedule = {
    'add-every-30-seconds': {
        'task': 'tasks.add',
        'schedule': 30.0,
        'args': (16, 16)
    },
}
app.conf.timezone = 'UTC'

```

–ö–ª—é—á —Å–ª–æ–≤–∞—Ä—è ‚Äî —ç—Ç–æ —Ç–æ–ª—å–∫–æ –Ω–∞–∑–≤–∞–Ω–∏–µ, –º–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å —á—Ç–æ —É–≥–æ–¥–Ω–æ.

–¢–∞—Å–∫ ‚Äî —ç—Ç–æ –≤—ã–ø–æ–ª–Ω—è–µ–º—ã–π —Ç–∞—Å–∫. :)

`args` ‚Äî –µ–≥–æ –∞—Ä–≥—É–º–µ–Ω—Ç—ã.

`schedule` ‚Äî —á–∞—Å—Ç–æ—Ç–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤ —Å–µ–∫—É–Ω–¥–∞—Ö.

### –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–æ CRON

#### –ó–∞–ø—É—Å–∫ –≤–æ—Ä–∫–µ—Ä–∞ –∏ beat

```bash
celery -A proj worker -l info --concurrency 4
celery -A proj beat -l info
```

#### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥: Flower

–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: https://flower.readthedocs.io/

```bash
pip install flower
celery -A proj flower
```

```python
from celery.schedules import crontab

app.conf.beat_schedule = {
    # Executes every Monday morning at 7:30 a.m.
    'add-every-monday-morning': {
        'task': 'tasks.add',
        'schedule': crontab(hour=7, minute=30, day_of_week=1),
        'args': (16, 16),
    },
}
```

*Cron* ‚Äî —Å–∏—Å—Ç–µ–º–∞ –∑–∞–¥–∞–Ω–∏—è —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è, –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ –∫–∞–∫–æ–µ —É–≥–æ–¥–Ω–æ.

### –ü–æ –¥–≤–∏–∂–µ–Ω–∏—é —Å–æ–ª–Ω—Ü–∞

```python
from celery.schedules import solar

app.conf.beat_schedule = {
    # Executes at sunset in Melbourne
    'add-at-melbourne-sunset': {
        'task': 'tasks.add',
        'schedule': solar('sunset', -37.81753, 144.96715),
        'args': (16, 16),
    },
}
```

–í –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ –≤—ã–ø–æ–ª–Ω—è—Ç—å –≤–æ –≤—Ä–µ–º—è –∑–∞–∫–∞—Ç–∞ –ø–æ —É–∫–∞–∑–∞–Ω–Ω—ã–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º, –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –º–Ω–æ–≥–æ, –Ω–∞–ø—Ä–∏–º–µ—Ä, –∑–∞–∫–∞—Ç —Å —É—á—ë—Ç–æ–º –∑–¥–∞–Ω–∏–π ;)

–î–ª—è –∑–∞–ø—É—Å–∫–∞ –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é –Ω—É–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–π –≤–æ—Ä–∫–µ—Ä –¥–ª—è —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è (—Å–º–æ—Ç—Ä–µ—Ç—å –≤ –¥–æ–∫–µ)

### Celery –∏ Django

![](https://miro.medium.com/v2/resize:fit:700/1*viyC6TuFLc9JiR6ZlarXWw.jpeg)

–î–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è Celery –≤ Django —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Å–æ–∑–¥–∞—Ç—å –µ—â–µ –æ–¥–∏–Ω —Ñ–∞–π–ª `celery.py` –Ω–∞ –æ–¥–Ω–æ–º —É—Ä–æ–≤–Ω–µ —Å `settings.py`

```python
import os
from celery import Celery

os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'djangoProject1.settings')

app = Celery('djangoProject1')
app.config_from_object('django.conf:settings', namespace='CELERY')
app.autodiscover_tasks()
```

`app.autodiscover_tasks()` ‚Äî —ç—Ç–∞ —Å—Ç—Ä–æ—á–∫–∞ –±—É–¥–µ—Ç –æ—Ç–≤–µ—á–∞—Ç—å –∑–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ —Ç–∞—Å–∫–æ–≤ –≤–æ
–≤—Å–µ—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è—Ö.

–ù–∞ —Ç–æ–º –∂–µ —É—Ä–æ–≤–Ω–µ, –≥–¥–µ –∏ `settings.py` —Å–æ–∑–¥–∞—Ç—å\–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ–∞–π–ª `__init__.py` –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤–µ—Ä—Å–∏–∏ Python.

```python
# __init__.py
# This will make sure the app is always imported when
# Django starts so that shared_task will use this app.

from .celery import app as celery_app

__all__ = ('celery_app',)
```

–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: https://docs.celeryq.dev/en/stable/django/first-steps-with-django.html

```python
# settings.py (–ø—Ä–∏–º–µ—Ä)
CELERY_BROKER_URL = 'redis://localhost:6379/0'
CELERY_RESULT_BACKEND = 'redis://localhost:6379/1'
CELERY_TASK_TIME_LIMIT = 60
CELERY_TASK_SOFT_TIME_LIMIT = 50
```

–í—Å–µ –∑–∞–¥–∞—á–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–æ–∫—Ä—ã–≤–∞—Ç—å –Ω–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–º –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–æ–º `task`, –∞ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–æ–º `shared_task`, —Ç–æ–≥–¥–∞ Django —Å–º–æ–∂–µ—Ç
–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞–π—Ç–∏ –≤—Å–µ —Ç–∞—Å–∫–∏ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏.

```python
# tasks.py

from celery import shared_task

from demoapp.models import Widget


@shared_task
def add(x, y):
    return x + y


@shared_task
def mul(x, y):
    return x * y


@shared_task
def xsum(numbers):
    return sum(numbers)


@shared_task
def count_widgets():
    return Widget.objects.count()


@shared_task
def rename_widget(widget_id, name):
    w = Widget.objects.get(id=widget_id)
    w.name = name
    w.save()
```

#### –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```python
# settings.py (–ª–æ–∫–∞–ª—å–Ω–æ/—Ç–µ—Å—Ç—ã)
CELERY_TASK_ALWAYS_EAGER = True
```

–¢–∞–∫–∂–µ –¥–ª—è Django —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –º–Ω–æ–≥–æ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π, –Ω–∞–ø—Ä–∏–º–µ—Ä:

`django-celery-results` ‚Äî —á—Ç–æ–±—ã —Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ –ë–î –∏–ª–∏ –∫–µ—à–µ Django, –∑–∞ –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç—è–º–∏ –≤ –¥–æ–∫—É.

`django-celery-beat` ‚Äî –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏—Ö –∑–∞–¥–∞—á, —Å—Ä–∞–∑—É –≤—à–∏—Ç–∞—è –≤ –∞–¥–º–∏–Ω–∫—É Django, –∑–∞ –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç—è–º–∏ –æ–ø—è—Ç—å –∂–µ –≤
–¥–æ–∫—É.

# Multithreading. Multiprocessing. GIL.

## –û –ø–æ—Ç–æ–∫–∞—Ö –∏ –∏—Ö –∏—Å—Ç–æ–∫–∞—Ö

–ß—Ç–æ–±—ã –ø–æ–Ω—è—Ç—å –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ—Å—Ç—å, —Å–Ω–∞—á–∞–ª–∞ –≤–Ω–∏–∫–Ω–µ–º, —á—Ç–æ —Ç–∞–∫–æ–µ –ø—Ä–æ—Ü–µ—Å—Å. *–ü—Ä–æ—Ü–µ—Å—Å* ‚Äî —ç—Ç–æ —á–∞—Å—Ç—å –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –ø–∞–º—è—Ç–∏ –∏ —Ä–µ—Å—É—Ä—Å–æ–≤,
–∫–æ—Ç–æ—Ä—É—é –û–° –≤—ã–¥–µ–ª—è–µ—Ç –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–∞–º–º—ã. –ï—Å–ª–∏ –æ—Ç–∫—Ä—ã—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ –æ–¥–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –ø–æ–¥ –∫–∞–∂–¥—ã–π —Å–∏—Å—Ç–µ–º–∞
–≤—ã–¥–µ–ª–∏—Ç –ø–æ –ø—Ä–æ—Ü–µ—Å—Å—É. –í —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –±—Ä–∞—É–∑–µ—Ä–∞—Ö –∑–∞ –∫–∞–∂–¥—É—é –≤–∫–ª–∞–¥–∫—É –º–æ–∂–µ—Ç –æ—Ç–≤–µ—á–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å.

–í—ã –Ω–∞–≤–µ—Ä–Ω—è–∫–∞ —Å—Ç–∞–ª–∫–∏–≤–∞–ª–∏—Å—å —Å ¬´–î–∏—Å–ø–µ—Ç—á–µ—Ä–æ–º –∑–∞–¥–∞—á¬ª –≤ Windows (–≤ Linux ‚Äî ¬´–°–∏—Å—Ç–µ–º–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä¬ª) –∏ –∑–Ω–∞–µ—Ç–µ, —á—Ç–æ –ª–∏—à–Ω–∏–µ
–∑–∞–ø—É—â–µ–Ω–Ω—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã –≥—Ä—É–∑—è—Ç —Å–∏—Å—Ç–µ–º—É, –∞ —Å–∞–º—ã–µ ¬´—Ç—è–∂—ë–ª—ã–µ¬ª –∏–∑ –Ω–∏—Ö —á–∞—Å—Ç–æ –∑–∞–≤–∏—Å–∞—é—Ç, —Ç–∞–∫ —á—Ç–æ –∏—Ö –ø—Ä–∏—Ö–æ–¥–∏—Ç—Å—è –∑–∞–≤–µ—Ä—à–∞—Ç—å
–ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ.

–ù–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ª—é–±—è—Ç –º–Ω–æ–≥–æ–∑–∞–¥–∞—á–Ω–æ—Å—Ç—å: —Ö–ª–µ–±–æ–º –Ω–µ –∫–æ—Ä–º–∏ ‚Äî –¥–∞–π –æ—Ç–∫—Ä—ã—Ç—å —Å –¥–µ—Å—è—Ç–æ–∫ –æ–∫–æ–Ω –∏ –ø–æ–ø—Ä—ã–≥–∞—Ç—å —Ç—É–¥–∞-—Å—é–¥–∞. –ù–∞–ª–∏—Ü–æ
–¥–∏–ª–µ–º–º–∞: –Ω—É–∂–Ω–æ –æ–±–µ—Å–ø–µ—á–∏—Ç—å –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—É—é —Ä–∞–±–æ—Ç—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π –∏ –ø—Ä–∏ —ç—Ç–æ–º —Å–Ω–∏–∑–∏—Ç—å –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ —Å–∏—Å—Ç–µ–º—É, —á—Ç–æ–±—ã –æ–Ω–∞ –Ω–µ
—Ç–æ—Ä–º–æ–∑–∏–ª–∞. –î–æ–ø—É—Å—Ç–∏–º, ¬´–∂–µ–ª–µ–∑—É¬ª –Ω–µ —É–≥–Ω–∞—Ç—å—Å—è –∑–∞ –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—è–º–∏ –≤–ª–∞–¥–µ–ª—å—Ü–µ–≤ ‚Äî –Ω—É–∂–Ω–æ —Ä–µ—à–∞—Ç—å –≤–æ–ø—Ä–æ—Å –Ω–∞ –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–º —É—Ä–æ–≤–Ω–µ.

–ú—ã —Ö–æ—Ç–∏–º, —á—Ç–æ–±—ã –≤ –µ–¥–∏–Ω–∏—Ü—É –≤—Ä–µ–º–µ–Ω–∏ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä —É—Å–ø–µ–≤–∞–ª –≤—ã–ø–æ–ª–Ω–∏—Ç—å –±–æ–ª—å—à–µ –∫–æ–º–∞–Ω–¥ –∏ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –±–æ–ª—å—à–µ –¥–∞–Ω–Ω—ã—Ö. –¢–æ –µ—Å—Ç—å –Ω–∞–º –Ω–∞–¥–æ
—É–º–µ—Å—Ç–∏—Ç—å –≤ –∫–∞–∂–¥–æ–º –∫–≤–∞–Ω—Ç–µ –≤—Ä–µ–º–µ–Ω–∏ –±–æ–ª—å—à–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–æ–≥–æ –∫–æ–¥–∞. **–ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ –µ–¥–∏–Ω–∏—Ü—É –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–¥–∞ –≤ –≤–∏–¥–µ –æ–±—ä–µ–∫—Ç–∞ ‚Äî —ç—Ç–æ –∏
–µ—Å—Ç—å –ø–æ—Ç–æ–∫.**

–ö —Å–ª–æ–∂–Ω–æ–º—É –¥–µ–ª—É –ª–µ–≥—á–µ –ø–æ–¥—Å—Ç—É–ø–∏—Ç—å—Å—è, –µ—Å–ª–∏ —Ä–∞–∑–±–∏—Ç—å –µ–≥–æ –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–æ—Å—Ç—ã—Ö. –¢–∞–∫ –∏ –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –ø–∞–º—è—Ç—å—é: ¬´—Ç—è–∂—ë–ª—ã–π¬ª –ø—Ä–æ—Ü–µ—Å—Å
–¥–µ–ª—è—Ç –Ω–∞ –ø–æ—Ç–æ–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –∑–∞–Ω–∏–º–∞—é—Ç –º–µ–Ω—å—à–µ —Ä–µ—Å—É—Ä—Å–æ–≤ –∏ —Å–∫–æ—Ä–µ–µ –¥–æ–Ω–æ—Å—è—Ç –∫–æ–¥ –¥–æ –≤—ã—á–∏—Å–ª–∏—Ç–µ–ª—è (–∫–∞–∫ –∏–º–µ–Ω–Ω–æ ‚Äî —Å–º. –Ω–∏–∂–µ).

–£ –∫–∞–∂–¥–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –µ—Å—Ç—å –∫–∞–∫ –º–∏–Ω–∏–º—É–º –æ–¥–∏–Ω –ø—Ä–æ—Ü–µ—Å—Å, –∞ —É –∫–∞–∂–¥–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞ ‚Äî –º–∏–Ω–∏–º—É–º –æ–¥–∏–Ω –ø–æ—Ç–æ–∫, –∫–æ—Ç–æ—Ä—ã–π –Ω–∞–∑—ã–≤–∞—é—Ç –≥–ª–∞–≤–Ω—ã–º,
–∏ –∏–∑ –∫–æ—Ç–æ—Ä–æ–≥–æ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∑–∞–ø—É—Å–∫–∞—é—Ç –Ω–æ–≤—ã–µ.

### –†–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É –ø–æ—Ç–æ–∫–∞–º–∏ –∏ –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏

- –ü–æ—Ç–æ–∫–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –ø–∞–º—è—Ç—å, –≤—ã–¥–µ–ª–µ–Ω–Ω—É—é –ø–æ–¥ –ø—Ä–æ—Ü–µ—Å—Å, –∞ –ø—Ä–æ—Ü–µ—Å—Å—ã —Ç—Ä–µ–±—É—é—Ç —Å–µ–±–µ –æ—Ç–¥–µ–ª—å–Ω–æ–µ
  –º–µ—Å—Ç–æ –≤ –ø–∞–º—è—Ç–∏. –ü–æ—ç—Ç–æ–º—É –ø–æ—Ç–æ–∫–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è –∏ –∑–∞–≤–µ—Ä—à–∞—é—Ç—Å—è –±—ã—Å—Ç—Ä–µ–µ: —Å–∏—Å—Ç–µ–º–µ –Ω–µ –Ω—É–∂–Ω–æ –∫–∞–∂–¥—ã–π —Ä–∞–∑ –≤—ã–¥–µ–ª—è—Ç—å –∏–º –Ω–æ–≤–æ–µ –∞–¥—Ä–µ—Å–Ω–æ–µ
  –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ, –∞ –ø–æ—Ç–æ–º –≤—ã—Å–≤–æ–±–æ–∂–¥–∞—Ç—å –µ–≥–æ.

- –ü—Ä–æ—Ü–µ—Å—Å—ã —Ä–∞–±–æ—Ç–∞—é—Ç –∫–∞–∂–¥—ã–π —Å–æ —Å–≤–æ–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏ ‚Äî –æ–±–º–µ–Ω–∏–≤–∞—Ç—å—Å—è —á–µ–º-—Ç–æ –æ–Ω–∏ –º–æ–≥—É—Ç —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ –º–µ—Ö–∞–Ω–∏–∑–º –º–µ–∂–ø—Ä–æ—Ü–µ—Å—Å–Ω–æ–≥–æ
  –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è. –ü–æ—Ç–æ–∫–∏ –æ–±—Ä–∞—â–∞—é—Ç—Å—è –∫ –¥–∞–Ω–Ω—ã–º –∏ —Ä–µ—Å—É—Ä—Å–∞–º –¥—Ä—É–≥ –¥—Ä—É–≥–∞ –Ω–∞–ø—Ä—è–º—É—é: —á—Ç–æ –∏–∑–º–µ–Ω–∏–ª –æ–¥–∏–Ω ‚Äî —Å—Ä–∞–∑—É –¥–æ—Å—Ç—É–ø–Ω–æ –≤—Å–µ–º.
  –ü–æ—Ç–æ–∫
  –º–æ–∂–µ—Ç –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å ¬´—Å–æ–±—Ä–∞—Ç—å–µ–≤¬ª –ø–æ –ø—Ä–æ—Ü–µ—Å—Å—É, –≤ —Ç–æ –≤—Ä–µ–º—è –∫–∞–∫ –ø—Ä–æ—Ü–µ—Å—Å –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç –∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ —Å–≤–æ–∏—Ö ¬´–¥–æ—á–µ–∫¬ª. –ü–æ—ç—Ç–æ–º—É
  –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å—Å—è –º–µ–∂–¥—É –ø–æ—Ç–æ–∫–∞–º–∏ –±—ã—Å—Ç—Ä–µ–µ –∏ –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è –º–µ–∂–¥—É –Ω–∏–º–∏ –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω–∞ –ø—Ä–æ—â–µ.

–ö–∞–∫–æ–π –æ—Ç—Å—é–¥–∞ –≤—ã–≤–æ–¥? –ï—Å–ª–∏ –≤–∞–º –Ω—É–∂–Ω–æ –∫–∞–∫ –º–æ–∂–Ω–æ –±—ã—Å—Ç—Ä–µ–µ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –±–æ–ª—å—à–æ–π –æ–±—ä—ë–º –¥–∞–Ω–Ω—ã—Ö, —Ä–∞–∑–±–µ–π—Ç–µ –µ–≥–æ –Ω–∞ –∫—É—Å–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ
–º–æ–∂–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–º–∏ –ø–æ—Ç–æ–∫–∞–º–∏, –∞ –∑–∞—Ç–µ–º —Å–æ–±–µ—Ä–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤–æ–µ–¥–∏–Ω–æ. –≠—Ç–æ –ª—É—á—à–µ, —á–µ–º –ø–ª–æ–¥–∏—Ç—å –∂–∞–¥–Ω—ã–µ –¥–æ —Ä–µ—Å—É—Ä—Å–æ–≤
–ø—Ä–æ—Ü–µ—Å—Å—ã.

–ù–æ –ø–æ—á–µ–º—É —Ç–∞–∫–æ–µ –ø–æ–ø—É–ª—è—Ä–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∫–∞–∫ Firefox –∏–¥—ë—Ç –ø–æ –ø—É—Ç–∏ —Å–æ–∑–¥–∞–Ω–∏—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤? –ü–æ—Ç–æ–º—É —á—Ç–æ –∏–º–µ–Ω–Ω–æ –¥–ª—è
–±—Ä–∞—É–∑–µ—Ä–∞ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –≤–∫–ª–∞–¥–æ–∫ ‚Äî —ç—Ç–æ –Ω–∞–¥—ë–∂–Ω–æ –∏ –≥–∏–±–∫–æ. –ï—Å–ª–∏ —Å –æ–¥–Ω–∏–º –ø—Ä–æ—Ü–µ—Å—Å–æ–º —á—Ç–æ-—Ç–æ –Ω–µ —Ç–∞–∫, –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ
–∑–∞–≤–µ—Ä—à–∞—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º—É —Ü–µ–ª–∏–∫–æ–º ‚Äî –µ—Å—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ö–æ—Ç—è –±—ã —á–∞—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö.

–ß—Ç–æ —Ç–∞–∫–æ–µ –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ—Å—Ç—å? –í–æ—Ç –º—ã –∏ –ø–æ–¥–æ—à–ª–∏ –∫ –≥–ª–∞–≤–Ω–æ–º—É. *–ú–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ—Å—Ç—å* ‚Äî —ç—Ç–æ –∫–æ–≥–¥–∞ –ø—Ä–æ—Ü–µ—Å—Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Ä–∞–∑–±–∏—Ç –Ω–∞
–ø–æ—Ç–æ–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ (–≤ –æ–¥–Ω—É –µ–¥–∏–Ω–∏—Ü—É –≤—Ä–µ–º–µ–Ω–∏) –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–æ–º.

–í—ã—á–∏—Å–ª–∏—Ç–µ–ª—å–Ω–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –º–µ–∂–¥—É –¥–≤—É–º—è –∏–ª–∏ –±–æ–ª–µ–µ —è–¥—Ä–∞–º–∏, —Ç–∞–∫ —á—Ç–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∏ –¥—Ä—É–≥–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –ø—Ä–æ–≥—Ä–∞–º–º—ã –Ω–µ
–∑–∞–º–µ–¥–ª—è—é—Ç —Ä–∞–±–æ—Ç—É –¥—Ä—É–≥ –¥—Ä—É–≥–∞.

–ú–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –º–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –∏ –Ω–∞ –æ–¥–Ω–æ—è–¥–µ—Ä–Ω—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞—Ö, –Ω–æ —Ç–æ–≥–¥–∞ –ø–æ—Ç–æ–∫–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –ø–æ –æ—á–µ—Ä–µ–¥–∏: –ø–µ—Ä–≤—ã–π
–ø–æ—Ä–∞–±–æ—Ç–∞–ª, –µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–∏–ª–∏ ‚Äî –¥–∞–ª–∏ –ø–æ—Ä–∞–±–æ—Ç–∞—Ç—å –≤—Ç–æ—Ä–æ–º—É, —Å–æ—Ö—Ä–∞–Ω–∏–ª–∏ ‚Äî –≤–µ—Ä–Ω—É–ª–∏—Å—å –∫ –ø–µ—Ä–≤–æ–º—É –∏–ª–∏ –∑–∞–ø—É—Å—Ç–∏–ª–∏ —Ç—Ä–µ—Ç–∏–π, –∏
—Ç. –¥.

## Multithreading (–ú–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ—Å—Ç—å)

![](https://nicholasgribanov.name/wp-content/uploads/2020/12/1428558658_521718796.jpg)

### –ß—Ç–æ —Ç–∞–∫–æ–µ –ø–æ—Ç–æ–∫?

–í –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–µ **–ø–æ—Ç–æ–∫** ‚Äî —ç—Ç–æ –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –µ–¥–∏–Ω–∏—Ü–∞ —Ä–∞–±–æ—Ç—ã, –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º–æ–π.

–û –ø–æ—Ç–æ–∫–∞—Ö –Ω—É–∂–Ω–æ –∑–Ω–∞—Ç—å —Å–ª–µ–¥—É—é—â–µ–µ:

- –û–Ω–∏ —Å—É—â–µ—Å—Ç–≤—É—é—Ç –≤–Ω—É—Ç—Ä–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞;
- –í –æ–¥–Ω–æ–º –ø—Ä–æ—Ü–µ—Å—Å–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ—Ç–æ–∫–æ–≤;
- –ü–æ—Ç–æ–∫–∏ –≤ –æ–¥–Ω–æ–º –ø—Ä–æ—Ü–µ—Å—Å–µ —Ä–∞–∑–¥–µ–ª—è—é—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏ –ø–∞–º—è—Ç—å —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞.
- –ü–æ—Ç–æ–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ.

–í Python —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –º–æ–¥—É–ª—å `threading`, —Å–∞–º—ã–º –ø—Ä–æ—Å—Ç—ã–º –ø—Ä–∏–º–µ—Ä–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –±—É–¥–µ—Ç —Å–ª–µ–¥—É—é—â–∏–π –∫–æ–¥:

```python
import time
from threading import Thread


def sleep_me(i):
    print("–ü–æ—Ç–æ–∫ %i –∑–∞—Å—ã–ø–∞–µ—Ç –Ω–∞ 5 —Å–µ–∫—É–Ω–¥.\n" % i)
    time.sleep(5)
    print("–ü–æ—Ç–æ–∫ %i —Å–µ–π—á–∞—Å –ø—Ä–æ—Å–Ω—É–ª—Å—è.\n" % i)


for i in range(10):
    th = Thread(target=sleep_me, args=(i,))
    th.start()
```

–í—ã–≤–æ–¥ –±—É–¥–µ—Ç –ø—Ä–∏–º–µ—Ä–Ω–æ —Å–ª–µ–¥—É—é—â–∏–º:

```bash
–ü–æ—Ç–æ–∫ 0 –∑–∞—Å—ã–ø–∞–µ—Ç –Ω–∞ 5 —Å–µ–∫—É–Ω–¥.
–ü–æ—Ç–æ–∫ 3 –∑–∞—Å—ã–ø–∞–µ—Ç –Ω–∞ 5 —Å–µ–∫—É–Ω–¥.
–ü–æ—Ç–æ–∫ 1 –∑–∞—Å—ã–ø–∞–µ—Ç –Ω–∞ 5 —Å–µ–∫—É–Ω–¥.
–ü–æ—Ç–æ–∫ 4 –∑–∞—Å—ã–ø–∞–µ—Ç –Ω–∞ 5 —Å–µ–∫—É–Ω–¥.
–ü–æ—Ç–æ–∫ 2 –∑–∞—Å—ã–ø–∞–µ—Ç –Ω–∞ 5 —Å–µ–∫—É–Ω–¥.
–ü–æ—Ç–æ–∫ 5 –∑–∞—Å—ã–ø–∞–µ—Ç –Ω–∞ 5 —Å–µ–∫—É–Ω–¥.
–ü–æ—Ç–æ–∫ 6 –∑–∞—Å—ã–ø–∞–µ—Ç –Ω–∞ 5 —Å–µ–∫—É–Ω–¥.
–ü–æ—Ç–æ–∫ 7 –∑–∞—Å—ã–ø–∞–µ—Ç –Ω–∞ 5 —Å–µ–∫—É–Ω–¥.
–ü–æ—Ç–æ–∫ 8 –∑–∞—Å—ã–ø–∞–µ—Ç –Ω–∞ 5 —Å–µ–∫—É–Ω–¥.
–ü–æ—Ç–æ–∫ 9 –∑–∞—Å—ã–ø–∞–µ—Ç –Ω–∞ 5 —Å–µ–∫—É–Ω–¥.
–ü–æ—Ç–æ–∫ 0 —Å–µ–π—á–∞—Å –ø—Ä–æ—Å–Ω—É–ª—Å—è.
–ü–æ—Ç–æ–∫ 3 —Å–µ–π—á–∞—Å –ø—Ä–æ—Å–Ω—É–ª—Å—è.
–ü–æ—Ç–æ–∫ 1 —Å–µ–π—á–∞—Å –ø—Ä–æ—Å–Ω—É–ª—Å—è.
–ü–æ—Ç–æ–∫ 4 —Å–µ–π—á–∞—Å –ø—Ä–æ—Å–Ω—É–ª—Å—è.
–ü–æ—Ç–æ–∫ 2 —Å–µ–π—á–∞—Å –ø—Ä–æ—Å–Ω—É–ª—Å—è.
–ü–æ—Ç–æ–∫ 5 —Å–µ–π—á–∞—Å –ø—Ä–æ—Å–Ω—É–ª—Å—è.
–ü–æ—Ç–æ–∫ 6 —Å–µ–π—á–∞—Å –ø—Ä–æ—Å–Ω—É–ª—Å—è.
–ü–æ—Ç–æ–∫ 7 —Å–µ–π—á–∞—Å –ø—Ä–æ—Å–Ω—É–ª—Å—è.
–ü–æ—Ç–æ–∫ 8 —Å–µ–π—á–∞—Å –ø—Ä–æ—Å–Ω—É–ª—Å—è.
–ü–æ—Ç–æ–∫ 9 —Å–µ–π—á–∞—Å –ø—Ä–æ—Å–Ω—É–ª—Å—è.
```

–ü–æ—Ä—è–¥–æ–∫ –º–æ–∂–µ—Ç –±—ã—Ç—å –≤–æ–æ–±—â–µ –ª—é–±—ã–º, –∏ –º—ã —ç—Ç–æ—Ç –ø–æ—Ä—è–¥–æ–∫ –Ω–µ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º!

#### threading.active_count()

–≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏—Å–ø–æ–ª–Ω—è–µ–º—ã—Ö –Ω–∞ —Ç–µ–∫—É—â–∏–π –º–æ–º–µ–Ω—Ç –ø–æ—Ç–æ–∫–æ–≤. –ò–∑–º–µ–Ω–∏–º –ø–æ—Å–ª–µ–¥–Ω—é—é –ø—Ä–æ–≥—Ä–∞–º–º—É, —á—Ç–æ–±—ã –æ–Ω–∞
–≤—ã–≥–ª—è–¥–µ–ª–∞ –≤–æ—Ç —Ç–∞–∫:

```python
import time
import threading
from threading import Thread


def sleep_me(i):
    print("–ü–æ—Ç–æ–∫ %i –∑–∞—Å—ã–ø–∞–µ—Ç –Ω–∞ 5 —Å–µ–∫—É–Ω–¥." % i)
    time.sleep(5)
    print("–ü–æ—Ç–æ–∫ %i —Å–µ–π—á–∞—Å –ø—Ä–æ—Å–Ω—É–ª—Å—è." % i)


for i in range(10):
    th = Thread(target=sleep_me, args=(i,))
    th.start()
    print("–ó–∞–ø—É—â–µ–Ω–æ –ø–æ—Ç–æ–∫–æ–≤: %i." % threading.active_count())
```

–†–µ–∑—É–ª—å—Ç–∞—Ç –±—É–¥–µ—Ç –ø—Ä–∏–º–µ—Ä–Ω–æ —Ç–∞–∫–æ–π:

```bash
–ü–æ—Ç–æ–∫ 0 –∑–∞—Å—ã–ø–∞–µ—Ç –Ω–∞ 5 —Å–µ–∫—É–Ω–¥.
–ó–∞–ø—É—â–µ–Ω–æ –ø–æ—Ç–æ–∫–æ–≤: 2.
–ü–æ—Ç–æ–∫ 1 –∑–∞—Å—ã–ø–∞–µ—Ç –Ω–∞ 5 —Å–µ–∫—É–Ω–¥.
–ó–∞–ø—É—â–µ–Ω–æ –ø–æ—Ç–æ–∫–æ–≤: 3.
–ü–æ—Ç–æ–∫ 2 –∑–∞—Å—ã–ø–∞–µ—Ç –Ω–∞ 5 —Å–µ–∫—É–Ω–¥.
–ó–∞–ø—É—â–µ–Ω–æ –ø–æ—Ç–æ–∫–æ–≤: 4.
–ü–æ—Ç–æ–∫ 3 –∑–∞—Å—ã–ø–∞–µ—Ç –Ω–∞ 5 —Å–µ–∫—É–Ω–¥.
–ó–∞–ø—É—â–µ–Ω–æ –ø–æ—Ç–æ–∫–æ–≤: 5.
–ü–æ—Ç–æ–∫ 4 –∑–∞—Å—ã–ø–∞–µ—Ç –Ω–∞ 5 —Å–µ–∫—É–Ω–¥.
–ó–∞–ø—É—â–µ–Ω–æ –ø–æ—Ç–æ–∫–æ–≤: 6.
–ü–æ—Ç–æ–∫ 5 –∑–∞—Å—ã–ø–∞–µ—Ç –Ω–∞ 5 —Å–µ–∫—É–Ω–¥.
–ó–∞–ø—É—â–µ–Ω–æ –ø–æ—Ç–æ–∫–æ–≤: 7.
–ü–æ—Ç–æ–∫ 6 –∑–∞—Å—ã–ø–∞–µ—Ç –Ω–∞ 5 —Å–µ–∫—É–Ω–¥.
–ó–∞–ø—É—â–µ–Ω–æ –ø–æ—Ç–æ–∫–æ–≤: 8.
–ü–æ—Ç–æ–∫ 7 –∑–∞—Å—ã–ø–∞–µ—Ç –Ω–∞ 5 —Å–µ–∫—É–Ω–¥.
–ó–∞–ø—É—â–µ–Ω–æ –ø–æ—Ç–æ–∫–æ–≤: 9.
–ü–æ—Ç–æ–∫ 8 –∑–∞—Å—ã–ø–∞–µ—Ç –Ω–∞ 5 —Å–µ–∫—É–Ω–¥.
–ó–∞–ø—É—â–µ–Ω–æ –ø–æ—Ç–æ–∫–æ–≤: 10.
–ü–æ—Ç–æ–∫ 9 –∑–∞—Å—ã–ø–∞–µ—Ç –Ω–∞ 5 —Å–µ–∫—É–Ω–¥.
–ó–∞–ø—É—â–µ–Ω–æ –ø–æ—Ç–æ–∫–æ–≤: 11.
–ü–æ—Ç–æ–∫ 0 —Å–µ–π—á–∞—Å –ø—Ä–æ—Å–Ω—É–ª—Å—è.
–ü–æ—Ç–æ–∫ 5 —Å–µ–π—á–∞—Å –ø—Ä–æ—Å–Ω—É–ª—Å—è.
–ü–æ—Ç–æ–∫ 2 —Å–µ–π—á–∞—Å –ø—Ä–æ—Å–Ω—É–ª—Å—è.
–ü–æ—Ç–æ–∫ 9 —Å–µ–π—á–∞—Å –ø—Ä–æ—Å–Ω—É–ª—Å—è.
–ü–æ—Ç–æ–∫ 3 —Å–µ–π—á–∞—Å –ø—Ä–æ—Å–Ω—É–ª—Å—è.
–ü–æ—Ç–æ–∫ 7 —Å–µ–π—á–∞—Å –ø—Ä–æ—Å–Ω—É–ª—Å—è.
–ü–æ—Ç–æ–∫ 1 —Å–µ–π—á–∞—Å –ø—Ä–æ—Å–Ω—É–ª—Å—è.
–ü–æ—Ç–æ–∫ 8 —Å–µ–π—á–∞—Å –ø—Ä–æ—Å–Ω—É–ª—Å—è.
–ü–æ—Ç–æ–∫ 6 —Å–µ–π—á–∞—Å –ø—Ä–æ—Å–Ω—É–ª—Å—è.
–ü–æ—Ç–æ–∫ 4 —Å–µ–π—á–∞—Å –ø—Ä–æ—Å–Ω—É–ª—Å—è.
```

–¢–∞–∫–∂–µ –æ–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ, —á—Ç–æ –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –≤—Å–µ—Ö –ø–æ—Ç–æ–∫–æ–≤ —Å—á–µ—Ç—á–∏–∫ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —á–∏—Å–ª–æ 11, –∞ –Ω–µ 10. –ü—Ä–∏—á–∏–Ω–∞ –≤ —Ç–æ–º, —á—Ç–æ
–æ—Å–Ω–æ–≤–Ω–æ–π –ø–æ—Ç–æ–∫ —Ç–∞–∫–∂–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –Ω–∞—Ä–∞–≤–Ω–µ —Å 10 –æ—Å—Ç–∞–ª—å–Ω—ã–º–∏.

#### ThreadPoolExecutor (–¥–ª—è IO-bound)

```python
from concurrent.futures import ThreadPoolExecutor

def io_task(item):
    ...

items = [1, 2, 3]
with ThreadPoolExecutor(max_workers=4) as ex:
    list(ex.map(io_task, items))
```

> CPU-bound –∑–∞–¥–∞—á–∏ –ª—É—á—à–µ –≤—ã–Ω–æ—Å–∏—Ç—å –≤ multiprocessing (GIL).


## üß® –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ—Å—Ç–∏

–ú–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ—Å—Ç—å –¥–∞—ë—Ç –º–æ—â–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏, –Ω–æ –∏ –ø—Ä–∏–Ω–æ—Å–∏—Ç —Å —Å–æ–±–æ–π –º–Ω–æ–∂–µ—Å—Ç–≤–æ —Ä–∏—Å–∫–æ–≤. –ù–∏–∂–µ –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω—ã —Ç–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã, —Å –∫–æ—Ç–æ—Ä—ã–º–∏ —Å—Ç–∞–ª–∫–∏–≤–∞—é—Ç—Å—è –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –ø–æ—Ç–æ–∫–∞–º–∏.

### ü™§ 1. Race Condition (—Å–æ—Å—Ç—è–∑–∞–Ω–∏–µ –ø–æ—Ç–æ–∫–æ–≤)

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:** –¥–≤–∞ –∏–ª–∏ –±–æ–ª–µ–µ –ø–æ—Ç–æ–∫–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –æ–±—Ä–∞—â–∞—é—Ç—Å—è –∫ –æ–±—â–µ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –∏–ª–∏ —Ä–µ—Å—É—Ä—Å—É, –∏ –ø–æ—Ä—è–¥–æ–∫ –¥–æ—Å—Ç—É–ø–∞ –≤–ª–∏—è–µ—Ç –Ω–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç.

**–ü—Ä–∏–º–µ—Ä:** –æ–¥–∏–Ω –ø–æ—Ç–æ–∫ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é, –¥—Ä—É–≥–æ–π ‚Äî —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç –µ—ë –≤ –Ω–æ–ª—å. –ò—Ç–æ–≥ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ç–æ–≥–æ, –∫—Ç–æ –ø–µ—Ä–≤—ã–π.

```python
counter = 0

def increment():
    global counter
    for _ in range(100000):
        counter += 1

# –ó–∞–ø—É—Å–∫–∞–µ–º –¥–≤–∞ –ø–æ—Ç–æ–∫–∞, –∫–æ—Ç–æ—Ä—ã–µ –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∏—Ä—É—é—Ç —Å—á—ë—Ç—á–∏–∫
```

**–ü—Ä–æ–±–ª–µ–º–∞:** —Ä–µ–∑—É–ª—å—Ç–∞—Ç –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ 200000, –∞ —á—Ç–æ —É–≥–æ–¥–Ω–æ –º–µ–Ω—å—à–µ.

---

### üß± 2. Deadlock (–≤–∑–∞–∏–º–æ–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞)

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:** –¥–≤–∞ –ø–æ—Ç–æ–∫–∞ –∑–∞—Ö–≤–∞—Ç—ã–≤–∞—é—Ç —Ä–µ—Å—É—Ä—Å—ã –∏ –∂–¥—É—Ç –¥—Ä—É–≥ –¥—Ä—É–≥–∞, –Ω–æ –Ω–∏–∫—Ç–æ –Ω–µ –º–æ–∂–µ—Ç –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å.

**–ê–Ω–∞–ª–æ–≥–∏—è:** –¥–≤–∞ —á–µ–ª–æ–≤–µ–∫–∞ –≤ –¥–≤–µ—Ä–Ω–æ–º –ø—Ä–æ—ë–º–µ: –æ–¥–∏–Ω –¥–µ—Ä–∂–∏—Ç —Ä—É—á–∫—É —Å –æ–¥–Ω–æ–π —Å—Ç–æ—Ä–æ–Ω—ã, –¥—Ä—É–≥–æ–π ‚Äî —Å –¥—Ä—É–≥–æ–π. –ù–∏–∫—Ç–æ –Ω–µ —É—Å—Ç—É–ø–∞–µ—Ç.

```python
lock1 = Lock()
lock2 = Lock()

# –ü–æ—Ç–æ–∫ A
with lock1:
    with lock2:
        pass

# –ü–æ—Ç–æ–∫ B
with lock2:
    with lock1:
        pass
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –æ–±–∞ –ø–æ—Ç–æ–∫–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã –∏ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –∑–∞–≤–µ—Ä—à–∞—Ç—Å—è.

---

### üçΩÔ∏è 3. Starvation (–≥–æ–ª–æ–¥–∞–Ω–∏–µ)

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:** –æ–¥–∏–Ω –ø–æ—Ç–æ–∫ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –∑–∞—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç —Ä–µ—Å—É—Ä—Å, –Ω–µ –¥–∞–≤–∞—è –¥—Ä—É–≥–∏–º –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Å–≤–æ–∏ –∑–∞–¥–∞—á–∏.

**–ê–Ω–∞–ª–æ–≥–∏—è:** –æ—Ñ–∏—Ü–∏–∞–Ω—Ç –≤—Å–µ–≥–¥–∞ –æ–±—Å–ª—É–∂–∏–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ –æ–¥–Ω–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞, –∏–≥–Ω–æ—Ä–∏—Ä—É—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö.

**–ü—Ä–æ–±–ª–µ–º–∞:** –ø–æ—Ç–æ–∫–∏ –æ—Å—Ç–∞—é—Ç—Å—è –≤ –æ–∂–∏–¥–∞–Ω–∏–∏, –¥–∞–∂–µ –µ—Å–ª–∏ –æ–Ω–∏ –≥–æ—Ç–æ–≤—ã –∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é.

---

### üîÅ 4. Livelock (–∂–∏–≤–æ–π —Ç—É–ø–∏–∫)

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:** –ø–æ—Ç–æ–∫–∏ –Ω–µ –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è, –Ω–æ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–º —Ü–∏–∫–ª–µ –ø–æ–ø—ã—Ç–æ–∫ –∏ –æ—Ç—Å—Ç—É–ø–ª–µ–Ω–∏–π.

**–ê–Ω–∞–ª–æ–≥–∏—è:** –¥–≤–∞ –≤–µ–∂–ª–∏–≤—ã—Ö —á–µ–ª–æ–≤–µ–∫–∞ –≤ —É–∑–∫–æ–º –ø—Ä–æ—Ö–æ–¥–µ, –∫–æ—Ç–æ—Ä—ã–µ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ —É—Å—Ç—É–ø–∞—é—Ç –¥–æ—Ä–æ–≥—É –¥—Ä—É–≥ –¥—Ä—É–≥—É —Å–Ω–æ–≤–∞ –∏ —Å–Ω–æ–≤–∞.

```python
# –ü–æ—Ç–æ–∫–∏ –ø—ã—Ç–∞—é—Ç—Å—è –∏–∑–±–µ–∂–∞—Ç—å –≤–∑–∞–∏–º–æ–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏, –Ω–æ –¥–µ–ª–∞—é—Ç —ç—Ç–æ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ ‚Äî –∏ –Ω–µ –ø—Ä–æ–¥–≤–∏–≥–∞—é—Ç—Å—è
```

---

### üß† 5. –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è (Context Switching Overhead)

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:** —á–∞—Å—Ç–∞—è —Å–º–µ–Ω–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –º–µ–∂–¥—É –ø–æ—Ç–æ–∫–∞–º–∏ –º–æ–∂–µ—Ç –æ—Ç–Ω–∏–º–∞—Ç—å –±–æ–ª—å—à–µ –≤—Ä–µ–º–µ–Ω–∏, —á–µ–º —Å–∞–º–∞ —Ä–∞–±–æ—Ç–∞.

**–ü—Ä–æ–±–ª–µ–º–∞:** –µ—Å–ª–∏ —É –Ω–∞—Å 1000 –ø–æ—Ç–æ–∫–æ–≤, –∏ –∫–∞–∂–¥—ã–π –¥–µ–ª–∞–µ—Ç –ø–æ—á—Ç–∏ –Ω–∏—á–µ–≥–æ, –Ω–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É –Ω–∏–º–∏ —É–π–¥—ë—Ç –∫—É—á–∞ —Ä–µ—Å—É—Ä—Å–æ–≤.

---

### üß© 6. –ü—Ä–æ–±–ª–µ–º—ã —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:** –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∏–ª–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∑–∞–±—ã–ª–∏ `lock.release()` –∏–ª–∏
–∑–∞–±—ã–ª–∏ `acquire()`).

**–ü—Ä–æ–±–ª–µ–º–∞:** –æ—à–∏–±–∫–∏ —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è –Ω–µ–æ—á–µ–≤–∏–¥–Ω—ã–º–∏, –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω—ã–º–∏ –∏ —Ç—Ä—É–¥–Ω–æ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º—ã–º–∏.

---

üîé –≠—Ç–∏ –ø—Ä–æ–±–ª–µ–º—ã ‚Äî –æ—Å–Ω–æ–≤–Ω–∞—è –ø—Ä–∏—á–∏–Ω–∞, –ø–æ—á–µ–º—É –Ω—É–∂–Ω–æ **—É–º–µ–ª–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é**: `Lock`, `RLock`, `Semaphore`,
`Event`, `Condition` –∏ —Ç.–¥. –° –Ω–∏–º–∏ –º—ã –ø–æ–∑–Ω–∞–∫–æ–º–∏–º—Å—è –¥–∞–ª—å—à–µ.

## –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø–æ—Ç–æ–∫–æ–≤

## üîê –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø–æ—Ç–æ–∫–æ–≤

–ö–æ–≥–¥–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ—Ç–æ–∫–æ–≤ –ø—ã—Ç–∞—é—Ç—Å—è –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –æ–±—â–∏–π –æ–±—ä–µ–∫—Ç, –≤–æ–∑–º–æ–∂–Ω—ã –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã. –ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ, —á—Ç–æ 5 —á–µ–ª–æ–≤–µ–∫
–ø–∏—à—É—Ç –æ–¥–Ω—É —Å—Ç—Ä–æ–∫—É –Ω–∞ –¥–æ—Å–∫–µ —Å –º–µ–ª–æ–º: –≤—ã–π–¥–µ—Ç –º–µ—Å–∏–≤–æ `HWeol,rldo` –≤–º–µ—Å—Ç–æ `Hello, World`.

–ß—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å —ç—Ç–æ–≥–æ, –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è **–º–µ—Ö–∞–Ω–∏–∑–º—ã —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏**.

---

### üîê `Lock` ‚Äî –æ–±—ã—á–Ω—ã–π –∑–∞–º–æ–∫

```python
from threading import Lock, Thread

lock = Lock()


def task(data, value):
    with lock:
        data.append(value)
```

**–ê–Ω–∞–ª–æ–≥–∏—è:** –æ–¥–∏–Ω —Ç—É–∞–ª–µ—Ç –¥–ª—è –≤—Å–µ—Ö: –∫—Ç–æ-—Ç–æ –≤–æ—à—ë–ª ‚Äî –¥—Ä—É–≥–∏–µ –∂–¥—É—Ç.

---

### üîÄ `RLock` ‚Äî –¥–ª—è —Ä–µ–∫—É—Ä—Å–∏–∏ –∏ –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö –≤—Ö–æ–¥–æ–≤

```python
from threading import RLock

lock = RLock()


def recursive(n):
    if n <= 0:
        return
    with lock:
        print(f"Level {n}")
        recursive(n - 1)
```

**–ê–Ω–∞–ª–æ–≥–∏—è:** –≤—ã –≤ –∫–æ–º–Ω–∞—Ç–µ —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –¥–≤–µ—Ä—è–º–∏ –∏ –æ–¥–Ω–∏–º –∫–ª—é—á–æ–º –¥–ª—è —Å–µ–±—è.

---

### üö• `Semaphore` ‚Äî –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ —á–∏—Å–ª–æ –º–µ—Å—Ç

```python
from threading import BoundedSemaphore, Thread
from time import sleep

sema = BoundedSemaphore(value=3)


def park_car(num):
    with sema:
        print(f"Car {num} parked")
        sleep(1)
        print(f"Car {num} leaves")


for i in range(5):
    Thread(target=park_car, args=(i,)).start()
```

**–ê–Ω–∞–ª–æ–≥–∏—è:** –ø–∞—Ä–∫–æ–≤–∫–∞ –Ω–∞ 3 –º–µ—Å—Ç–∞ ‚Äî –¥–∞–ª—å—à–µ –æ—á–µ—Ä–µ–¥—å.

---

### üö¶ `Event` ‚Äî –∑–µ–ª—ë–Ω—ã–π —Å–≤–µ—Ç

```python
from threading import Event, Thread
from time import sleep

event = Event()


def runner(name):
    print(f"{name} ready...")
    event.wait()
    print(f"{name} runs!")


for i in range(3):
    Thread(target=runner, args=(f"Runner {i}",)).start()

sleep(2)
print("GO!")
event.set()
```

---

### üëÆ `Condition` ‚Äî –æ—Ö—Ä–∞–Ω–Ω–∏–∫ —Å —Ä–∞—Ü–∏–µ–π

```python
from threading import Condition, Thread
from time import sleep

cond = Condition()
data_ready = False


def worker():
    with cond:
        while not data_ready:
            cond.wait()
        print("Working with data")


def notifier():
    global data_ready
    sleep(2)
    with cond:
        data_ready = True
        cond.notify_all()


Thread(target=worker).start()
Thread(target=notifier).start()
```

---

## ‚úÖ –¢–∞–±–ª–∏—Ü–∞: —á—Ç–æ –∫–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

| –°—Ü–µ–Ω–∞—Ä–∏–π                         | –ü—Ä–∏–º–∏—Ç–∏–≤    |
|----------------------------------|-------------|
| –û–¥–∏–Ω –≤ —Ä—É–∫—É ‚Äî –¥—Ä—É–≥–∏–µ –∂–¥—É—Ç        | `Lock`      |
| –ù—É–∂–Ω–æ —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ –∑–∞—Ö–≤–∞—Ç–∏—Ç—å –∑–∞–º–æ–∫ | `RLock`     |
| –ù–µ –±–æ–ª–µ–µ N –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ          | `Semaphore` |
| –ñ–¥–µ–º —Å–∏–≥–Ω–∞–ª                      | `Event`     |
| –û–∂–∏–¥–∞–µ–º –æ—Å–æ–±–æ–µ —É—Å–ª–æ–≤–∏–µ           | `Condition` |

## GIL. Global Interpreter Lock

![](https://external-preview.redd.it/Vb3oEKfrfjxxS2Xdk433vwtpM6c-sQiVF7tvthc9FCI.png?auto=webp&s=ccc584e1d9d2d43cb2274dc26bb379f5dea3c22a)

–®–∏–∫–∞—Ä–Ω–∞—è [—Å—Ç–∞—Ç—å—è](https://tproger.ru/translations/global-interpreter-lock-guide/) –Ω–∞ —Ç–µ–º—É

*Python Global Interpreter Lock (GIL)* ‚Äî —ç—Ç–æ —Å–≤–æ–µ–æ–±—Ä–∞–∑–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞, –ø–æ–∑–≤–æ–ª—è—é—â–∞—è —Ç–æ–ª—å–∫–æ –æ–¥–Ω–æ–º—É –ø–æ—Ç–æ–∫—É —É–ø—Ä–∞–≤–ª—è—Ç—å
–∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ç–æ—Ä–æ–º Python. –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç –≤—Ä–µ–º–µ–Ω–∏ –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –ø–æ—Ç–æ–∫.

–†–∞–±–æ—Ç–∞ GIL –º–æ–∂–µ—Ç –∫–∞–∑–∞—Ç—å—Å—è –Ω–µ—Å—É—â–µ—Å—Ç–≤–µ–Ω–Ω–æ–π –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤, —Å–æ–∑–¥–∞—é—â–∏—Ö –æ–¥–Ω–æ–ø–æ—Ç–æ—á–Ω—ã–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã. –ù–æ –≤–æ –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω—ã—Ö
–ø—Ä–æ–≥—Ä–∞–º–º–∞—Ö –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ GIL –º–æ–∂–µ—Ç –Ω–µ–≥–∞—Ç–∏–≤–Ω–æ —Å–∫–∞–∑—ã–≤–∞—Ç—å—Å—è –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–æ-–∑–∞–≤–∏—Å–∏–º—ã—Ö –ø—Ä–æ–≥—Ä–∞–º–º.

–ü–æ—Å–∫–æ–ª—å–∫—É GIL –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–Ω–æ–º—É –ø–æ—Ç–æ–∫—É –¥–∞–∂–µ –≤ –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏, –æ–Ω –∑–∞—Ä–∞–±–æ—Ç–∞–ª —Ä–µ–ø—É—Ç–∞—Ü–∏—é ¬´–ø–µ—á–∞–ª—å–Ω–æ
–∏–∑–≤–µ—Å—Ç–Ω–æ–π¬ª —Ñ—É–Ω–∫—Ü–∏–∏.

–§–∞–∫—Ç–∏—á–µ—Å–∫–∏ Python –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç –º–Ω–æ–≥–æ –ø–æ—Ç–æ–∫–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ, –∞ —Ç–æ–ª—å–∫–æ –æ—á–µ–Ω—å –±—ã—Å—Ç—Ä–æ –∏—Ö –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç, —á—Ç–æ –¥–µ–ª–∞–µ—Ç –≤—Å–µ
–º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω—ã–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –ø–æ —Ñ–∞–∫—Ç—É –æ–¥–Ω–æ–ø–æ—Ç–æ—á–Ω—ã–º–∏.

### –ß—Ç–æ –∑–∞ –ø—Ä–æ–±–ª–µ–º—É –≤ Python —Ä–µ—à–∞–µ—Ç GIL?

Python –ø–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Å—ã–ª–æ–∫ –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–∞–º—è—Ç—å—é. –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ —Å–æ–∑–¥–∞–Ω–Ω—ã–µ –≤ Python –æ–±—ä–µ–∫—Ç—ã
–∏–º–µ—é—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –ø–æ–¥—Å—á—ë—Ç–∞ —Å—Å—ã–ª–æ–∫, –≤ –∫–æ—Ç–æ—Ä–æ–π —Ö—Ä–∞–Ω–∏—Ç—Å—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—Å–µ—Ö —Å—Å—ã–ª–æ–∫ –Ω–∞ —ç—Ç–æ—Ç –æ–±—ä–µ–∫—Ç. –ö–∞–∫ —Ç–æ–ª—å–∫–æ —ç—Ç–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è
—Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —Ä–∞–≤–Ω–æ–π –Ω—É–ª—é, –ø–∞–º—è—Ç—å, –≤—ã–¥–µ–ª–µ–Ω–Ω–∞—è –ø–æ–¥ —ç—Ç–æ—Ç –æ–±—ä–µ–∫—Ç, –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç—Å—è.

–í–æ—Ç –Ω–µ–±–æ–ª—å—à–æ–π –ø—Ä–∏–º–µ—Ä –∫–æ–¥–∞, –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É—é—â–∏–π —Ä–∞–±–æ—Ç—É –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø–æ–¥—Å—á—ë—Ç–∞ —Å—Å—ã–ª–æ–∫:

```python
import sys

a = []
b = a
sys.getrefcount(a)
3
```

–í —ç—Ç–æ–º –ø—Ä–∏–º–µ—Ä–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Å—ã–ª–æ–∫ –Ω–∞ –ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤ —Ä–∞–≤–Ω–æ 3. –ù–∞ —ç—Ç–æ—Ç –º–∞—Å—Å–∏–≤ —Å—Å—ã–ª–∞—é—Ç—Å—è: –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è `a`, –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è `b` –∏
–∞—Ä–≥—É–º–µ–Ω—Ç, –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–π —Ñ—É–Ω–∫—Ü–∏–∏ `sys.getrefcount()`.

–ü—Ä–æ–±–ª–µ–º–∞, –∫–æ—Ç–æ—Ä—É—é —Ä–µ—à–∞–µ—Ç GIL, —Å–≤—è–∑–∞–Ω–∞ —Å —Ç–µ–º, —á—Ç–æ –≤ –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ —Å—Ä–∞–∑—É –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ—Ç–æ–∫–æ–≤ –º–æ–≥—É—Ç —É–≤–µ–ª–∏—á–∏–≤–∞—Ç—å
–∏–ª–∏ —É–º–µ–Ω—å—à–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è —ç—Ç–æ–≥–æ —Å—á—ë—Ç—á–∏–∫–∞ —Å—Å—ã–ª–æ–∫. –≠—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ —Ç–æ–º—É, —á—Ç–æ –ø–∞–º—è—Ç—å –æ—á–∏—Å—Ç–∏—Ç—Å—è –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –∏ —É–¥–∞–ª–∏—Ç—Å—è —Ç–æ—Ç
–æ–±—ä–µ–∫—Ç, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–π –µ—â—ë —Å—É—â–µ—Å—Ç–≤—É–µ—Ç —Å—Å—ã–ª–∫–∞.

–°—á—ë—Ç—á–∏–∫ —Å—Å—ã–ª–æ–∫ –º–æ–∂–Ω–æ –∑–∞—â–∏—Ç–∏—Ç—å, –¥–æ–±–∞–≤–∏–≤ –±–ª–æ–∫–∏—Ä–∞—Ç–æ—Ä—ã –Ω–∞ –≤—Å–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö, –∫–æ—Ç–æ—Ä—ã–µ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è—é—Ç—Å—è –ø–æ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º
–ø–æ—Ç–æ–∫–∞–º. –í —Ç–∞–∫–æ–º —Å–ª—É—á–∞–µ —Å—á—ë—Ç—á–∏–∫ –±—É–¥–µ—Ç –∏–∑–º–µ–Ω—è—Ç—å—Å—è –∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ.

–ù–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –∫ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º –æ–±—ä–µ–∫—Ç–∞–º –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –ø–æ—è–≤–ª–µ–Ω–∏—é –¥—Ä—É–≥–æ–π –ø—Ä–æ–±–ª–µ–º—ã ‚Äî –≤–∑–∞–∏–º–æ–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ (–∞–Ω–≥–ª.
*deadlocks*), –∫–æ—Ç–æ—Ä–∞—è –ø–æ–ª—É—á–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –µ—Å—Ç—å –±–æ–ª–µ–µ —á–µ–º –Ω–∞ –æ–¥–Ω–æ–º –æ–±—ä–µ–∫—Ç–µ. –ö —Ç–æ–º—É –∂–µ —ç—Ç–∞ –ø—Ä–æ–±–ª–µ–º–∞ —Ç–æ–∂–µ
—Å–Ω–∏–∂–∞–ª–∞ –±—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏–∑-–∑–∞ –º–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –±–ª–æ–∫–∏—Ä–∞—Ç–æ—Ä–æ–≤.

`GIL` ‚Äî —ç—Ç–æ –æ–¥–∏–Ω–æ—á–Ω—ã–π –±–ª–æ–∫–∏—Ä–∞—Ç–æ—Ä —Å–∞–º–æ–≥–æ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ç–æ—Ä–∞ Python. –û–Ω –¥–æ–±–∞–≤–ª—è–µ—Ç –ø—Ä–∞–≤–∏–ª–æ: –ª—é–±–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–π—Ç-–∫–æ–¥–∞ –≤ Python
—Ç—Ä–µ–±—É–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ç–æ—Ä–∞. –í —Ç–∞–∫–æ–º —Å–ª—É—á–∞–µ –º–æ–∂–Ω–æ –∏—Å–∫–ª—é—á–∏—Ç—å –≤–∑–∞–∏–º–æ–±–ª–æ–∫–∏—Ä–æ–≤–∫—É, —Ç. –∫. `GIL` –±—É–¥–µ—Ç –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–π
–±–ª–æ–∫–∏—Ä–æ–≤–∫–æ–π –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏. –ö —Ç–æ–º—É –∂–µ –µ–≥–æ –≤–ª–∏—è–Ω–∏–µ –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞ —Å–æ–≤—Å–µ–º –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ. –û–¥–Ω–∞–∫–æ —Å—Ç–æ–∏—Ç
–ø–æ–º–Ω–∏—Ç—å, —á—Ç–æ GIL —É–≤–µ—Ä–µ–Ω–Ω–æ –¥–µ–ª–∞–µ—Ç –ª—é–±—É—é –ø—Ä–æ–≥—Ä–∞–º–º—É –æ–¥–Ω–æ–ø–æ—Ç–æ—á–Ω–æ–π.

–ù–µ—Å–º–æ—Ç—Ä—è –Ω–∞ —Ç–æ, —á—Ç–æ `GIL` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∏ –≤ –¥—Ä—É–≥–∏—Ö –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ç–æ—Ä–∞—Ö, –Ω–∞–ø—Ä–∏–º–µ—Ä –≤ Ruby, –æ–Ω –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–º —Ä–µ—à–µ–Ω–∏–µ–º
—ç—Ç–æ–π –ø—Ä–æ–±–ª–µ–º—ã. –ù–µ–∫–æ—Ç–æ—Ä—ã–µ —è–∑—ã–∫–∏ —Ä–µ—à–∞—é—Ç –ø—Ä–æ–±–ª–µ–º—É –ø–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è –ø–∞–º—è—Ç–∏ —Å –ø–æ–º–æ—â—å—é —Å–±–æ—Ä–∫–∏ –º—É—Å–æ—Ä–∞.

### –ö–∞–∫ —Å–ø—Ä–∞–≤–∏—Ç—å—Å—è —Å GIL?

–ï—Å–ª–∏ `GIL` —É –≤–∞—Å –≤—ã–∑—ã–≤–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—ã, –≤–æ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–µ—à–µ–Ω–∏–π, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã –º–æ–∂–µ—Ç–µ –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å:

–ú–Ω–æ–≥–æ–ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–Ω–æ—Å—Ç—å –ø—Ä–æ—Ç–∏–≤ –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ—Å—Ç–∏. –î–æ–≤–æ–ª—å–Ω–æ –ø–æ–ø—É–ª—è—Ä–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ, –ø–æ—Å–∫–æ–ª—å–∫—É —É –∫–∞–∂–¥–æ–≥–æ Python-–ø—Ä–æ—Ü–µ—Å—Å–∞ –µ—Å—Ç—å
—Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ç–æ—Ä —Å –≤—ã–¥–µ–ª–µ–Ω–Ω–æ–π –ø–æ–¥ –Ω–µ–≥–æ –ø–∞–º—è—Ç—å—é, –ø–æ—ç—Ç–æ–º—É —Å GIL –ø—Ä–æ–±–ª–µ–º –Ω–µ –±—É–¥–µ—Ç.

–ö–æ—Ä—É—Ç–∏–Ω—ã. –û –Ω–∏—Ö –Ω–∞ —Å–ª–µ–¥—É—é—â–µ–º –∑–∞–Ω—è—Ç–∏–∏.

### Python 3.13+ –∏ Free-threaded Python (PEP 703)

–í –æ–∫—Ç—è–±—Ä–µ 2024 –≥–æ–¥–∞ –≤—ã—à–µ–ª Python 3.13, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–∏–Ω—ë—Å **—ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω—É—é** –ø–æ–¥–¥–µ—Ä–∂–∫—É —Ä–µ–∂–∏–º–∞ –±–µ–∑ GIL (free-threaded Python). –≠—Ç–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –º–Ω–æ–≥–æ–ª–µ—Ç–Ω–µ–π —Ä–∞–±–æ—Ç—ã –Ω–∞–¥ PEP 703.

**–ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å:**

1. **–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º –±–µ–∑ GIL**: Python 3.13 –º–æ–∂–Ω–æ —Å–æ–±—Ä–∞—Ç—å —Å —Ñ–ª–∞–≥–æ–º `--disable-gil`. –í —ç—Ç–æ–º —Ä–µ–∂–∏–º–µ GIL –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—Ç–∫–ª—é—á—ë–Ω, –∏ –ø–æ—Ç–æ–∫–∏ –º–æ–≥—É—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –ø–æ-–Ω–∞—Å—Ç–æ—è—â–µ–º—É –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ.

2. **–≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å**: –†–µ–∂–∏–º –±–µ–∑ GIL –ø–æ–∫–∞ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π. –ù–µ –≤—Å–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ (–æ—Å–æ–±–µ–Ω–Ω–æ C-—Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è) –≥–æ—Ç–æ–≤—ã –∫ —Ä–∞–±–æ—Ç–µ –±–µ–∑ GIL. –û–∂–∏–¥–∞–µ—Ç—Å—è, —á—Ç–æ –ø–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–æ—è–≤–∏—Ç—Å—è –≤ Python 3.14‚Äì3.15.

3. **–ö–∞–∫ –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å**: –ù—É–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–ø–µ—Ü–∏–∞–ª—å–Ω—É—é —Å–±–æ—Ä–∫—É Python (–Ω–∞–ø—Ä–∏–º–µ—Ä, `python3.13t` ‚Äî "t" –æ–∑–Ω–∞—á–∞–µ—Ç "free-threaded") –∏–ª–∏ —Å–æ–±—Ä–∞—Ç—å –∏–∑ –∏—Å—Ö–æ–¥–Ω–∏–∫–æ–≤ —Å `--disable-gil`.

**–ß—Ç–æ —ç—Ç–æ –∑–Ω–∞—á–∏—Ç –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤:**

- **–ü–æ–∫–∞ —Ä–∞–Ω–æ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å**: –ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –ø—Ä–æ–µ–∫—Ç–æ–≤ –¥–æ–ª–∂–Ω—ã –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π Python —Å GIL
- **–°–ª–µ–¥–∏—Ç–µ –∑–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞–º–∏**: –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ (NumPy, pandas –∏ –¥—Ä.) –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ –¥–æ–±–∞–≤–ª—è—é—Ç –ø–æ–¥–¥–µ—Ä–∂–∫—É free-threaded —Ä–µ–∂–∏–º–∞
- **–¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –∑–∞—Ä–∞–Ω–µ–µ**: –ï—Å–ª–∏ –≤–∞—à –ø—Ä–æ–µ–∫—Ç –∞–∫—Ç–∏–≤–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ—Å—Ç—å, –º–æ–∂–Ω–æ –Ω–∞—á–∞—Ç—å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ free-threaded Python

**–í–∞–∂–Ω–æ:** –î–∞–∂–µ —Å –æ—Ç–∫–ª—é—á—ë–Ω–Ω—ã–º GIL –≤–∞–º –≤—Å—ë –µ—â—ë –Ω—É–∂–Ω—ã –º–µ—Ö–∞–Ω–∏–∑–º—ã —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ (`Lock`, `Queue` –∏ —Ç.–¥.) –¥–ª—è –∑–∞—â–∏—Ç—ã –æ–±—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö –æ—Ç race conditions!

### Python 3.14: –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç Python –±–µ–∑ GIL

Python 3.14 –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–∑–≤–∏—Ç–∏–µ free-threaded —Ä–µ–∂–∏–º–∞. –î–∞–≤–∞–π—Ç–µ —Ä–∞–∑–±–µ—Ä—ë–º, –∫–∞–∫ –∏–º–µ–Ω–Ω–æ Python —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ GIL ‚Äî —ç—Ç–æ –ø–æ–º–æ–∂–µ—Ç –ø–æ–Ω—è—Ç—å, –ø–æ—á–µ–º—É –ø–µ—Ä–µ—Ö–æ–¥ –∑–∞–Ω–∏–º–∞–µ—Ç —Ç–∞–∫ –º–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏.

#### –ü—Ä–æ–±–ª–µ–º–∞ –∞—Ç–æ–º–∞—Ä–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

–†–∞–Ω—å—à–µ GIL –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–ª, —á—Ç–æ —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω –ø–æ—Ç–æ–∫ –≤—ã–ø–æ–ª–Ω—è–µ—Ç Python-–∫–æ–¥. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–ª–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–æ—Å—Ç—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–ª—è –ø–æ–¥—Å—á—ë—Ç–∞ —Å—Å—ã–ª–æ–∫:

```c
// –° GIL ‚Äî –ø—Ä–æ—Å—Ç–æ –∏ –±—ã—Å—Ç—Ä–æ (1 —Ü–∏–∫–ª CPU)
obj->refcount++
```

–ë–µ–∑ GIL –Ω—É–∂–Ω—ã **–∞—Ç–æ–º–∞—Ä–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏** –Ω–∞ —É—Ä–æ–≤–Ω–µ CPU:

```c
// –ë–µ–∑ GIL ‚Äî –∞—Ç–æ–º–∞—Ä–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è (10-50 —Ü–∏–∫–ª–æ–≤ CPU)
atomic_add(&obj->refcount, 1)
```

–ê—Ç–æ–º–∞—Ä–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ 10-50 —Ä–∞–∑ –º–µ–¥–ª–µ–Ω–Ω–µ–µ! –ö–∞–∫ —ç—Ç–æ —Ä–µ—à–∏—Ç—å?

#### Biased Reference Counting (—Å–º–µ—â—ë–Ω–Ω—ã–π –ø–æ–¥—Å—á—ë—Ç —Å—Å—ã–ª–æ–∫)

–ö–∞–∂–¥—ã–π –æ–±—ä–µ–∫—Ç —Ç–µ–ø–µ—Ä—å –∏–º–µ–µ—Ç **–¥–≤–∞ —Å—á—ë—Ç—á–∏–∫–∞ —Å—Å—ã–ª–æ–∫**:

| –°—á—ë—Ç—á–∏–∫             | –¢–∏–ø                  | –ö—Ç–æ –æ–±–Ω–æ–≤–ª—è–µ—Ç          |
|---------------------|----------------------|------------------------|
| **Local refcount**  | –ë—ã—Å—Ç—Ä—ã–π, –Ω–µ–∞—Ç–æ–º–∞—Ä–Ω—ã–π | –ü–æ—Ç–æ–∫-–≤–ª–∞–¥–µ–ª–µ—Ü –æ–±—ä–µ–∫—Ç–∞ |
| **Shared refcount** | –ê—Ç–æ–º–∞—Ä–Ω—ã–π            | –î—Ä—É–≥–∏–µ –ø–æ—Ç–æ–∫–∏          |

**–ü–æ—á–µ–º—É —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:** –ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –æ–±—ä–µ–∫—Ç–æ–≤ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–Ω–∏–º –ø–æ—Ç–æ–∫–æ–º. –ü–æ—ç—Ç–æ–º—É 90%+ –æ–ø–µ—Ä–∞—Ü–∏–π `INCREF`/`DECREF` ‚Äî –±—ã—Å—Ç—Ä—ã–µ –∏ –Ω–µ–∞—Ç–æ–º–∞—Ä–Ω—ã–µ.

#### –ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è –º–æ–¥–µ–ª—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

–ë–µ–∑ GIL Python –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç—Ä–∏ —É—Ä–æ–≤–Ω—è –∑–∞—â–∏—Ç—ã:

**1. Per-Object Mutex (PyMutex)**
- –ö–∞–∂–¥—ã–π `PyObject` –∏–º–µ–µ—Ç –ª—ë–≥–∫–∏–π 1-–±–∞–π—Ç–æ–≤—ã–π –º—å—é—Ç–µ–∫—Å
- –ó–∞—â–∏—â–∞–µ—Ç –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (–∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ —Å–ø–∏—Å–∫–∞, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ª–æ–≤–∞—Ä—è)

**2. Container-Level Locking**
- –û–ø–µ—Ä–∞—Ü–∏–∏ –Ω–∞–¥ `dict`, `list`, `set` –∑–∞—Ö–≤–∞—Ç—ã–≤–∞—é—Ç —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
- –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –∞—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å –º–Ω–æ–≥–æ—à–∞–≥–æ–≤—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π (`dict.setdefault`, `list.append`)

**3. Consistent Lock Ordering**
- –ö–∞–∂–¥–æ–º—É —Ç–∏–ø—É –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –ø—Ä–∏—Å–≤–æ–µ–Ω –≥–ª–æ–±–∞–ª—å–Ω—ã–π —Ä–∞–Ω–≥
- –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∑–∞—Ö–≤–∞—Ç—ã–≤–∞—é—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –≤ —Å—Ç—Ä–æ–≥–æ–º –ø–æ—Ä—è–¥–∫–µ —Ä–∞–Ω–≥–æ–≤
- **–ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ deadlock'–æ–≤**

#### Thread-Safe Memory Management

**1. –ê–ª–ª–æ–∫–∞—Ç–æ—Ä mimalloc**
- –ö–∞–∂–¥—ã–π –ø–æ—Ç–æ–∫ –∏–º–µ–µ—Ç —Å–≤–æ—é –∞—Ä–µ–Ω—É –ø–∞–º—è—Ç–∏
- –û—Ç–ª–æ–∂–µ–Ω–Ω–∞—è –æ—á–µ—Ä–µ–¥—å –¥–ª—è –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è –ø–∞–º—è—Ç–∏ –º–µ–∂–¥—É –ø–æ—Ç–æ–∫–∞–º–∏
- –ü–æ—Ç–æ–∫–∏ –≤—ã–¥–µ–ª—è—é—Ç –ø–∞–º—è—Ç—å –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –¥—Ä—É–≥ –æ—Ç –¥—Ä—É–≥–∞

**2. Per-thread free-lists**
- –°–ø–∏—Å–∫–∏ —Å–≤–æ–±–æ–¥–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤ (tuples, frames, dict entries) –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã –≤ `PyThreadState`
- –ù–µ—Ç –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö –ø—É–ª–æ–≤ –æ–±—ä–µ–∫—Ç–æ–≤ ‚Äî –Ω–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫, –Ω–µ—Ç –≥–æ–Ω–æ–∫!

#### Safe Points –∏ Stop-the-World GC

**Safe Points (—Ç–æ—á–∫–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏)**
- –ü–æ—Ç–æ–∫–∏ –ø—Ä–∏–æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö –≥—Ä–∞–Ω–∏—Ü–∞—Ö –±–∞–π—Ç–∫–æ–¥–∞
- –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è: –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–∏–ø–æ–≤, –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–º–ø–æ—Ä—Ç–∞, –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∫—ç—à–µ–π, –∑–∞–ø—É—Å–∫–∞ GC
- –ó–∞–º–µ–Ω—è—é—Ç –Ω–µ—è–≤–Ω—É—é –≥–ª–æ–±–∞–ª—å–Ω—É—é —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é, –∫–æ—Ç–æ—Ä—É—é —Ä–∞–Ω—å—à–µ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–ª GIL

**Stop-the-World Garbage Collector**
- –í—Å–µ –ø–æ—Ç–æ–∫–∏ –ø–µ—Ä–µ—Ö–æ–¥—è—Ç –≤ Safe Points –∏ –ø—Ä–∏–æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è
- GC –ø–æ–ª—É—á–∞–µ—Ç —ç–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ç–æ—Ä–æ–º
- –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è: –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ —Ü–∏–∫–ª–æ–≤, —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω—ã—Ö –∏ shared refcount'–æ–≤
- STW-–ø–∞—É–∑—ã —Ä–µ–¥–∫–∏ –∏ –æ–±—ã—á–Ω–æ –∫–æ—Ä–æ—á–µ **1 –º—Å**

#### –ò—Ç–æ–≥: –ø–æ—á–µ–º—É —ç—Ç–æ —Å–ª–æ–∂–Ω–æ

–£–¥–∞–ª–µ–Ω–∏–µ GIL ‚Äî —ç—Ç–æ –Ω–µ –ø—Ä–æ—Å—Ç–æ "—É–±—Ä–∞—Ç—å –æ–¥–Ω—É –±–ª–æ–∫–∏—Ä–æ–≤–∫—É". –≠—Ç–æ –ø–æ–ª–Ω–∞—è –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∞:
- –°–∏—Å—Ç–µ–º—ã –ø–æ–¥—Å—á—ë—Ç–∞ —Å—Å—ã–ª–æ–∫
- –ê–ª–ª–æ–∫–∞—Ç–æ—Ä–∞ –ø–∞–º—è—Ç–∏
- –í—Å–µ—Ö –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
- –°–±–æ—Ä—â–∏–∫–∞ –º—É—Å–æ—Ä–∞
- –ú–µ—Ö–∞–Ω–∏–∑–º–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –ø–æ—Ç–æ–∫–æ–≤

–ò–º–µ–Ω–Ω–æ –ø–æ—ç—Ç–æ–º—É –ø–µ—Ä–µ—Ö–æ–¥ –∑–∞–Ω–∏–º–∞–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–µ—Ä—Å–∏–π Python.

> `3.14t` ‚Äî –±–æ–ª—å—à–µ –Ω–µ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç, –Ω–æ –∏ –Ω–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é. –≠—Ç–æ –æ–ø—Ü–∏—è, –∫–æ—Ç–æ—Ä—É—é –º–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å, –∏—Å–ø–æ–ª—å–∑—É—è –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ç–æ—Ä.

## Multiprocessing (–ú–Ω–æ–≥–æ–ø—Ä–æ—Ü–µ—Å–Ω–æ—Å—Ç—å)

![](https://cs5.pikabu.ru/post_img/2015/04/12/1/1428792218_764621563.jpg)

### –ß—Ç–æ —Ç–∞–∫–æ–µ –º–Ω–æ–≥–æ–ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ Python?

–°–Ω–∞—á–∞–ª–∞ –ø–æ–≥–æ–≤–æ—Ä–∏–º –æ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–µ. –≠—Ç–æ —Å–ø–æ—Å–æ–± –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ —Ä–∞–∑–±–∏–≤–∞—Ç—å –∏ –∑–∞–ø—É—Å–∫–∞—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º–Ω—ã–µ –∑–∞–¥–∞—á–∏ –Ω–∞
–Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –º–∏–∫—Ä–æ–ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞—Ö. –ü–æ —Å—É—Ç–∏, —ç—Ç–æ –ø–æ–ø—ã—Ç–∫–∞ —Å–æ–∫—Ä–∞—Ç–∏—Ç—å –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏ —ç—Ç–æ —Ç–æ, —á–µ–≥–æ –º—ã –º–æ–∂–µ–º –¥–æ—Å—Ç–∏—á—å —Å –ø–æ–º–æ—â—å—é
–∫–æ–º–ø—å—é—Ç–µ—Ä–∞ —Å –¥–≤—É–º—è –∏–ª–∏ –±–æ–ª–µ–µ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞–º–∏, –∏–ª–∏ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –∫–æ–º–ø—å—é—Ç–µ—Ä–Ω–æ–π —Å–µ—Ç–∏. –ú—ã —Ç–∞–∫–∂–µ –Ω–∞–∑—ã–≤–∞–µ–º —ç—Ç–æ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–º–∏
–≤—ã—á–∏—Å–ª–µ–Ω–∏—è–º–∏.

–ò—Ç–∞–∫, —Ç–µ–ø–µ—Ä—å –ø–µ—Ä–µ–π–¥–µ–º –∫ Python Multiprocessing, —ç—Ç–æ —Å–ø–æ—Å–æ–± –ø–æ–≤—ã—Å–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø—É—Ç–µ–º —Å–æ–∑–¥–∞–Ω–∏—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–≥–æ
–∫–æ–¥–∞. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª–∏ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–æ–≤ –¥–µ–ª–∞—é—Ç —ç—Ç–æ –≤–æ–∑–º–æ–∂–Ω—ã–º, –¥–æ–±–∞–≤–ª—è—è –±–æ–ª—å—à–µ —è–¥–µ—Ä –∫ —Å–≤–æ–∏–º –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞–º. –í –º–Ω–æ–≥–æ–ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–Ω–æ–π
—Å–∏—Å—Ç–µ–º–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Ä–∞–∑–±–∏–≤–∞—é—Ç—Å—è –Ω–∞ –±–æ–ª–µ–µ –º–µ–ª–∫–∏–µ –ø–æ–¥–ø—Ä–æ–≥—Ä–∞–º–º—ã –¥–ª—è —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã. –í–∑–≥–ª—è–Ω–∏—Ç–µ –Ω–∞ –æ–¥–Ω–æ–ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–Ω—É—é
—Å–∏—Å—Ç–µ–º—É. –£—á–∏—Ç—ã–≤–∞—è –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ, –æ–Ω –ø—ã—Ç–∞–µ—Ç—Å—è –ø—Ä–µ—Ä—ã–≤–∞—Ç—å –∏ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å—Å—è –º–µ–∂–¥—É –∑–∞–¥–∞—á–∞–º–∏. –ö–∞–∫ –±—ã –≤—ã —Å–µ–±—è
—á—É–≤—Å—Ç–≤–æ–≤–∞–ª–∏, –±—É–¥—É—á–∏ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–º —à–µ—Ñ-–ø–æ–≤–∞—Ä–æ–º –Ω–∞ –∫—É—Ö–Ω–µ —Å —Å–æ—Ç–Ω—è–º–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤? –í—ã –¥–æ–ª–∂–Ω—ã –±—ã–ª–∏ –±—ã –≤—ã–ø–æ–ª–Ω—è—Ç—å –≤—Å–µ –æ–±—ã—á–Ω—ã–µ –∑–∞–¥–∞—á–∏
–æ—Ç –≤—ã–ø–µ—á–∫–∏ –¥–æ –∑–∞–º–µ—Å–∞ —Ç–µ—Å—Ç–∞.

### –ö–æ–≥–¥–∞ —ç—Ç–æ –ø–æ–ª–µ–∑–Ω–æ?

- –ú—É–ª—å—Ç–∏–ø—Ä–æ—Ü–µ—Å—Å–æ—Ä ‚Äì –∫–æ–º–ø—å—é—Ç–µ—Ä —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–º–∏ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞–º–∏.

- –ú–Ω–æ–≥–æ—è–¥–µ—Ä–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä ‚Äì –æ–¥–∏–Ω –≤—ã—á–∏—Å–ª–∏—Ç–µ–ª—å–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Å –±–æ–ª–µ–µ —á–µ–º –æ–¥–Ω–æ–π –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ–π —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–π –µ–¥–∏–Ω–∏—Ü–µ–π
  –æ–±—Ä–∞–±–æ—Ç–∫–∏/—è–¥—Ä–∞–º–∏.

–í –ª—é–±–æ–º —Å–ª—É—á–∞–µ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä –º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∑–∞–¥–∞—á –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ, –Ω–∞–∑–Ω–∞—á–∞—è –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä –¥–ª—è –∫–∞–∂–¥–æ–π –∑–∞–¥–∞—á–∏.

–ü—Ä–∏–º–µ—Ä:

```python
from multiprocessing import Process


def square(n):
    print("–ß–∏—Å–ª–æ –≤ –∫–≤–∞–¥—Ä–∞—Ç–µ ", n ** 2)


def cube(n):
    print("–ß–∏—Å–ª–æ –≤ –∫—É–±–µ", n ** 3)


if __name__ == "__main__":
    p1 = Process(target=square, args=(7,))
    p2 = Process(target=cube, args=(7,))
    p1.start()
    p2.start()
    p1.join()
    p2.join()
    print("–ú—ã –∑–∞–∫–æ–Ω—á–∏–ª–∏")
```

–û—Ç–ª–∏—á–∏–µ –æ—Ç –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ—Å—Ç–∏ –≤ —Ç–æ–º, —á—Ç–æ –≤ —ç—Ç–æ–º —Å–ª—É—á–∞–µ –∫–∞–∂–¥—ã–π –æ—Ç–¥–µ–ª—å–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –æ—Ç–¥–µ–ª—å–Ω—ã–º —è–¥—Ä–æ–º –∏–ª–∏
–ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–æ–º, –∏ –Ω–∏–∫–∞–∫ –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è GIL.

–ù–æ –ø—Ä–æ—Ü–µ–¥—É—Ä–∞ —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–æ—Ä–æ–≥–æ—Å—Ç–æ—è—â–∞—è, –∏ –Ω–µ—Ç –Ω–∏–∫–∞–∫–æ–≥–æ —Å–º—ã—Å–ª–∞ —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤—ã–π –ø—Ä–æ—Ü–µ—Å—Å –¥–ª—è
–ø—Ä–æ—Å—Ç—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π.

–£ –∫–∞–∂–¥–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞ –µ—Å—Ç—å id, –Ω–∞–∑–≤–∞–Ω–∏–µ –∏ —Ç. –¥. —ç—Ç–∏ –¥–∞–Ω–Ω—ã–µ –≤—Å–µ–≥–¥–∞ –º–æ–∂–Ω–æ –∏–∑–≤–ª–µ—á—å.

### –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤

–¢–∞–∫ –∂–µ –∫–∞–∫ –∏ —Å –ø–æ—Ç–æ–∫–∞–º–∏ —É –Ω–∞—Å –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–∏—Ç—É–∞—Ü–∏—è, –∫–æ–≥–¥–∞ —Ä–∞–∑–Ω—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç –æ–¥–Ω–∏ –∏ —Ç–µ –∂–µ –¥–∞–Ω–Ω—ã–µ, –∏ —á—Ç–æ–±—ã –±—ã—Ç—å
—É–≤–µ—Ä–µ–Ω–Ω—ã–º, —á—Ç–æ –¥–µ–π—Å—Ç–≤–∏—è –Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ, –º—ã –º–æ–∂–µ–º –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ü–µ—Å—Å, —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –∏–¥–µ–Ω—Ç–∏—á–µ–Ω.

```python
from multiprocessing import Process, Lock

lock = Lock()


def printer(item):
    lock.acquire()
    try:
        print(item)
    finally:
        lock.release()


if __name__ == "__main__":
    items = ['nacho', 'salsa', 7]
    for item in items:
        p = Process(target=printer, args=(item,))
        p.start()
```

–î–ª—è –º–Ω–æ–≥–æ–ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–Ω–æ—Å—Ç–∏ —Ä–∞–±–æ—Ç–∞—é—Ç —Ä–æ–≤–Ω–æ —Ç–µ –∂–µ —Å–∞–º—ã–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏, –∫–∞–∫ –∏ –¥–ª—è –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ—Å—Ç–∏.

### –ü—É–ª –≤—ã–∑–æ–≤–æ–≤

–ü—É–ª - —ç—Ç–æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å–æ–∑–¥–∞—Ç—å —Å—Ä–∞–∑—É –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤, –∞ –Ω–µ –¥–µ–ª–∞—Ç—å —ç—Ç–æ –ø–æ –æ–¥–Ω–æ–º—É. –í –¥–∞–Ω–Ω–æ–º –ø—Ä–∏–º–µ—Ä–µ –º—ã
—Å—Ä–∞–∑—É —Å–æ–∑–¥–∞—ë–º 3 –ø—Ä–æ—Ü–µ—Å—Å–∞ –¥–ª—è —Ç—Ä–µ—Ö –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –≤—ã—á–∏—Å–ª–µ–Ω–∏–π.

```python
from multiprocessing import Pool


def double(n):
    return n * 2


if __name__ == '__main__':
    nums = [2, 3, 6]
    pool = Pool(processes=3)
    print(pool.map(double, nums))
```

–ï—Å–ª–∏ –Ω–∞–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã—á–∏—Å–ª—è—Ç—å –æ–¥–Ω–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–∞ —Ç—Ä—ë—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞—Ö, –Ω–∞–º –ø–æ–º–æ–∂–µ—Ç —Ñ—É–Ω–∫—Ü–∏—è `apply_async()`:

```python
from multiprocessing import Pool


def double(n):
    return n * 2


if __name__ == '__main__':
    pool = Pool(processes=3)
    result = pool.apply_async(double, (7,))
    print(result.get())
```

## üß∑ –ü–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –∏ –ø—Ä–æ—Ü–µ—Å—Å–æ–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö

–ö–æ–≥–¥–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ—Ç–æ–∫–æ–≤ –∏–ª–∏ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ —Ä–∞–±–æ—Ç–∞—é—Ç —Å –æ–¥–Ω–∏–º –∏ —Ç–µ–º –∂–µ –æ–±—ä–µ–∫—Ç–æ–º, –≤–∞–∂–Ω–æ, —á—Ç–æ–±—ã –¥–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω—ã–º –±—ã–ª
**–±–µ–∑–æ–ø–∞—Å–Ω—ã–º**. –î–ª—è —ç—Ç–æ–≥–æ —Å—É—â–µ—Å—Ç–≤—É—é—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ **–ø–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ (thread-safe)** –∏ **–ø—Ä–æ—Ü–µ—Å—Å–æ–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ (
process-safe)** —Å—Ç—Ä—É–∫—Ç—É—Ä—ã.

---

### üßµ –ü–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã (`threading`)

–í Python –æ–±—ã—á–Ω—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö (`list`, `dict`) **–Ω–µ —è–≤–ª—è—é—Ç—Å—è –ø–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω—ã–º–∏**, –µ—Å–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ—Ç–æ–∫–æ–≤
–æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ —á–∏—Ç–∞—é—Ç –∏ –ø–∏—à—É—Ç –≤ –Ω–∏—Ö. –û–¥–Ω–∞–∫–æ –µ—Å—Ç—å —Ä–µ—à–µ–Ω–∏—è:

#### üîπ `queue.Queue`

–û—á–µ—Ä–µ–¥—å, —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–Ω–∞—è –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø–æ—Ç–æ–∫–æ–≤.

```python
from queue import Queue
from threading import Thread

q = Queue()

def worker():
    while not q.empty():
        item = q.get()
        print(f"Got item: {item}")
        q.task_done()

for i in range(5):
    q.put(i)

threads = [Thread(target=worker) for _ in range(2)]
[t.start() for t in threads]
[t.join() for t in threads]
```

‚úîÔ∏è –ë–µ–∑ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫. –í—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ.

---

### üß© –ö–∞–∫–∏–µ –µ—â—ë —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —è–≤–ª—è—é—Ç—Å—è –ø–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω—ã–º–∏?

| –°—Ç—Ä—É–∫—Ç—É—Ä–∞             | –ü–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–∞? | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π                                       |
|-----------------------|------------------|---------------------------------------------------|
| `list`, `dict`        | ‚ùå                | –¢–æ–ª—å–∫–æ —Å –≤–Ω–µ—à–Ω–∏–º–∏ `Lock`, `RLock`                 |
| `queue.Queue`         | ‚úÖ                | –ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π –≤–∞—Ä–∏–∞–Ω—Ç                              |
| `collections.deque`   | ‚úÖ (—á–∞—Å—Ç–∏—á–Ω–æ)     | –ë–µ–∑–æ–ø–∞—Å–Ω–∞ –¥–ª—è `append`, `pop`, –Ω–æ –Ω–µ –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ |
| `queue.LifoQueue`     | ‚úÖ                | –°—Ç–µ–∫ (LIFO)                                       |
| `queue.PriorityQueue` | ‚úÖ                | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–∞—è –æ—á–µ—Ä–µ–¥—å                              |

---

### üß¨ –ü—Ä–æ—Ü–µ—Å—Å–æ–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã (`multiprocessing`)

–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `multiprocessing`, –æ–±—ã—á–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã –Ω–µ –¥–µ–ª—è—Ç –ø–∞–º—è—Ç—å. –î–ª—è –æ–±–º–µ–Ω–∞ –¥–∞–Ω–Ω—ã–º–∏ –º–µ–∂–¥—É –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏ –Ω—É–∂–Ω—ã:

#### üîπ `multiprocessing.Queue`

–ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ—á–µ—Ä–µ–¥—å –¥–ª—è –ø—Ä–æ—Ü–µ—Å—Å–æ–≤.

```python
from multiprocessing import Process, Queue

def worker(q):
    while not q.empty():
        item = q.get()
        print(f"Process got: {item}")

if __name__ == "__main__":
    q = Queue()
    for i in range(5):
        q.put(i)

    processes = [Process(target=worker, args=(q,)) for _ in range(2)]
    [p.start() for p in processes]
    [p.join() for p in processes]
```

---

#### üîπ `multiprocessing.Manager`

–ú–µ–Ω–µ–¥–∂–µ—Ä –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç **–æ–±—â—É—é –ø–∞–º—è—Ç—å** –º–µ–∂–¥—É –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏.

```python
from multiprocessing import Manager, Process

def add_item(shared_list):
    shared_list.append("hello")

if __name__ == "__main__":
    with Manager() as manager:
        shared = manager.list()
        p = Process(target=add_item, args=(shared,))
        p.start()
        p.join()
        print(shared)
```

---

### üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ

| –¢–∏–ø                     | –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤ `threading`   | –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤ `multiprocessing` | –ü–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å | –ü—Ä–æ—Ü–µ—Å—Å–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å |
|-------------------------|---------------------------|-------------------------------|--------------------|----------------------|
| `list`, `dict`          | ‚ùå (–Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã)           | ‚ùå                             | ‚ùå                  | ‚ùå                    |
| `queue.Queue`           | ‚úÖ                         | ‚ùå                             | ‚úÖ                  | ‚ùå                    |
| `multiprocessing.Queue` | ‚ùå                         | ‚úÖ                             | ‚ùå                  | ‚úÖ                    |
| `Manager().list()`      | ‚ùå                         | ‚úÖ                             | ‚ùå                  | ‚úÖ                    |

---

### üìù –í—ã–≤–æ–¥

- –î–ª—è **–ø–æ—Ç–æ–∫–æ–≤** –∏—Å–ø–æ–ª—å–∑—É–µ–º `queue.Queue` –∏ `deque` (—á–∞—Å—Ç–∏—á–Ω–æ).
- –î–ª—è **–ø—Ä–æ—Ü–µ—Å—Å–æ–≤** ‚Äî `multiprocessing.Queue` –∏ `Manager`.
- `list` –∏ `dict` –Ω–µ –ø–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω—ã ‚Äî –æ–±–æ—Ä–∞—á–∏–≤–∞–π –∏—Ö –≤ `Lock` –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π –º–µ–Ω–µ–¥–∂–µ—Ä—ã.

---

[‚Üê –õ–µ–∫—Ü–∏—è 30: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ. Django, REST API.](lesson30.md) | [–õ–µ–∫—Ü–∏—è 32: Asyncio. Aiohttp. –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ. ‚Üí](lesson32.md)
